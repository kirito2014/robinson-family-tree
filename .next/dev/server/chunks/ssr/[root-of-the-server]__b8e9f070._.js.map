{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => {\n    const connection: Connection = {\n      ...c,\n      sourceHandle: c.sourceHandle as any,\n      targetHandle: c.targetHandle as any,\n      lineStyle: c.lineStyle as any\n    };\n    \n    // Parse arrowOptions from extra field if it exists\n    if (c.extra) {\n      try {\n        const extraData = JSON.parse(c.extra);\n        if (extraData.type || extraData.size || extraData.direction) {\n          connection.arrowOptions = extraData;\n        }\n      } catch (e) {\n        console.error('Failed to parse connection extra data:', e);\n      }\n    }\n    \n    return connection;\n  });\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, arrowOptions, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getMembersAction as '0024f6b3bb0041b116f544985cf2e67b94c3ca660b'} from 'ACTIONS_MODULE0'\nexport {saveMemberAction as '40e5a64366c3d06d35d15db8485cbb6d999e9cd315'} from 'ACTIONS_MODULE0'\nexport {deleteMemberAction as '40fcc969529f44b2912e8271701b25d876d6708598'} from 'ACTIONS_MODULE0'\nexport {getConnectionsAction as '0092d9a56c8573aeff6f65e8b858ed5e175897b587'} from 'ACTIONS_MODULE0'\nexport {saveConnectionAction as '405601e25bb52b3f303dcbc9b817cd5fd479b6236b'} from 'ACTIONS_MODULE0'\nexport {deleteConnectionAction as '40e1e85f3981298898a15b89c5b7869ea28c0f5e53'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 260, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}