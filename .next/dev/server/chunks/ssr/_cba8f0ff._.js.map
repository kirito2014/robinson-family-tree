{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => ({\n    ...c,\n    sourceHandle: c.sourceHandle as any,\n    targetHandle: c.targetHandle as any,\n    lineStyle: c.lineStyle as any\n  }));\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, arrowOptions, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":[],"mappings":";;;;;;;MAOsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,oDAAA"}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => ({\n    ...c,\n    sourceHandle: c.sourceHandle as any,\n    targetHandle: c.targetHandle as any,\n    lineStyle: c.lineStyle as any\n  }));\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, arrowOptions, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":[],"mappings":";;;;;;;MAgBsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,oDAAA"}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => ({\n    ...c,\n    sourceHandle: c.sourceHandle as any,\n    targetHandle: c.targetHandle as any,\n    lineStyle: c.lineStyle as any\n  }));\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, arrowOptions, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":[],"mappings":";;;;;;;MA6DsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,sDAAA"}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => ({\n    ...c,\n    sourceHandle: c.sourceHandle as any,\n    targetHandle: c.targetHandle as any,\n    lineStyle: c.lineStyle as any\n  }));\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, arrowOptions, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":[],"mappings":";;;;;;;MAsFsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,wDAAA"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => ({\n    ...c,\n    sourceHandle: c.sourceHandle as any,\n    targetHandle: c.targetHandle as any,\n    lineStyle: c.lineStyle as any\n  }));\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, arrowOptions, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":[],"mappings":";;;;;;;MAgGsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,wDAAA"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => ({\n    ...c,\n    sourceHandle: c.sourceHandle as any,\n    targetHandle: c.targetHandle as any,\n    lineStyle: c.lineStyle as any\n  }));\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, arrowOptions, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle,\n      extra: arrowOptions ? JSON.stringify(arrowOptions) : null\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":[],"mappings":";;;;;;;MA+HsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,0DAAA"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/services/dbService.ts"],"sourcesContent":["import { FamilyMember, Connection } from '../types';\nimport { \n  getMembersAction, \n  saveMemberAction, \n  deleteMemberAction, \n  getConnectionsAction, \n  saveConnectionAction, \n  deleteConnectionAction \n} from '../app/actions';\n\n// This service now acts as a bridge to Server Actions\n// Note: All methods are now ASYNC\n\nexport const dbService = {\n  getMembers: async (): Promise<FamilyMember[]> => {\n    try {\n      return await getMembersAction();\n    } catch (e) {\n      console.error(\"Failed to fetch members\", e);\n      return [];\n    }\n  },\n\n  addMember: async (member: FamilyMember) => {\n    await saveMemberAction(member);\n  },\n\n  updateMember: async (member: FamilyMember) => {\n    await saveMemberAction(member);\n  },\n\n  deleteMember: async (id: string) => {\n    await deleteMemberAction(id);\n  },\n\n  // Batch Operations\n  batchDeleteMembers: async (ids: string[]) => {\n    for (const id of ids) {\n      await deleteMemberAction(id);\n    }\n  },\n\n  getConnections: async (): Promise<Connection[]> => {\n    try {\n      return await getConnectionsAction();\n    } catch (e) {\n      console.error(\"Failed to fetch connections\", e);\n      return [];\n    }\n  },\n\n  addConnection: async (conn: Connection) => {\n    await saveConnectionAction(conn);\n  },\n\n  updateConnection: async (conn: Connection) => {\n    await saveConnectionAction(conn);\n  },\n\n  deleteConnection: async (id: string) => {\n    await deleteConnectionAction(id);\n  },\n\n  // Export Logic needs to be client-side generated from fetched data, \n  // or moved to a server action that returns the string.\n  // For simplicity, we assume the caller has the data or we fetch it here.\n  exportAsSql: async () => {\n    const members = await getMembersAction();\n    const connections = await getConnectionsAction();\n    \n    let sql = `-- Robinson Family Tree Export\\n-- Generated on ${new Date().toISOString()}\\n\\n`;\n    \n    sql += `CREATE TABLE IF NOT EXISTS members (\n      id TEXT PRIMARY KEY,\n      name TEXT,\n      name_zh TEXT,\n      role TEXT,\n      birth_date TEXT,\n      location TEXT,\n      avatar TEXT,\n      gender TEXT,\n      is_self BOOLEAN,\n      x INTEGER,\n      y INTEGER\n    );\\n\\n`;\n\n    sql += `CREATE TABLE IF NOT EXISTS connections (\n      id TEXT PRIMARY KEY,\n      source_id TEXT,\n      target_id TEXT,\n      source_handle TEXT,\n      target_handle TEXT,\n      label TEXT,\n      label_zh TEXT,\n      color TEXT,\n      line_style TEXT,\n      FOREIGN KEY(source_id) REFERENCES members(id),\n      FOREIGN KEY(target_id) REFERENCES members(id)\n    );\\n\\n`;\n\n    members.forEach(m => {\n      sql += `INSERT INTO members (id, name, name_zh, role, birth_date, location, avatar, gender, is_self, x, y) VALUES ('${m.id}', '${m.name.replace(/'/g, \"''\")}', '${(m.nameZh||'').replace(/'/g, \"''\")}', '${m.role}', '${m.birthDate||''}', '${m.location||''}', '${m.avatar}', '${m.gender}', ${m.isSelf ? 1 : 0}, ${Math.round(m.x)}, ${Math.round(m.y)});\\n`;\n    });\n    sql += '\\n';\n\n    connections.forEach(c => {\n      sql += `INSERT INTO connections (id, source_id, target_id, source_handle, target_handle, label, label_zh, color, line_style) VALUES ('${c.id}', '${c.sourceId}', '${c.targetId}', '${c.sourceHandle}', '${c.targetHandle}', '${c.label}', '${c.labelZh||''}', '${c.color||'#e5e7eb'}', '${c.lineStyle||'solid'}');\\n`;\n    });\n\n    return sql;\n  },\n\n  // Export as JSON\n  exportAsJson: async () => {\n    const members = await getMembersAction();\n    const connections = await getConnectionsAction();\n    \n    const exportData = {\n      members,\n      connections,\n      metadata: {\n        exportedAt: new Date().toISOString(),\n        version: '1.0',\n        totalMembers: members.length,\n        totalConnections: connections.length\n      }\n    };\n    \n    return JSON.stringify(exportData, null, 2);\n  },\n\n  // Export as CSV\n  exportAsCsv: async () => {\n    const members = await getMembersAction();\n    const connections = await getConnectionsAction();\n    \n    // Members CSV\n    let membersCsv = 'id,name,name_zh,role,birth_date,location,avatar,gender,is_self,x,y\\n';\n    members.forEach(m => {\n      membersCsv += `\"${m.id}\",\"${m.name.replace(/\"/g, '\"\"')}\",\"${(m.nameZh||'').replace(/\"/g, '\"\"')}\",\"${m.role}\",\"${m.birthDate||''}\",\"${m.location||''}\",\"${m.avatar}\",\"${m.gender}\",\"${m.isSelf ? 'true' : 'false'}\",\"${Math.round(m.x)}\",\"${Math.round(m.y)}\"\\n`;\n    });\n    \n    // Connections CSV\n    let connectionsCsv = 'id,source_id,target_id,source_handle,target_handle,label,label_zh,color,line_style\\n';\n    connections.forEach(c => {\n      connectionsCsv += `\"${c.id}\",\"${c.sourceId}\",\"${c.targetId}\",\"${c.sourceHandle}\",\"${c.targetHandle}\",\"${c.label.replace(/\"/g, '\"\"')}\",\"${(c.labelZh||'').replace(/\"/g, '\"\"')}\",\"${c.color||'#e5e7eb'}\",\"${c.lineStyle||'solid'}\"\\n`;\n    });\n    \n    return {\n      members: membersCsv,\n      connections: connectionsCsv\n    };\n  }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/locales.ts"],"sourcesContent":["export const translations = {\n  en: {\n    appTitle: \"Robinson Family Tree\",\n    tree: \"Tree\",\n    directory: \"Directory\",\n    settings: \"Settings\",\n    searchPlaceholder: \"Find family member...\",\n    export: \"Export SQL\",\n    addMember: \"Add Member\",\n    addCenterMember: \"Add Center Member\",\n    emptyStateTitle: \"Start Your Family Tree\",\n    emptyStateDesc: \"No family members found. Please add yourself as the center member to begin.\",\n    name: \"Name\",\n    nameZh: \"Name (Chinese)\",\n    role: \"Role / Relation\",\n    birthDate: \"Birth Date\",\n    location: \"Location\",\n    save: \"Save\",\n    cancel: \"Cancel\",\n    delete: \"Delete\",\n    edit: \"Edit\",\n    setAsSelf: \"Set as Me\",\n    isSelf: \"Me\",\n    connectPrompt: \"Drag from a dot to connect\",\n    connectionLabel: \"Relationship Label\",\n    connectionLabelZh: \"Relationship Label (CN)\",\n    sourceHandle: \"Source Position\",\n    targetHandle: \"Target Position\",\n    top: \"Top\",\n    right: \"Right\",\n    bottom: \"Bottom\",\n    left: \"Left\",\n    male: \"Male\",\n    female: \"Female\",\n    centerOnMe: \"Reset to Me\",\n    lock: \"Lock\",\n    unlock: \"Unlock\",\n    autoArrange: \"Auto Arrange\",\n    lineColor: \"Line Color\",\n    lineStyle: \"Line Style\",\n    solid: \"Solid\",\n    dashed: \"Dashed\",\n    dotted: \"Dotted\",\n    calculatedRelation: \"Relation to You\",\n    arrowOptions: \"Arrow Options\",\n    arrowType: \"Arrow Type\",\n    arrowSize: \"Arrow Size\",\n    arrowDirection: \"Arrow Direction\",\n    source: \"Source\",\n    target: \"Target\",\n    both: \"Both\"\n  },\n  zh: {\n    appTitle: \"罗宾逊家族树\",\n    tree: \"族谱图\",\n    directory: \"通讯录\",\n    settings: \"设置\",\n    searchPlaceholder: \"查找家庭成员...\",\n    export: \"导出 SQL\",\n    addMember: \"添加成员\",\n    addCenterMember: \"添加核心成员\",\n    emptyStateTitle: \"开始您的家族树\",\n    emptyStateDesc: \"暂无数据。请先添加您自己作为核心成员。\",\n    name: \"姓名\",\n    nameZh: \"中文名\",\n    role: \"角色 / 关系\",\n    birthDate: \"出生日期\",\n    location: \"地点\",\n    save: \"保存\",\n    cancel: \"取消\",\n    delete: \"删除\",\n    edit: \"编辑\",\n    setAsSelf: \"设为自己\",\n    isSelf: \"我\",\n    connectPrompt: \"从圆点拖动以连接\",\n    connectionLabel: \"关系称呼\",\n    connectionLabelZh: \"关系称呼 (中文)\",\n    sourceHandle: \"起始位置\",\n    targetHandle: \"目标位置\",\n    top: \"上\",\n    right: \"右\",\n    bottom: \"下\",\n    left: \"左\",\n    male: \"男\",\n    female: \"女\",\n    centerOnMe: \"回到中心\",\n    lock: \"锁定\",\n    unlock: \"解锁\",\n    autoArrange: \"自动排列\",\n    lineColor: \"线条颜色\",\n    lineStyle: \"线条样式\",\n    solid: \"实线\",\n    dashed: \"虚线\",\n    dotted: \"点线\",\n    calculatedRelation: \"与我的关系\",\n    arrowOptions: \"箭头选项\",\n    arrowType: \"箭头类型\",\n    arrowSize: \"箭头大小\",\n    arrowDirection: \"箭头方向\",\n    source: \"起始端\",\n    target: \"目标端\",\n    both: \"两端\"\n  }\n};"],"names":[],"mappings":";;;;AAAO,MAAM,eAAe;IAC1B,IAAI;QACF,UAAU;QACV,MAAM;QACN,WAAW;QACX,UAAU;QACV,mBAAmB;QACnB,QAAQ;QACR,WAAW;QACX,iBAAiB;QACjB,iBAAiB;QACjB,gBAAgB;QAChB,MAAM;QACN,QAAQ;QACR,MAAM;QACN,WAAW;QACX,UAAU;QACV,MAAM;QACN,QAAQ;QACR,QAAQ;QACR,MAAM;QACN,WAAW;QACX,QAAQ;QACR,eAAe;QACf,iBAAiB;QACjB,mBAAmB;QACnB,cAAc;QACd,cAAc;QACd,KAAK;QACL,OAAO;QACP,QAAQ;QACR,MAAM;QACN,MAAM;QACN,QAAQ;QACR,YAAY;QACZ,MAAM;QACN,QAAQ;QACR,aAAa;QACb,WAAW;QACX,WAAW;QACX,OAAO;QACP,QAAQ;QACR,QAAQ;QACR,oBAAoB;QACpB,cAAc;QACd,WAAW;QACX,WAAW;QACX,gBAAgB;QAChB,QAAQ;QACR,QAAQ;QACR,MAAM;IACR;IACA,IAAI;QACF,UAAU;QACV,MAAM;QACN,WAAW;QACX,UAAU;QACV,mBAAmB;QACnB,QAAQ;QACR,WAAW;QACX,iBAAiB;QACjB,iBAAiB;QACjB,gBAAgB;QAChB,MAAM;QACN,QAAQ;QACR,MAAM;QACN,WAAW;QACX,UAAU;QACV,MAAM;QACN,QAAQ;QACR,QAAQ;QACR,MAAM;QACN,WAAW;QACX,QAAQ;QACR,eAAe;QACf,iBAAiB;QACjB,mBAAmB;QACnB,cAAc;QACd,cAAc;QACd,KAAK;QACL,OAAO;QACP,QAAQ;QACR,MAAM;QACN,MAAM;QACN,QAAQ;QACR,YAAY;QACZ,MAAM;QACN,QAAQ;QACR,aAAa;QACb,WAAW;QACX,WAAW;QACX,OAAO;QACP,QAAQ;QACR,QAAQ;QACR,oBAAoB;QACpB,cAAc;QACd,WAAW;QACX,WAAW;QACX,gBAAgB;QAChB,QAAQ;QACR,QAAQ;QACR,MAAM;IACR;AACF"}},
    {"offset": {"line": 334, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/components/Navbar.tsx"],"sourcesContent":["import React from 'react';\nimport { ViewMode } from '../types';\nimport { translations } from '../locales';\nimport { dbService } from '../services/dbService';\n\ninterface NavbarProps {\n    currentView: ViewMode;\n    setView: (view: ViewMode) => void;\n    showChinese: boolean;\n    setShowChinese: (show: boolean) => void;\n}\n\nconst Navbar: React.FC<NavbarProps> = ({ currentView, setView, showChinese, setShowChinese }) => {\n    const t = translations[showChinese ? 'zh' : 'en'];\n\n    const handleExport = async () => {\n        const sql = await dbService.exportAsSql();\n        const blob = new Blob([sql], { type: 'text/sql' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `robinson_family_tree_${new Date().toISOString().split('T')[0]}.sql`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    };\n\n    return (\n        <header className=\"fixed top-0 left-0 right-0 z-50 flex items-center justify-between px-6 py-4 bg-white/60 dark:bg-black/60 backdrop-blur-md border-b border-white/20 dark:border-white/10 shadow-sm\">\n            <div className=\"flex items-center gap-6\">\n                <div className=\"flex items-center gap-3 text-slate-900 dark:text-white cursor-pointer\" onClick={() => setView('tree')}>\n                    <div className=\"p-2 bg-primary/20 rounded-lg text-primary-dark dark:text-primary\">\n                        <span className=\"material-symbols-outlined text-2xl\">account_tree</span>\n                    </div>\n                    <h1 className=\"text-xl font-bold tracking-tight hidden sm:block\">{t.appTitle}</h1>\n                </div>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n                <nav className=\"hidden lg:flex items-center gap-2 mr-4\">\n                    <button \n                        onClick={() => setView('tree')}\n                        className={`px-4 py-2 rounded-xl text-sm font-bold transition-colors ${currentView === 'tree' ? 'bg-primary/20 text-primary-dark dark:text-primary' : 'hover:bg-black/5 dark:hover:bg-white/10'}`}\n                    >\n                        {t.tree}\n                    </button>\n                    <button \n                        onClick={() => setView('directory')}\n                        className={`px-4 py-2 rounded-xl text-sm font-bold transition-colors ${currentView === 'directory' ? 'bg-primary/20 text-primary-dark dark:text-primary' : 'hover:bg-black/5 dark:hover:bg-white/10'}`}\n                    >\n                        {t.directory}\n                    </button>\n                </nav>\n                \n                {/* Language Toggle */}\n                <button \n                    onClick={() => setShowChinese(!showChinese)}\n                    className=\"flex items-center gap-1.5 px-3 py-1.5 bg-gray-100 dark:bg-white/10 hover:bg-gray-200 dark:hover:bg-white/20 rounded-lg transition-all\"\n                    title=\"Toggle Language\"\n                >\n                    <span className=\"material-symbols-outlined text-[18px] text-gray-600 dark:text-gray-300\">translate</span>\n                    <span className=\"text-xs font-bold font-mono text-gray-700 dark:text-gray-200 w-6 text-center\">\n                        {showChinese ? 'CN' : 'EN'}\n                    </span>\n                </button>\n\n                <div className=\"flex items-center gap-2\">\n                    <button \n                        onClick={handleExport}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl text-sm font-bold transition-colors shadow-sm active:scale-95\"\n                    >\n                        <span className=\"material-symbols-outlined text-[20px]\">database</span>\n                        <span className=\"hidden xl:inline\">{t.export}</span>\n                    </button>\n                </div>\n                \n                <div className=\"w-px h-8 bg-gray-200 dark:bg-gray-700 mx-1\"></div>\n                \n                <div className=\"h-10 w-10 rounded-full bg-cover bg-center border-2 border-white dark:border-gray-800 shadow-sm cursor-pointer hover:ring-2 hover:ring-primary transition-all\" style={{backgroundImage: \"url('https://picsum.photos/id/64/200/200')\"}}>\n                </div>\n            </div>\n        </header>\n    );\n};\n\nexport default Navbar;\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;AASA,MAAM,SAAgC,CAAC,EAAE,WAAW,EAAE,OAAO,EAAE,WAAW,EAAE,cAAc,EAAE;IACxF,MAAM,IAAI,uHAAY,CAAC,cAAc,OAAO,KAAK;IAEjD,MAAM,eAAe;QACjB,MAAM,MAAM,MAAM,kIAAS,CAAC,WAAW;QACvC,MAAM,OAAO,IAAI,KAAK;YAAC;SAAI,EAAE;YAAE,MAAM;QAAW;QAChD,MAAM,MAAM,IAAI,eAAe,CAAC;QAChC,MAAM,IAAI,SAAS,aAAa,CAAC;QACjC,EAAE,IAAI,GAAG;QACT,EAAE,QAAQ,GAAG,CAAC,qBAAqB,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;QACjF,SAAS,IAAI,CAAC,WAAW,CAAC;QAC1B,EAAE,KAAK;QACP,SAAS,IAAI,CAAC,WAAW,CAAC;QAC1B,IAAI,eAAe,CAAC;IACxB;IAEA,qBACI,8OAAC;QAAO,WAAU;;0BACd,8OAAC;gBAAI,WAAU;0BACX,cAAA,8OAAC;oBAAI,WAAU;oBAAwE,SAAS,IAAM,QAAQ;;sCAC1G,8OAAC;4BAAI,WAAU;sCACX,cAAA,8OAAC;gCAAK,WAAU;0CAAqC;;;;;;;;;;;sCAEzD,8OAAC;4BAAG,WAAU;sCAAoD,EAAE,QAAQ;;;;;;;;;;;;;;;;;0BAIpF,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCACG,SAAS,IAAM,QAAQ;gCACvB,WAAW,CAAC,yDAAyD,EAAE,gBAAgB,SAAS,sDAAsD,2CAA2C;0CAEhM,EAAE,IAAI;;;;;;0CAEX,8OAAC;gCACG,SAAS,IAAM,QAAQ;gCACvB,WAAW,CAAC,yDAAyD,EAAE,gBAAgB,cAAc,sDAAsD,2CAA2C;0CAErM,EAAE,SAAS;;;;;;;;;;;;kCAKpB,8OAAC;wBACG,SAAS,IAAM,eAAe,CAAC;wBAC/B,WAAU;wBACV,OAAM;;0CAEN,8OAAC;gCAAK,WAAU;0CAAyE;;;;;;0CACzF,8OAAC;gCAAK,WAAU;0CACX,cAAc,OAAO;;;;;;;;;;;;kCAI9B,8OAAC;wBAAI,WAAU;kCACX,cAAA,8OAAC;4BACG,SAAS;4BACT,WAAU;;8CAEV,8OAAC;oCAAK,WAAU;8CAAwC;;;;;;8CACxD,8OAAC;oCAAK,WAAU;8CAAoB,EAAE,MAAM;;;;;;;;;;;;;;;;;kCAIpD,8OAAC;wBAAI,WAAU;;;;;;kCAEf,8OAAC;wBAAI,WAAU;wBAA+J,OAAO;4BAAC,iBAAiB;wBAA4C;;;;;;;;;;;;;;;;;;AAKnQ;uCAEe"}},
    {"offset": {"line": 530, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/services/relationshipService.ts"],"sourcesContent":["import { Connection, FamilyMember } from '../types';\n\n// Map of Source-to-Target Label -> Inverse (Target-to-Source) generic classification\n// Example: If A -> B is \"Son\", then B -> A is a \"Parent\"\nconst INVERSE_MAP: Record<string, string> = {\n    'son': 'parent',\n    'daughter': 'parent',\n    'child': 'parent',\n    'father': 'child',\n    'mother': 'child',\n    'parent': 'child',\n    'brother': 'sibling',\n    'sister': 'sibling',\n    'sibling': 'sibling',\n    'husband': 'wife',\n    'wife': 'husband',\n    'spouse': 'spouse',\n    'ex-husband': 'ex-wife',\n    'ex-wife': 'ex-husband',\n    'partner': 'partner'\n};\n\nconst getInverseLabel = (originalLabel: string, sourceMember: FamilyMember): string => {\n    const lowerLabel = originalLabel.toLowerCase();\n    const genericInverse = INVERSE_MAP[lowerLabel] || 'relative';\n\n    if (genericInverse === 'parent') {\n        return sourceMember.gender === 'male' ? 'Father' : 'Mother';\n    }\n    if (genericInverse === 'child') {\n        return sourceMember.gender === 'male' ? 'Son' : 'Daughter';\n    }\n    if (genericInverse === 'sibling') {\n        return sourceMember.gender === 'male' ? 'Brother' : 'Sister';\n    }\n    // For specific matches like husband/wife, return the map value directly if it exists, else capitalised generic\n    if (INVERSE_MAP[lowerLabel]) return INVERSE_MAP[lowerLabel].charAt(0).toUpperCase() + INVERSE_MAP[lowerLabel].slice(1);\n\n    return genericInverse.charAt(0).toUpperCase() + genericInverse.slice(1);\n};\n\n/**\n * Calculates the relationship string for a target node relative to the \"Self\" node.\n * Handles both direct and reverse connections.\n */\nexport const calculateRelationshipToSelf = (\n    targetId: string, \n    members: FamilyMember[], \n    connections: Connection[],\n    isChinese: boolean\n): string | null => {\n    const selfNode = members.find(m => m.isSelf);\n    if (!selfNode || selfNode.id === targetId) return null;\n\n    // Build Adjacency List\n    // We store { to: string, label: string }\n    const adj: Record<string, { to: string, label: string }[]> = {};\n    \n    connections.forEach(conn => {\n        if (!adj[conn.sourceId]) adj[conn.sourceId] = [];\n        if (!adj[conn.targetId]) adj[conn.targetId] = [];\n        \n        const sourceMember = members.find(m => m.id === conn.sourceId);\n        const targetMember = members.find(m => m.id === conn.targetId);\n\n        if (!sourceMember || !targetMember) return;\n\n        // 1. Forward Edge: Source -> Target\n        // If the label is \"Son\", it means Target is the Son of Source.\n        // So traversal Source -> Target yields \"Son\".\n        adj[conn.sourceId].push({ \n            to: conn.targetId, \n            label: isChinese && conn.labelZh ? conn.labelZh : conn.label \n        });\n        \n        // 2. Reverse Edge: Target -> Source\n        // If the label is \"Son\" (Target is Son of Source),\n        // Then traversal Target -> Source means Source is \"Father\" (if male) of Target.\n        const inverseLabel = isChinese \n            ? \"长辈/亲属\" // Simplified for Chinese dynamic calculation, ideally needs a similar map\n            : getInverseLabel(conn.label, sourceMember);\n\n        // Simple Chinese mapping override for common terms\n        let finalInverse = inverseLabel;\n        if (isChinese) {\n             const mapZh: Record<string, string> = {\n                'Son': '父亲', 'Daughter': '父亲', // If source is male\n                'Father': '儿子', 'Mother': '儿子', // If source is male\n             };\n             // A proper Chinese kinship algo is complex, falling back to English logic or basic string\n             // For this demo, we will rely on the English calculation and basic translation or user manual input\n             // Ideally, Chinese requires specific fields. We will stick to the generated English one or generic.\n             finalInverse = \"Linked\"; // Placeholder for complex CH logic, or reuse English logic translated\n             if (inverseLabel === 'Father') finalInverse = '父亲';\n             if (inverseLabel === 'Mother') finalInverse = '母亲';\n             if (inverseLabel === 'Son') finalInverse = '儿子';\n             if (inverseLabel === 'Daughter') finalInverse = '女儿';\n             if (inverseLabel === 'Brother') finalInverse = '兄弟';\n             if (inverseLabel === 'Sister') finalInverse = '姐妹';\n             if (inverseLabel === 'Wife') finalInverse = '妻子';\n             if (inverseLabel === 'Husband') finalInverse = '丈夫';\n        }\n\n        adj[conn.targetId].push({ \n            to: conn.sourceId, \n            label: finalInverse\n        });\n    });\n\n    // BFS\n    const queue: { id: string, path: string[] }[] = [{ id: selfNode.id, path: [] }];\n    const visited = new Set<string>([selfNode.id]);\n\n    while (queue.length > 0) {\n        const { id, path } = queue.shift()!;\n        \n        if (id === targetId) {\n            return path.join(' › ');\n        }\n\n        const neighbors = adj[id] || [];\n        for (const neighbor of neighbors) {\n            if (!visited.has(neighbor.to)) {\n                visited.add(neighbor.to);\n                // Limit depth\n                if (path.length < 3) {\n                    queue.push({ \n                        id: neighbor.to, \n                        path: [...path, neighbor.label] \n                    });\n                }\n            }\n        }\n    }\n\n    return null;\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 658, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/components/EditConnectionModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Connection, HandleType, LineStyle, ArrowType, ArrowSize, ArrowOptions } from '../types';\nimport { translations } from '../locales';\n\ninterface EditConnectionModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onSave: (conn: Connection) => void;\n    onDelete: (id: string) => void;\n    connection: Connection | null;\n    lang: 'en' | 'zh';\n}\n\nconst EditConnectionModal: React.FC<EditConnectionModalProps> = ({ isOpen, onClose, onSave, onDelete, connection, lang }) => {\n    const t = translations[lang];\n    const [formData, setFormData] = useState<Partial<Connection>>({});\n\n    useEffect(() => {\n        if (isOpen && connection) {\n            setFormData({ \n                ...connection,\n                color: connection.color || '#80ec13',\n                lineStyle: connection.lineStyle || 'solid',\n                arrowOptions: connection.arrowOptions || {\n                    type: 'solid',\n                    size: 'medium',\n                    direction: 'target'\n                }\n            });\n        }\n    }, [isOpen, connection]);\n\n    if (!isOpen || !connection) return null;\n\n    const handles: HandleType[] = ['top', 'right', 'bottom', 'left'];\n    const styles: LineStyle[] = ['solid', 'dashed', 'dotted'];\n    const arrowTypes: ArrowType[] = ['none', 'solid', 'hollow', 'circle', 'diamond'];\n    const arrowSizes: ArrowSize[] = ['short', 'medium', 'long'];\n\n    const PRESETS = [\n        { en: 'Father', zh: '父亲' },\n        { en: 'Mother', zh: '母亲' },\n        { en: 'Son', zh: '儿子' },\n        { en: 'Daughter', zh: '女儿' },\n        { en: 'Husband', zh: '丈夫' },\n        { en: 'Wife', zh: '妻子' },\n        { en: 'Brother', zh: '兄弟' },\n        { en: 'Sister', zh: '姐妹' },\n        { en: 'Ex-Husband', zh: '前夫' },\n        { en: 'Ex-Wife', zh: '前妻' },\n    ];\n\n    const applyPreset = (p: {en: string, zh: string}) => {\n        setFormData(prev => ({ ...prev, label: p.en, labelZh: p.zh }));\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 animate-[fadeIn_0.2s_ease-out]\">\n                <div className=\"px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-900/50\">\n                    <h3 className=\"font-bold text-lg text-slate-900 dark:text-white\">Edit Connection</h3>\n                </div>\n                \n                <div className=\"p-6 space-y-5\">\n                    \n                    {/* Presets */}\n                    <div>\n                        <label className=\"text-xs font-bold text-gray-500 uppercase mb-2 block\">Quick Presets</label>\n                        <div className=\"flex flex-wrap gap-2\">\n                            {PRESETS.map((p, i) => (\n                                <button \n                                    key={i}\n                                    onClick={() => applyPreset(p)}\n                                    className=\"px-3 py-1.5 text-xs font-medium bg-gray-100 dark:bg-white/10 hover:bg-primary/20 hover:text-primary-dark dark:hover:text-primary rounded-lg transition-colors border border-transparent hover:border-primary/30\"\n                                >\n                                    {lang === 'zh' ? p.zh : p.en}\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.connectionLabel}</label>\n                            <input \n                                className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.label || ''}\n                                onChange={e => setFormData({...formData, label: e.target.value})}\n                            />\n                        </div>\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.connectionLabelZh}</label>\n                            <input \n                                className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.labelZh || ''}\n                                onChange={e => setFormData({...formData, labelZh: e.target.value})}\n                            />\n                        </div>\n                    </div>\n\n                    {/* Handles */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.sourceHandle}</label>\n                            <select \n                                className=\"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.sourceHandle}\n                                onChange={e => setFormData({...formData, sourceHandle: e.target.value as HandleType})}\n                            >\n                                {handles.map(h => <option key={h} value={h}>{t[h]}</option>)}\n                            </select>\n                        </div>\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.targetHandle}</label>\n                            <select \n                                className=\"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.targetHandle}\n                                onChange={e => setFormData({...formData, targetHandle: e.target.value as HandleType})}\n                            >\n                                {handles.map(h => <option key={h} value={h}>{t[h]}</option>)}\n                            </select>\n                        </div>\n                    </div>\n\n                    {/* Styling */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.lineColor}</label>\n                            <div className=\"flex items-center gap-2 bg-gray-50 dark:bg-gray-900 p-1.5 rounded-lg border border-gray-200 dark:border-gray-700\">\n                                <input \n                                    type=\"color\" \n                                    className=\"h-8 w-8 p-0 border-0 rounded cursor-pointer bg-transparent\"\n                                    value={formData.color || '#80ec13'}\n                                    onChange={e => setFormData({...formData, color: e.target.value})}\n                                />\n                                <span className=\"text-xs text-gray-500 font-mono\">{formData.color}</span>\n                            </div>\n                        </div>\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.lineStyle}</label>\n                            <select \n                                className=\"w-full px-2 py-2.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.lineStyle}\n                                onChange={e => setFormData({...formData, lineStyle: e.target.value as LineStyle})}\n                            >\n                                {styles.map(s => <option key={s} value={s}>{t[s]}</option>)}\n                            </select>\n                        </div>\n                    </div>\n\n                    {/* Arrow Options */}\n                    <div className=\"space-y-3\">\n                        <label className=\"text-xs font-bold text-gray-500 uppercase block\">{t.arrowOptions}</label>\n                        <div className=\"grid grid-cols-3 gap-4\">\n                            <div className=\"space-y-1\">\n                                <label className=\"text-xs font-medium text-gray-500\">{t.arrowType}</label>\n                                <select \n                                    className=\"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none\"\n                                    value={(formData.arrowOptions as ArrowOptions)?.type || 'solid'}\n                                    onChange={e => setFormData({...formData, arrowOptions: {...(formData.arrowOptions as ArrowOptions), type: e.target.value as ArrowType}})}\n                                >\n                                    {arrowTypes.map(t => <option key={t} value={t}>{t}</option>)}\n                                </select>\n                            </div>\n                            <div className=\"space-y-1\">\n                                <label className=\"text-xs font-medium text-gray-500\">{t.arrowSize}</label>\n                                <select \n                                    className=\"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none\"\n                                    value={(formData.arrowOptions as ArrowOptions)?.size || 'medium'}\n                                    onChange={e => setFormData({...formData, arrowOptions: {...(formData.arrowOptions as ArrowOptions), size: e.target.value as ArrowSize}})}\n                                >\n                                    {arrowSizes.map(s => <option key={s} value={s}>{s}</option>)}\n                                </select>\n                            </div>\n                            <div className=\"space-y-1\">\n                                <label className=\"text-xs font-medium text-gray-500\">{t.arrowDirection}</label>\n                                <select \n                                    className=\"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none\"\n                                    value={(formData.arrowOptions as ArrowOptions)?.direction || 'target'}\n                                    onChange={e => setFormData({...formData, arrowOptions: {...(formData.arrowOptions as ArrowOptions), direction: e.target.value as 'source' | 'target' | 'both'}})}\n                                >\n                                    <option value=\"source\">{t.source}</option>\n                                    <option value=\"target\">{t.target}</option>\n                                    <option value=\"both\">{t.both}</option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"p-6 pt-2 flex gap-3\">\n                     <button \n                        onClick={() => { onDelete(connection.id); onClose(); }} \n                        className=\"p-3 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors\"\n                        title={t.delete}\n                    >\n                        <span className=\"material-symbols-outlined\">delete</span>\n                    </button>\n                    <button onClick={onClose} className=\"flex-1 py-3 rounded-xl font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\">\n                        {t.cancel}\n                    </button>\n                    <button \n                        onClick={() => onSave(formData as Connection)} \n                        className=\"flex-1 py-3 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl font-bold transition-colors shadow-lg shadow-primary/20\"\n                    >\n                        {t.save}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default EditConnectionModal;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1293, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/views/TreeView.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useMemo } from 'react';\nimport { FamilyMember, Connection, HandleType } from '../types';\nimport { dbService } from '../services/dbService';\nimport { calculateRelationshipToSelf } from '../services/relationshipService';\nimport { translations } from '../locales';\nimport EditConnectionModal from '../components/EditConnectionModal';\n\ninterface TreeViewProps {\n    selectedId: string | null;\n    onSelect: (id: string) => void;\n    showChinese: boolean;\n    members: FamilyMember[];\n    connections: Connection[];\n    onDataChange: () => void;\n    onEditMember: (member: FamilyMember) => void; // Callback to open App-level modal\n}\n\nconst CARD_WIDTH = 260; \nconst CARD_HEIGHT = 100;\n\nconst TreeView: React.FC<TreeViewProps> = ({ selectedId, onSelect, showChinese, members, connections, onDataChange, onEditMember }) => {\n    const lang = showChinese ? 'zh' : 'en';\n    const t = translations[lang];\n\n    // Local UI State\n    const [scale, setScale] = useState(1);\n    const [offset, setOffset] = useState({ x: 0, y: 0 });\n    const [isLocked, setIsLocked] = useState(true);\n    \n    // Local members state for drag operations\n    const [localMembers, setLocalMembers] = useState<FamilyMember[]>(members);\n    \n    // Interaction States\n    const [draggingNodeId, setDraggingNodeId] = useState<string | null>(null);\n    const [connectingStart, setConnectingStart] = useState<{id: string, handle: HandleType} | null>(null);\n    const [tempLineEnd, setTempLineEnd] = useState<{x: number, y: number} | null>(null);\n    \n    // Alignment Guides\n    const [alignmentGuides, setAlignmentGuides] = useState<{\n        horizontal: number[];\n        vertical: number[];\n    }>({ horizontal: [], vertical: [] });\n    const [snapPosition, setSnapPosition] = useState<{x: number, y: number} | null>(null);\n    \n    // Batch Operations\n    const [selectedMemberIds, setSelectedMemberIds] = useState<string[]>([]);\n    \n    // Drag Tracking for click detection\n    const isDragging = useRef(false);\n    const clickStartPos = useRef({ x: 0, y: 0 });\n    const DRAG_THRESHOLD = 5; // Minimum pixels to consider as drag\n\n    // Modals (Only Connection modal stays local as it's view-specific interaction, member modal is global)\n    const [isConnModalOpen, setIsConnModalOpen] = useState(false);\n    const [editingConnection, setEditingConnection] = useState<Connection | null>(null);\n\n    // Pending Connection (Dragging line to empty space)\n    const [pendingConnection, setPendingConnection] = useState<{sourceId: string, sourceHandle: HandleType, endX: number, endY: number} | null>(null);\n\n    const containerRef = useRef<HTMLDivElement>(null);\n    const isCanvasDragging = useRef(false);\n    const lastPos = useRef({ x: 0, y: 0 });\n\n    // Sync local members when props change\n    useEffect(() => {\n        setLocalMembers(members);\n    }, [members]);\n\n    // Center on mount only\n    useEffect(() => {\n        centerOnSelf();\n    }, []); // Only on mount, not when members change\n    \n    // Remove auto-centering on scale change to allow mouse-position based zoom\n\n    const centerOnSelf = () => {\n        const self = localMembers.find(m => m.isSelf);\n        if (self && containerRef.current) {\n            const { width, height } = containerRef.current.getBoundingClientRect();\n            setOffset({\n                x: (width / 2) - self.x * scale,\n                y: (height / 2) - self.y * scale\n            });\n        }\n    };\n\n    const getHandlePosition = (x: number, y: number, handle: HandleType) => {\n        const cx = x; \n        const cy = y;\n        switch(handle) {\n            case 'top': return { x: cx + CARD_WIDTH/2, y: cy };\n            case 'right': return { x: cx + CARD_WIDTH, y: cy + CARD_HEIGHT/2 };\n            case 'bottom': return { x: cx + CARD_WIDTH/2, y: cy + CARD_HEIGHT };\n            case 'left': return { x: cx, y: cy + CARD_HEIGHT/2 };\n        }\n    };\n\n    const generatePath = (\n        startX: number, startY: number, startHandle: HandleType,\n        endX: number, endY: number, endHandle: HandleType\n    ) => {\n        const dist = Math.abs(endX - startX) + Math.abs(endY - startY);\n        const controlDist = Math.min(200, Math.max(50, dist * 0.4));\n\n        const getControl = (x: number, y: number, h: HandleType, d: number) => {\n            switch(h) {\n                case 'top': return { x, y: y - d };\n                case 'bottom': return { x, y: y + d };\n                case 'left': return { x: x - d, y };\n                case 'right': return { x: x + d, y };\n            }\n        };\n\n        const cp1 = getControl(startX, startY, startHandle, controlDist);\n        const cp2 = getControl(endX, endY, endHandle, controlDist);\n\n        return `M ${startX} ${startY} C ${cp1.x} ${cp1.y}, ${cp2.x} ${cp2.y}, ${endX} ${endY}`;\n    };\n\n    const getDashArray = (style?: string) => {\n        switch(style) {\n            case 'dashed': return '8 4';\n            case 'dotted': return '2 2';\n            default: return '';\n        }\n    };\n\n    const getArrowMarker = (type?: string, size?: string) => {\n        if (!type || type === 'none') return '';\n        if (type === 'circle' || type === 'diamond') {\n            return `url(#arrow-${type})`;\n        }\n        return `url(#arrow-${type}-${size || 'medium'})`;\n    };\n\n    // --- Alignment Functions ---\n\n    const GRID_SIZE = 20; // Grid snap size in pixels\n    const ALIGNMENT_THRESHOLD = 5; // Threshold for alignment in pixels\n\n    const calculateAlignmentGuides = (draggingNode: FamilyMember, dx: number, dy: number) => {\n        const guides = { horizontal: [] as number[], vertical: [] as number[] };\n        const newX = draggingNode.x + dx / scale;\n        const newY = draggingNode.y + dy / scale;\n\n        // Calculate grid snap positions\n        const gridSnapX = Math.round(newX / GRID_SIZE) * GRID_SIZE;\n        const gridSnapY = Math.round(newY / GRID_SIZE) * GRID_SIZE;\n\n        // Check alignment with other nodes\n        localMembers.forEach(member => {\n            if (member.id === draggingNode.id) return;\n\n            // Horizontal alignment (same y position)\n            const yDiff = Math.abs(newY - member.y);\n            if (yDiff < ALIGNMENT_THRESHOLD) {\n                guides.horizontal.push(member.y);\n            }\n\n            // Vertical alignment (same x position)\n            const xDiff = Math.abs(newX - member.x);\n            if (xDiff < ALIGNMENT_THRESHOLD) {\n                guides.vertical.push(member.x);\n            }\n\n            // Center alignment\n            const centerYDiff = Math.abs(newY - (member.y + CARD_HEIGHT / 2));\n            if (centerYDiff < ALIGNMENT_THRESHOLD) {\n                guides.horizontal.push(member.y + CARD_HEIGHT / 2);\n            }\n\n            const centerXDiff = Math.abs(newX - (member.x + CARD_WIDTH / 2));\n            if (centerXDiff < ALIGNMENT_THRESHOLD) {\n                guides.vertical.push(member.x + CARD_WIDTH / 2);\n            }\n        });\n\n        return {\n            guides,\n            snapPosition: {\n                x: gridSnapX,\n                y: gridSnapY\n            }\n        };\n    };\n\n    const getSnappedPosition = (x: number, y: number, draggingNode: FamilyMember) => {\n        const { guides, snapPosition: gridSnap } = calculateAlignmentGuides(draggingNode, 0, 0);\n\n        // Check if we should snap to alignment guides\n        let snappedX = x;\n        let snappedY = y;\n\n        // Check horizontal alignment\n        for (const guideY of guides.horizontal) {\n            if (Math.abs(y - guideY) < ALIGNMENT_THRESHOLD) {\n                snappedY = guideY;\n                break;\n            }\n        }\n\n        // Check vertical alignment\n        for (const guideX of guides.vertical) {\n            if (Math.abs(x - guideX) < ALIGNMENT_THRESHOLD) {\n                snappedX = guideX;\n                break;\n            }\n        }\n\n        // If no alignment guides, snap to grid\n        if (snappedX === x) {\n            snappedX = gridSnap.x;\n        }\n        if (snappedY === y) {\n            snappedY = gridSnap.y;\n        }\n\n        return { x: snappedX, y: snappedY };\n    };\n\n    // --- Interaction Handlers ---\n\n    const handleMouseDown = (e: React.MouseEvent) => {\n        if (!e.target || (e.target as HTMLElement).closest('.node-card, button, .handle')) return;\n        isCanvasDragging.current = true;\n        lastPos.current = { x: e.clientX, y: e.clientY };\n    };\n\n    const handleMouseMove = (e: React.MouseEvent) => {\n        const dx = e.clientX - lastPos.current.x;\n        const dy = e.clientY - lastPos.current.y;\n        lastPos.current = { x: e.clientX, y: e.clientY };\n\n        if (draggingNodeId && !isLocked) {\n            const draggingNode = localMembers.find(m => m.id === draggingNodeId);\n            if (draggingNode) {\n                // Calculate alignment guides and snap position\n                const { guides, snapPosition: gridSnap } = calculateAlignmentGuides(draggingNode, dx, dy);\n                \n                // Update alignment guides state\n                setAlignmentGuides(guides);\n                setSnapPosition(gridSnap);\n\n                // Update local state for smooth dragging\n                setLocalMembers(prev => \n                    prev.map(member => \n                        member.id === draggingNodeId\n                            ? { ...member, x: member.x + dx / scale, y: member.y + dy / scale }\n                            : member\n                    )\n                );\n            }\n        } else if (connectingStart) {\n            if (containerRef.current) {\n                const rect = containerRef.current.getBoundingClientRect();\n                const mx = (e.clientX - rect.left - offset.x) / scale;\n                const my = (e.clientY - rect.top - offset.y) / scale;\n                setTempLineEnd({ x: mx, y: my });\n            }\n        } else if (isCanvasDragging.current) {\n            setOffset(prev => ({ x: prev.x + dx, y: prev.y + dy }));\n        }\n    };\n\n    const handleMouseUp = () => {\n        if (draggingNodeId) {\n            const member = localMembers.find(m => m.id === draggingNodeId);\n            if (member) {\n                // Apply snap position if available\n                if (snapPosition) {\n                    const snappedMember = { ...member, x: snapPosition.x, y: snapPosition.y };\n                    // Update local state immediately for visual feedback\n                    setLocalMembers(prev => \n                        prev.map(m => m.id === draggingNodeId ? snappedMember : m)\n                    );\n                    // Save to database with snapped position\n                    dbService.updateMember(snappedMember);\n                } else {\n                    // Save original position\n                    dbService.updateMember(member);\n                }\n                onDataChange();\n            }\n            setDraggingNodeId(null);\n            // Reset alignment guides\n            setAlignmentGuides({ horizontal: [], vertical: [] });\n            setSnapPosition(null);\n        }\n        \n        // Drop to create new member\n        if (connectingStart && tempLineEnd) {\n            const newX = tempLineEnd.x - (CARD_WIDTH/2);\n            const newY = tempLineEnd.y - (CARD_HEIGHT/2);\n            \n            // Apply grid snap to new member position\n            const snappedX = Math.round(newX / GRID_SIZE) * GRID_SIZE;\n            const snappedY = Math.round(newY / GRID_SIZE) * GRID_SIZE;\n            \n            // Create a temporary object to pass to the modal logic\n            const newId = crypto.randomUUID();\n            const newMember: FamilyMember = {\n                id: newId,\n                name: '',\n                role: '',\n                x: snappedX,\n                y: snappedY,\n                gender: 'male',\n                avatar: `https://picsum.photos/seed/${Date.now()}/200/200`\n            };\n\n            // Simplest: Create the member with default values, save to DB, add connection, then open Modal.\n            dbService.addMember(newMember);\n            \n            const newConn: Connection = {\n                id: crypto.randomUUID(),\n                sourceId: connectingStart.id,\n                targetId: newId,\n                sourceHandle: connectingStart.handle,\n                targetHandle: 'top',\n                label: 'Relation',\n                labelZh: '关系'\n            };\n            dbService.addConnection(newConn);\n            \n            onDataChange(); // Refresh parent\n            setTimeout(() => onEditMember(newMember), 50); // Open modal for the new member\n        }\n\n        setConnectingStart(null);\n        setTempLineEnd(null);\n        isCanvasDragging.current = false;\n    };\n\n    // --- Logic Handlers ---\n\n    const onHandleMouseDown = (e: React.MouseEvent, id: string, handle: HandleType) => {\n        e.stopPropagation();\n        if (isLocked) return;\n        setConnectingStart({ id, handle });\n    };\n\n    const onHandleMouseUp = (e: React.MouseEvent, targetId: string, targetHandle: HandleType) => {\n        e.stopPropagation();\n        if (connectingStart && connectingStart.id !== targetId) {\n            const newConn: Connection = {\n                id: crypto.randomUUID(),\n                sourceId: connectingStart.id,\n                targetId,\n                sourceHandle: connectingStart.handle,\n                targetHandle,\n                label: 'Relation',\n                labelZh: '关系'\n            };\n            dbService.addConnection(newConn);\n            onDataChange();\n        }\n        setConnectingStart(null);\n        setTempLineEnd(null);\n    };\n\n    const handleSaveConnection = (conn: Connection) => {\n        dbService.updateConnection(conn);\n        onDataChange();\n        setIsConnModalOpen(false);\n        setEditingConnection(null);\n    };\n\n    const handleDeleteConnection = (id: string) => {\n        dbService.deleteConnection(id);\n        onDataChange();\n    };\n\n    const handleEditClick = (e: React.MouseEvent, node: FamilyMember) => {\n        e.stopPropagation();\n        onEditMember(node);\n    };\n\n    // --- Relationship Cache ---\n\n    const relationshipCache = useMemo(() => {\n        const cache = new Map<string, string | null>();\n        localMembers.forEach(member => {\n            const relationPath = calculateRelationshipToSelf(member.id, localMembers, connections, showChinese);\n            cache.set(member.id, relationPath);\n        });\n        return cache;\n    }, [localMembers, connections, showChinese]);\n\n    // --- Empty State ---\n    if (localMembers.length === 0) {\n        return (\n            <div className=\"flex-1 flex flex-col items-center justify-center bg-background-light dark:bg-background-dark p-6\">\n                <div className=\"text-center space-y-6 max-w-md\">\n                    <div className=\"w-24 h-24 bg-primary/20 rounded-full flex items-center justify-center mx-auto text-primary\">\n                        <span className=\"material-symbols-outlined text-5xl\">forest</span>\n                    </div>\n                    <div>\n                        <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">{t.emptyStateTitle}</h2>\n                        <p className=\"text-gray-500 dark:text-gray-400\">{t.emptyStateDesc}</p>\n                    </div>\n                    <button \n                        onClick={() => { \n                             const newMember = { id: crypto.randomUUID(), name: '', role: 'Me', x: 0, y: 0, gender: 'male', avatar: 'https://picsum.photos/200', isSelf: true } as FamilyMember;\n                             onEditMember(newMember);\n                        }}\n                        className=\"px-8 py-3 bg-primary hover:bg-primary-dark text-slate-900 font-bold rounded-xl shadow-lg shadow-primary/20 transition-all hover:scale-105\"\n                    >\n                        {t.addCenterMember}\n                    </button>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div \n            className=\"flex-1 relative overflow-hidden bg-background-light dark:bg-background-dark cursor-grab active:cursor-grabbing h-full selection:bg-none\"\n            onMouseDown={handleMouseDown}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onMouseLeave={handleMouseUp}\n            onWheel={(e) => {\n                e.preventDefault();\n                // Zoom in/out regardless of lock state\n                const delta = e.deltaY > 0 ? -0.1 : 0.1;\n                const newScale = Math.max(0.5, Math.min(2, scale + delta));\n                \n                if (containerRef.current) {\n                    const rect = containerRef.current.getBoundingClientRect();\n                    // Get mouse position relative to container\n                    const mouseX = e.clientX - rect.left;\n                    const mouseY = e.clientY - rect.top;\n                    \n                    // Calculate the point under the mouse in the scaled coordinate system\n                    const oldMouseX = (mouseX - offset.x) / scale;\n                    const oldMouseY = (mouseY - offset.y) / scale;\n                    \n                    // Calculate new offset to keep the mouse point fixed\n                    const newOffsetX = mouseX - oldMouseX * newScale;\n                    const newOffsetY = mouseY - oldMouseY * newScale;\n                    \n                    setScale(newScale);\n                    setOffset({ x: newOffsetX, y: newOffsetY });\n                } else {\n                    setScale(newScale);\n                }\n            }}\n            ref={containerRef}\n        >\n            {/* Grid */}\n            <div className=\"absolute inset-0 bg-grid-pattern dark:bg-grid-pattern-dark bg-grid opacity-40 pointer-events-none\"></div>\n\n            <div \n                className=\"absolute inset-0 transform-gpu transition-transform duration-75 origin-top-left\"\n                style={{ transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})` }}\n            >\n                {/* Alignment Guides Layer */}\n                <svg className=\"absolute top-0 left-0 overflow-visible z-10\" style={{ width: 1, height: 1 }}>\n                    {/* Horizontal Guides */}\n                    {alignmentGuides.horizontal.map((y, index) => (\n                        <line\n                            key={`h-${index}`}\n                            x1=\"0\"\n                            y1={y}\n                            x2=\"10000\"\n                            y2={y}\n                            stroke=\"#80ec13\"\n                            strokeWidth=\"2\"\n                            strokeDasharray=\"5,5\"\n                            className=\"animate-pulse\"\n                        />\n                    ))}\n                    \n                    {/* Vertical Guides */}\n                    {alignmentGuides.vertical.map((x, index) => (\n                        <line\n                            key={`v-${index}`}\n                            x1={x}\n                            y1=\"0\"\n                            x2={x}\n                            y2=\"10000\"\n                            stroke=\"#80ec13\"\n                            strokeWidth=\"2\"\n                            strokeDasharray=\"5,5\"\n                            className=\"animate-pulse\"\n                        />\n                    ))}\n                </svg>\n\n                {/* SVG Connections Layer */}\n                <svg className=\"absolute top-0 left-0 overflow-visible z-0\" style={{ width: 1, height: 1 }}>\n                    {/* Arrow Markers Definitions */}\n                    <defs>\n                        {/* Solid Arrows */}\n                        <marker id=\"arrow-solid-short\" markerWidth=\"10\" markerHeight=\"7\" refX=\"9\" refY=\"3.5\" orient=\"auto\">\n                            <polygon points=\"0 0, 10 3.5, 0 7\" fill=\"currentColor\" />\n                        </marker>\n                        <marker id=\"arrow-solid-medium\" markerWidth=\"14\" markerHeight=\"9\" refX=\"13\" refY=\"4.5\" orient=\"auto\">\n                            <polygon points=\"0 0, 14 4.5, 0 9\" fill=\"currentColor\" />\n                        </marker>\n                        <marker id=\"arrow-solid-long\" markerWidth=\"18\" markerHeight=\"11\" refX=\"17\" refY=\"5.5\" orient=\"auto\">\n                            <polygon points=\"0 0, 18 5.5, 0 11\" fill=\"currentColor\" />\n                        </marker>\n                        \n                        {/* Hollow Arrows */}\n                        <marker id=\"arrow-hollow-short\" markerWidth=\"10\" markerHeight=\"7\" refX=\"9\" refY=\"3.5\" orient=\"auto\">\n                            <polygon points=\"0 0, 10 3.5, 0 7\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" />\n                        </marker>\n                        <marker id=\"arrow-hollow-medium\" markerWidth=\"14\" markerHeight=\"9\" refX=\"13\" refY=\"4.5\" orient=\"auto\">\n                            <polygon points=\"0 0, 14 4.5, 0 9\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" />\n                        </marker>\n                        <marker id=\"arrow-hollow-long\" markerWidth=\"18\" markerHeight=\"11\" refX=\"17\" refY=\"5.5\" orient=\"auto\">\n                            <polygon points=\"0 0, 18 5.5, 0 11\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" />\n                        </marker>\n                        \n                        {/* Circle */}\n                        <marker id=\"arrow-circle\" markerWidth=\"10\" markerHeight=\"10\" refX=\"9\" refY=\"5\" orient=\"auto\">\n                            <circle cx=\"5\" cy=\"5\" r=\"4\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" />\n                        </marker>\n                        \n                        {/* Diamond */}\n                        <marker id=\"arrow-diamond\" markerWidth=\"12\" markerHeight=\"12\" refX=\"11\" refY=\"6\" orient=\"auto\">\n                            <polygon points=\"6 0, 12 6, 6 12, 0 6\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" />\n                        </marker>\n                    </defs>\n                    {/* Existing Connections */}\n                    {connections.map((conn) => {\n                        const source = localMembers.find(m => m.id === conn.sourceId);\n                        const target = localMembers.find(m => m.id === conn.targetId);\n                        if (!source || !target) return null;\n                        const start = getHandlePosition(source.x, source.y, conn.sourceHandle);\n                        const end = getHandlePosition(target.x, target.y, conn.targetHandle);\n                        const path = generatePath(start.x, start.y, conn.sourceHandle, end.x, end.y, conn.targetHandle);\n                        \n                        // Center label\n                        const midX = (start.x + end.x) / 2;\n                        const midY = (start.y + end.y) / 2;\n                        \n                        const color = conn.color || (showChinese ? '#e5e7eb' : '#e5e7eb'); \n\n                        return (\n                            <g key={conn.id} className=\"group cursor-pointer\" onClick={(e) => { e.stopPropagation(); setEditingConnection(conn); setIsConnModalOpen(true); }}>\n                                <path d={path} fill=\"none\" stroke=\"transparent\" strokeWidth={15} />\n                                <path \n                                    d={path}\n                                    fill=\"none\"\n                                    stroke={conn.color || '#e5e7eb'}\n                                    strokeWidth={3}\n                                    strokeDasharray={getDashArray(conn.lineStyle)}\n                                    markerEnd={conn.arrowOptions ? getArrowMarker(conn.arrowOptions.type, conn.arrowOptions.size) : ''}\n                                    className=\"dark:stroke-gray-600 transition-colors group-hover:stroke-primary/80\"\n                                />\n                                <foreignObject x={midX - 40} y={midY - 12} width={80} height={24}>\n                                    <div \n                                        className=\"flex items-center justify-center px-2 py-0.5 bg-white dark:bg-gray-800 border rounded-full shadow-sm text-[10px] font-bold text-center truncate select-none hover:scale-110 transition-transform\"\n                                        style={{ borderColor: conn.color || '#80ec13', color: conn.color || 'inherit' }}\n                                    >\n                                        {showChinese && conn.labelZh ? conn.labelZh : conn.label}\n                                    </div>\n                                </foreignObject>\n                            </g>\n                        );\n                    })}\n\n                    {/* Temporary Dragging Line */}\n                    {connectingStart && tempLineEnd && (\n                        <path \n                            d={`M ${getHandlePosition(\n                                localMembers.find(m => m.id === connectingStart.id)!.x, \n                                localMembers.find(m => m.id === connectingStart.id)!.y, \n                                connectingStart.handle\n                            ).x} ${getHandlePosition(\n                                localMembers.find(m => m.id === connectingStart.id)!.x, \n                                localMembers.find(m => m.id === connectingStart.id)!.y, \n                                connectingStart.handle\n                            ).y} L ${tempLineEnd.x} ${tempLineEnd.y}`}\n                            fill=\"none\"\n                            stroke=\"#80ec13\"\n                            strokeWidth={2}\n                            strokeDasharray=\"5 5\"\n                        />\n                    )}\n                </svg>\n\n                {/* Nodes Layer */}\n                {localMembers.map((node) => {\n                    const relationPath = relationshipCache.get(node.id);\n\n                    return (\n                        <div \n                            key={node.id}\n                            className={`absolute node-card group ${isLocked ? '' : 'cursor-move'}`}\n                            style={{ \n                                transform: `translate(${node.x}px, ${node.y}px)`,\n                                width: CARD_WIDTH,\n                                height: CARD_HEIGHT\n                            }}\n                            onMouseDown={(e) => {\n                                e.stopPropagation();\n                                // Record click start position for drag detection\n                                clickStartPos.current = { x: e.clientX, y: e.clientY };\n                                isDragging.current = false;\n                                if(!isLocked) {\n                                    setDraggingNodeId(node.id);\n                                }\n                            }}\n                            onMouseMove={(e) => {\n                                // Detect drag movement\n                                if (Math.abs(e.clientX - clickStartPos.current.x) > DRAG_THRESHOLD ||\n                                    Math.abs(e.clientY - clickStartPos.current.y) > DRAG_THRESHOLD) {\n                                    isDragging.current = true;\n                                }\n                            }}\n                            onClick={(e) => {\n                                e.stopPropagation();\n                                // Only handle click if there was no drag\n                                if (!isDragging.current) {\n                                    if (e.ctrlKey || e.metaKey) {\n                                        // Toggle selection for batch operations\n                                        setSelectedMemberIds(prev => {\n                                            if (prev.includes(node.id)) {\n                                                return prev.filter(id => id !== node.id);\n                                            } else {\n                                                return [...prev, node.id];\n                                            }\n                                        });\n                                    } else if (e.shiftKey) {\n                                        // Add to selection for batch operations\n                                        setSelectedMemberIds(prev => [...prev, node.id]);\n                                    } else {\n                                        // Single selection\n                                        setSelectedMemberIds([node.id]);\n                                        onSelect(node.id);\n                                    }\n                                }\n                                // Reset drag flag\n                                isDragging.current = false;\n                            }}\n                            onDoubleClick={(e) => handleEditClick(e, node)}\n                        >\n                            {/* Connection Handles */}\n                            {!isLocked && (['top', 'right', 'bottom', 'left'] as HandleType[]).map(handle => (\n                                <div \n                                    key={handle}\n                                    className={`\n                                        absolute w-4 h-4 bg-white dark:bg-gray-800 border-2 border-primary rounded-full z-30 cursor-crosshair handle\n                                        transition-all hover:scale-150 hover:bg-primary\n                                        ${handle === 'top' ? '-top-2 left-1/2 -translate-x-1/2' : ''}\n                                        ${handle === 'right' ? '-right-2 top-1/2 -translate-y-1/2' : ''}\n                                        ${handle === 'bottom' ? '-bottom-2 left-1/2 -translate-x-1/2' : ''}\n                                        ${handle === 'left' ? '-left-2 top-1/2 -translate-y-1/2' : ''}\n                                        ${connectingStart ? 'opacity-100 scale-110' : 'opacity-0 group-hover:opacity-100'}\n                                    `}\n                                    onMouseDown={(e) => onHandleMouseDown(e, node.id, handle)}\n                                    onMouseUp={(e) => onHandleMouseUp(e, node.id, handle)}\n                                    title={t.connectPrompt}\n                                />\n                            ))}\n\n                            {/* Card Content */}\n                            <div className={`\n                                w-full h-full p-4 rounded-xl flex items-center gap-4 transition-all select-none\n                                ${selectedId === node.id \n                                    ? 'bg-card-light dark:bg-card-dark backdrop-blur-md ring-2 ring-primary shadow-xl border-primary' \n                                    : selectedMemberIds.includes(node.id)\n                                    ? 'bg-card-light dark:bg-card-dark backdrop-blur-md ring-2 ring-blue-500 shadow-xl border-blue-500'\n                                    : 'bg-card-light dark:bg-card-dark backdrop-blur-md border border-white/50 dark:border-white/10 shadow-lg hover:border-primary/50'\n                                }\n                            `}>\n                                <div className=\"relative\">\n                                    <div \n                                        className=\"w-14 h-14 rounded-full bg-cover bg-center border-2 border-white dark:border-gray-700 shadow-sm pointer-events-none\"\n                                        style={{backgroundImage: `url('${node.avatar}')`}}\n                                    ></div>\n                                    {node.isSelf && (\n                                         <div className=\"absolute -bottom-1 -right-1 flex items-center justify-center w-5 h-5 bg-primary rounded-full border-2 border-white dark:border-gray-800 text-[10px] font-bold text-slate-900\" title=\"Me\">\n                                            M\n                                         </div>\n                                    )}\n                                </div>\n                                <div className=\"flex-1 min-w-0 text-left pointer-events-none\">\n                                    <h3 className=\"text-slate-900 dark:text-white font-bold truncate\">\n                                        {showChinese && node.nameZh ? node.nameZh : node.name}\n                                    </h3>\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400 font-medium\">\n                                        {node.birthDate || 'Unknown'}\n                                    </p>\n                                    \n                                    {/* Calculated Relationship Path */}\n                                    {relationPath && (\n                                        <p className=\"text-[10px] text-primary-dark dark:text-primary font-bold mt-1 truncate\" title={relationPath}>\n                                            {relationPath}\n                                        </p>\n                                    )}\n                                    {!relationPath && (\n                                        <span className=\"inline-block mt-1 text-[10px] uppercase tracking-wider text-gray-400\">{node.role}</span>\n                                    )}\n                                </div>\n                                \n                                {/* Quick Actions */}\n                                {!isLocked && (\n                                    <button \n                                        onClick={(e) => handleEditClick(e, node)}\n                                        className=\"p-1.5 hover:bg-black/5 dark:hover:bg-white/10 rounded-lg text-gray-400 hover:text-primary transition-colors z-20 relative\"\n                                    >\n                                        <span className=\"material-symbols-outlined text-[18px]\">edit</span>\n                                    </button>\n                                )}\n                            </div>\n                        </div>\n                    );\n                })}\n            </div>\n\n            {/* Controls */}\n            <div className=\"absolute bottom-40 left-1/2 -translate-x-1/2 z-20 flex flex-col items-center gap-4\">\n                 <div className=\"flex items-center gap-2 p-2 bg-white/80 dark:bg-black/60 backdrop-blur-md rounded-2xl shadow-lg border border-white/20 dark:border-white/10\">\n                    <button \n                        onClick={() => setIsLocked(!isLocked)}\n                        className={`w-10 h-10 flex items-center justify-center rounded-xl transition-colors ${isLocked ? 'text-gray-500 hover:bg-black/5 dark:hover:bg-white/10' : 'text-primary bg-primary/10 ring-2 ring-primary/20'}`}\n                        title={isLocked ? t.unlock : t.lock}\n                    >\n                        <span className=\"material-symbols-outlined\">{isLocked ? 'lock' : 'lock_open'}</span>\n                    </button>\n                     <div className=\"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1\"></div>\n                    <button \n                        onClick={() => centerOnSelf()}\n                        className=\"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors\"\n                        title={t.centerOnMe}\n                    >\n                         <span className=\"material-symbols-outlined\">my_location</span>\n                    </button>\n                    <div className=\"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1\"></div>\n                    <button \n                        onClick={() => setScale(s => Math.max(0.5, s - 0.1))}\n                        className=\"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors\"\n                    >\n                        <span className=\"material-symbols-outlined\">remove</span>\n                    </button>\n                    <div className=\"px-2 text-sm font-semibold text-gray-600 dark:text-gray-300 min-w-[3rem] text-center\">\n                        {Math.round(scale * 100)}%\n                    </div>\n                    <button \n                        onClick={() => setScale(s => Math.min(2, s + 0.1))}\n                        className=\"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors\"\n                    >\n                        <span className=\"material-symbols-outlined\">add</span>\n                    </button>\n                </div>\n            </div>\n\n            {/* Add Member FAB */}\n            <div className=\"absolute bottom-40 right-8 z-20 flex flex-col gap-4 items-end\">\n                <button \n                    onClick={() => { \n                         const newMember = { id: crypto.randomUUID(), name: '', role: '', x: 0, y: 0, gender: 'male', avatar: 'https://picsum.photos/200' } as FamilyMember;\n                         onEditMember(newMember);\n                    }}\n                    className=\"w-16 h-16 bg-primary hover:bg-primary-dark text-slate-900 rounded-2xl shadow-[0_8px_30px_rgb(128,236,19,0.3)] flex items-center justify-center transition-all hover:scale-110 active:scale-95 group\"\n                    title={t.addMember}\n                >\n                    <span className=\"material-symbols-outlined text-3xl\">add</span>\n                </button>\n            </div>\n\n            <EditConnectionModal\n                isOpen={isConnModalOpen}\n                onClose={() => setIsConnModalOpen(false)}\n                onSave={handleSaveConnection}\n                onDelete={handleDeleteConnection}\n                connection={editingConnection}\n                lang={lang}\n            />\n        </div>\n    );\n};\n\nexport default TreeView;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2494, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/views/DirectoryView.tsx"],"sourcesContent":["import React from 'react';\nimport { FamilyMember } from '../types';\n\ninterface DirectoryViewProps {\n    onSelect: (id: string) => void;\n    showChinese: boolean;\n    members: FamilyMember[];\n}\n\nconst DirectoryView: React.FC<DirectoryViewProps> = ({ onSelect, showChinese, members }) => {\n\n    return (\n        <div className=\"flex-1 overflow-y-auto pt-24 pb-40 px-6 md:px-10 bg-background-light dark:bg-background-dark\">\n            <div className=\"max-w-[1400px] mx-auto flex flex-col gap-8\">\n                \n                {/* Stats */}\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <div className=\"flex flex-col gap-1 p-5 rounded-xl bg-white dark:bg-card-dark border border-gray-100 dark:border-white/5 shadow-sm\">\n                        <div className=\"flex justify-between items-start\">\n                            <p className=\"text-gray-500 dark:text-gray-400 text-sm font-medium\">Total Members</p>\n                            <span className=\"material-symbols-outlined text-primary\">groups</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{members.length}</p>\n                    </div>\n                </div>\n\n                {/* Grid */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                    {members.map((member) => (\n                        <div key={member.id} className=\"group relative flex flex-col bg-white dark:bg-card-dark rounded-xl border border-gray-100 dark:border-white/5 shadow-sm overflow-hidden transition-all hover:shadow-md hover:border-primary/50\">\n                            <div className=\"p-6 flex flex-col items-center gap-4 border-b border-gray-50 dark:border-white/5\">\n                                <div className=\"size-24 rounded-full bg-cover bg-center border-4 border-white dark:border-gray-700 shadow-sm group-hover:scale-105 transition-transform duration-300\" style={{backgroundImage: `url('${member.avatar}')`}}></div>\n                                <div className=\"text-center\">\n                                    <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">\n                                        {showChinese && member.nameZh ? member.nameZh : member.name}\n                                    </h3>\n                                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">{member.role}</p>\n                                </div>\n                                <div className=\"flex gap-2\">\n                                    <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-white/10 text-gray-600 dark:text-gray-300 capitalize\">\n                                        {member.gender}\n                                    </span>\n                                </div>\n                            </div>\n                            \n                            <div className=\"p-4 flex flex-col gap-3 text-sm\">\n                                <div className=\"flex items-center gap-3 text-gray-500 dark:text-gray-400\">\n                                    <span className=\"material-symbols-outlined text-[18px]\">cake</span>\n                                    <span>{member.birthDate || 'N/A'}</span>\n                                </div>\n                                <div className=\"flex items-center gap-3 text-gray-500 dark:text-gray-400\">\n                                    <span className=\"material-symbols-outlined text-[18px]\">location_on</span>\n                                    <span>{member.location || 'N/A'}</span>\n                                </div>\n                            </div>\n\n                            <div className=\"mt-auto p-4 bg-gray-50 dark:bg-white/5 flex items-center justify-between\">\n                                <button onClick={() => onSelect(member.id)} className=\"w-full text-center text-xs font-bold text-gray-600 dark:text-gray-300 hover:text-primary transition-colors\">\n                                    View Profile\n                                </button>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default DirectoryView;"],"names":[],"mappings":";;;;;;AASA,MAAM,gBAA8C,CAAC,EAAE,QAAQ,EAAE,WAAW,EAAE,OAAO,EAAE;IAEnF,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC;YAAI,WAAU;;8BAGX,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAI,WAAU;;kDACX,8OAAC;wCAAE,WAAU;kDAAuD;;;;;;kDACpE,8OAAC;wCAAK,WAAU;kDAAyC;;;;;;;;;;;;0CAE7D,8OAAC;gCAAE,WAAU;0CAAqD,QAAQ,MAAM;;;;;;;;;;;;;;;;;8BAKxF,8OAAC;oBAAI,WAAU;8BACV,QAAQ,GAAG,CAAC,CAAC,uBACV,8OAAC;4BAAoB,WAAU;;8CAC3B,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAI,WAAU;4CAAuJ,OAAO;gDAAC,iBAAiB,CAAC,KAAK,EAAE,OAAO,MAAM,CAAC,EAAE,CAAC;4CAAA;;;;;;sDACxN,8OAAC;4CAAI,WAAU;;8DACX,8OAAC;oDAAG,WAAU;8DACT,eAAe,OAAO,MAAM,GAAG,OAAO,MAAM,GAAG,OAAO,IAAI;;;;;;8DAE/D,8OAAC;oDAAE,WAAU;8DAA4C,OAAO,IAAI;;;;;;;;;;;;sDAExE,8OAAC;4CAAI,WAAU;sDACX,cAAA,8OAAC;gDAAK,WAAU;0DACX,OAAO,MAAM;;;;;;;;;;;;;;;;;8CAK1B,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAI,WAAU;;8DACX,8OAAC;oDAAK,WAAU;8DAAwC;;;;;;8DACxD,8OAAC;8DAAM,OAAO,SAAS,IAAI;;;;;;;;;;;;sDAE/B,8OAAC;4CAAI,WAAU;;8DACX,8OAAC;oDAAK,WAAU;8DAAwC;;;;;;8DACxD,8OAAC;8DAAM,OAAO,QAAQ,IAAI;;;;;;;;;;;;;;;;;;8CAIlC,8OAAC;oCAAI,WAAU;8CACX,cAAA,8OAAC;wCAAO,SAAS,IAAM,SAAS,OAAO,EAAE;wCAAG,WAAU;kDAA6G;;;;;;;;;;;;2BA5BjK,OAAO,EAAE;;;;;;;;;;;;;;;;;;;;;AAsC3C;uCAEe"}},
    {"offset": {"line": 2720, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/views/SettingsView.tsx"],"sourcesContent":["import React from 'react';\n\nconst SettingsView: React.FC = () => {\n    return (\n        <div className=\"flex-1 overflow-y-auto pt-24 pb-20 px-6 md:px-10 bg-background-light dark:bg-background-dark\">\n            <div className=\"max-w-[960px] mx-auto flex flex-col gap-8 animate-fade-in\">\n                {/* Header */}\n                <div className=\"flex flex-wrap justify-between gap-4 p-4 items-end\">\n                    <div className=\"flex flex-col gap-3\">\n                        <h1 className=\"text-slate-900 dark:text-white text-4xl font-black leading-tight\">Privacy & Visibility</h1>\n                        <p className=\"text-gray-600 dark:text-gray-400 text-base font-normal max-w-2xl\">\n                            Manage visual hierarchy, control access permissions, and filter specific branches for your family tree visualization.\n                        </p>\n                    </div>\n                    <div className=\"flex gap-3\">\n                        <button className=\"flex items-center justify-center h-10 px-5 text-sm font-bold bg-white dark:bg-white/10 border border-gray-200 dark:border-white/10 rounded-lg text-slate-900 dark:text-white hover:bg-gray-50 dark:hover:bg-white/20 transition-colors\">\n                            Cancel\n                        </button>\n                        <button className=\"flex items-center justify-center h-10 px-5 text-sm font-bold bg-primary text-slate-900 rounded-lg hover:bg-primary-dark transition-colors shadow-lg shadow-primary/20\">\n                            Save Changes\n                        </button>\n                    </div>\n                </div>\n\n                {/* Depth Slider Card */}\n                <section className=\"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm overflow-hidden p-6 md:p-8\">\n                    <div className=\"flex items-center gap-4 mb-6\">\n                        <div className=\"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary\">\n                            <span className=\"material-symbols-outlined\">layers</span>\n                        </div>\n                        <div>\n                            <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">Visualization Depth</h2>\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">Control how many generations are loaded by default.</p>\n                        </div>\n                    </div>\n\n                    <div className=\"relative flex w-full flex-col gap-6\">\n                        <div className=\"flex w-full items-center justify-between\">\n                            <p className=\"text-slate-900 dark:text-white text-lg font-bold\">Level 3: Great-Grandparents</p>\n                            <div className=\"px-3 py-1 rounded-full bg-primary/20 text-xs font-bold text-primary-dark dark:text-primary uppercase tracking-wide\">62 Profiles Visible</div>\n                        </div>\n                        \n                        <div className=\"relative w-full h-12 flex items-center group\">\n                            <div className=\"absolute w-full h-2 bg-gray-200 dark:bg-white/10 rounded-full overflow-hidden\">\n                                <div className=\"h-full bg-primary w-[60%] rounded-full\"></div>\n                            </div>\n                            <input \n                                type=\"range\" \n                                min=\"1\" \n                                max=\"5\" \n                                defaultValue=\"3\" \n                                className=\"absolute w-full h-full opacity-0 cursor-pointer z-10\" \n                            />\n                            {/* Visual Dots */}\n                            <div className=\"absolute w-full flex justify-between px-1 pointer-events-none\">\n                                {[1,2,3,4,5].map(i => (\n                                    <div key={i} className={`size-4 rounded-full border-2 border-white dark:border-gray-800 transition-all ${i <= 3 ? 'bg-primary scale-110' : 'bg-gray-300 dark:bg-white/20'}`}></div>\n                                ))}\n                            </div>\n                        </div>\n                    </div>\n                </section>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                    {/* Branch Filters */}\n                    <section className=\"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm p-6 md:p-8 flex flex-col h-full\">\n                         <div className=\"flex items-center gap-4 mb-6\">\n                            <div className=\"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary\">\n                                <span className=\"material-symbols-outlined\">account_tree</span>\n                            </div>\n                            <div>\n                                <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">Branch Filters</h2>\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">Toggle visibility of specific family lines.</p>\n                            </div>\n                        </div>\n                        <div className=\"flex flex-col gap-6\">\n                            {[\n                                { title: 'Paternal Side', sub: \"Father's ancestors\", active: true },\n                                { title: 'Maternal Side', sub: \"Mother's ancestors\", active: true },\n                                { title: 'In-Laws & Step-Family', sub: \"Connected by marriage\", active: false },\n                            ].map((item, i) => (\n                                <div key={i} className=\"flex items-center justify-between cursor-pointer\">\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"text-base font-semibold text-slate-900 dark:text-white\">{item.title}</span>\n                                        <span className=\"text-xs text-gray-500 dark:text-gray-400\">{item.sub}</span>\n                                    </div>\n                                    <div className={`relative inline-flex h-7 w-12 items-center rounded-full transition-colors duration-200 ${item.active ? 'bg-primary' : 'bg-gray-300 dark:bg-white/20'}`}>\n                                        <span className={`inline-block size-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${item.active ? 'translate-x-6' : 'translate-x-1'}`}></span>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </section>\n\n                    {/* Privacy Level */}\n                    <section className=\"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm p-6 md:p-8 flex flex-col h-full\">\n                         <div className=\"flex items-center gap-4 mb-6\">\n                            <div className=\"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary\">\n                                <span className=\"material-symbols-outlined\">lock</span>\n                            </div>\n                            <div>\n                                <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">Privacy Level</h2>\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">Who can view your living relatives?</p>\n                            </div>\n                        </div>\n                        <div className=\"flex flex-col gap-4\">\n                             {[\n                                { title: 'Public', sub: 'Visible to all users', checked: false },\n                                { title: 'Family Members Only', sub: 'Only invited members', checked: true },\n                                { title: 'Private', sub: 'Only you', checked: false }\n                             ].map((opt, i) => (\n                                <label key={i} className={`flex items-start gap-3 p-3 rounded-xl border cursor-pointer transition-colors ${opt.checked ? 'border-primary/50 bg-primary/10' : 'border-transparent hover:bg-black/5 dark:hover:bg-white/5'}`}>\n                                    <input type=\"radio\" name=\"privacy\" defaultChecked={opt.checked} className=\"mt-1 text-primary focus:ring-primary bg-transparent\" />\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"text-sm font-bold text-slate-900 dark:text-white\">{opt.title}</span>\n                                        <span className=\"text-xs text-gray-500 dark:text-gray-400\">{opt.sub}</span>\n                                    </div>\n                                </label>\n                             ))}\n                        </div>\n                    </section>\n                </div>\n\n                <section className=\"rounded-2xl bg-gradient-to-r from-gray-900 to-gray-800 dark:from-black dark:to-[#1a1a1a] p-8 text-white flex flex-col md:flex-row items-center justify-between gap-6 shadow-lg\">\n                    <div className=\"flex flex-col gap-2\">\n                        <h3 className=\"text-xl font-bold\">Need more control?</h3>\n                        <p className=\"text-white/70 max-w-lg text-sm\">Our Advanced Privacy Shield offers granular control over every single profile in your tree.</p>\n                    </div>\n                    <button className=\"whitespace-nowrap px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg font-bold text-sm transition-all flex items-center gap-2\">\n                        <span className=\"material-symbols-outlined text-[18px]\">verified_user</span>\n                        View Advanced Options\n                    </button>\n                </section>\n            </div>\n        </div>\n    );\n};\n\nexport default SettingsView;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3266, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/services/familyService.ts"],"sourcesContent":["import { FamilyMember, Connection } from '../types';\n\n// Refactored to accept data as arguments, making it synchronous and pure\n// This avoids needing to make the UI components async just for simple filtering\nexport const getImmediateFamily = (memberId: string, members: FamilyMember[], connections: Connection[]) => {\n    const family: any[] = [];\n\n    connections.forEach(conn => {\n        if (conn.sourceId === memberId) {\n            const target = members.find(m => m.id === conn.targetId);\n            if (target) family.push({ relation: conn.label, member: target });\n        } else if (conn.targetId === memberId) {\n            const source = members.find(m => m.id === conn.sourceId);\n            if (source) family.push({ relation: \"Linked by \" + conn.label, member: source });\n        }\n    });\n\n    return family;\n};\n"],"names":[],"mappings":";;;;AAIO,MAAM,qBAAqB,CAAC,UAAkB,SAAyB;IAC1E,MAAM,SAAgB,EAAE;IAExB,YAAY,OAAO,CAAC,CAAA;QAChB,IAAI,KAAK,QAAQ,KAAK,UAAU;YAC5B,MAAM,SAAS,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,QAAQ;YACvD,IAAI,QAAQ,OAAO,IAAI,CAAC;gBAAE,UAAU,KAAK,KAAK;gBAAE,QAAQ;YAAO;QACnE,OAAO,IAAI,KAAK,QAAQ,KAAK,UAAU;YACnC,MAAM,SAAS,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,QAAQ;YACvD,IAAI,QAAQ,OAAO,IAAI,CAAC;gBAAE,UAAU,eAAe,KAAK,KAAK;gBAAE,QAAQ;YAAO;QAClF;IACJ;IAEA,OAAO;AACX"}},
    {"offset": {"line": 3293, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/components/ProfileSidebar.tsx"],"sourcesContent":["import React from 'react';\nimport { FamilyMember, Connection } from '../types';\nimport { getImmediateFamily } from '../services/familyService';\n\ninterface ProfileSidebarProps {\n    member: FamilyMember | null;\n    onClose: () => void;\n    onSelectMember: (id: string) => void;\n    showChinese: boolean;\n    onEdit: () => void;\n    onDelete: () => void;\n    members: FamilyMember[];\n    connections: Connection[];\n}\n\nconst ProfileSidebar: React.FC<ProfileSidebarProps> = ({ \n    member, \n    onClose, \n    onSelectMember, \n    showChinese, \n    onEdit, \n    onDelete,\n    members,\n    connections\n}) => {\n    if (!member) return null;\n\n    // Now uses passed props instead of synchronous DB access\n    const relatives = getImmediateFamily(member.id, members, connections);\n\n    return (\n        <aside className=\"absolute top-24 right-6 bottom-32 w-80 md:w-96 bg-white/80 dark:bg-black/80 backdrop-blur-xl border border-white/40 dark:border-white/10 rounded-2xl shadow-2xl p-6 z-30 flex flex-col animate-[slideIn_0.3s_ease-out]\">\n            <style>{`\n                @keyframes slideIn {\n                    from { transform: translateX(100%); opacity: 0; }\n                    to { transform: translateX(0); opacity: 1; }\n                }\n            `}</style>\n            \n            <div className=\"flex items-center justify-between mb-6\">\n                <h2 className=\"text-lg font-bold text-slate-900 dark:text-white\">Profile Details</h2>\n                <button onClick={onClose} className=\"p-1.5 hover:bg-black/5 dark:hover:bg-white/10 rounded-lg transition-colors\">\n                    <span className=\"material-symbols-outlined text-gray-500 text-[20px]\">close</span>\n                </button>\n            </div>\n\n            {/* Header */}\n            <div className=\"flex flex-col items-center mb-6\">\n                <div className=\"w-24 h-24 rounded-full p-1 border-2 border-primary border-dashed mb-3 relative group\">\n                    <div className=\"w-full h-full rounded-full bg-cover bg-center\" style={{backgroundImage: `url('${member.avatar}')`}}></div>\n                    <button \n                        onClick={onEdit}\n                        className=\"absolute bottom-0 right-0 p-1.5 bg-primary rounded-full text-slate-900 shadow-sm hover:scale-110 transition-transform cursor-pointer\"\n                    >\n                        <span className=\"material-symbols-outlined text-[16px]\">edit</span>\n                    </button>\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-900 dark:text-white\">\n                    {showChinese && member.nameZh ? member.nameZh : member.name}\n                </h3>\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{member.role}</p>\n                {member.isSelf && (\n                     <span className=\"mt-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary/20 text-primary-dark dark:text-primary\">\n                        Center Member (Me)\n                    </span>\n                )}\n            </div>\n\n            {/* Info Grid */}\n            <div className=\"space-y-4 flex-1 overflow-y-auto no-scrollbar pr-1\">\n                <div className=\"grid grid-cols-2 gap-3\">\n                    <div className=\"bg-white/50 dark:bg-white/5 p-3 rounded-xl border border-white/40 dark:border-white/5\">\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Birth Date</p>\n                        <p className=\"font-semibold text-sm\">{member.birthDate}</p>\n                    </div>\n                    <div className=\"bg-white/50 dark:bg-white/5 p-3 rounded-xl border border-white/40 dark:border-white/5\">\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Location</p>\n                        <p className=\"font-semibold text-sm\">{member.location}</p>\n                    </div>\n                </div>\n\n                <div className=\"bg-white/50 dark:bg-white/5 p-4 rounded-xl border border-white/40 dark:border-white/5\">\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">Biography</p>\n                    <p className=\"text-sm text-gray-700 dark:text-gray-300 leading-relaxed\">\n                        {member.bio || \"No biography added.\"}\n                    </p>\n                </div>\n\n                <div className=\"pt-4\">\n                    <h4 className=\"text-sm font-bold text-slate-900 dark:text-white mb-3 flex items-center gap-2\">\n                        <span className=\"material-symbols-outlined text-primary text-[18px]\">family_star</span>\n                        Immediate Family\n                    </h4>\n                    <div className=\"space-y-2\">\n                        {relatives.length === 0 && <p className=\"text-xs text-gray-500\">No connections found.</p>}\n                        {relatives.map((rel) => (\n                            <div \n                                key={rel.member.id}\n                                onClick={() => onSelectMember(rel.member.id)}\n                                className=\"flex items-center gap-3 p-2 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg transition-colors cursor-pointer group\"\n                            >\n                                <div className=\"w-8 h-8 rounded-full bg-cover bg-center\" style={{backgroundImage: `url('${rel.member.avatar}')`}}></div>\n                                <div className=\"flex-1\">\n                                    <p className=\"text-sm font-semibold group-hover:text-primary transition-colors\">\n                                        {showChinese && rel.member.nameZh ? rel.member.nameZh : rel.member.name}\n                                    </p>\n                                    <p className=\"text-xs text-gray-500\">{rel.relation}</p>\n                                </div>\n                                <span className=\"material-symbols-outlined text-gray-400 text-[18px]\">chevron_right</span>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </div>\n\n            {/* Actions */}\n            <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex gap-2\">\n                <button \n                    onClick={onEdit}\n                    className=\"flex-1 bg-slate-900 hover:bg-gray-800 text-white dark:bg-white dark:text-black dark:hover:bg-gray-200 py-2.5 rounded-xl text-sm font-bold transition-colors shadow-lg\"\n                >\n                    Edit Profile\n                </button>\n                <button \n                    onClick={onDelete}\n                    className=\"w-10 flex items-center justify-center bg-red-50 hover:bg-red-100 text-red-500 rounded-xl transition-colors\"\n                >\n                    <span className=\"material-symbols-outlined text-[20px]\">delete</span>\n                </button>\n            </div>\n        </aside>\n    );\n};\n\nexport default ProfileSidebar;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3657, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/components/Timeline.tsx"],"sourcesContent":["import React, { useState } from 'react';\n\nconst Timeline: React.FC = () => {\n    const [year, setYear] = useState(2024);\n    const [isExpanded, setIsExpanded] = useState(true);\n\n    return (\n        <div \n            className={`absolute bottom-0 left-0 right-0 z-40 transition-transform duration-300 ease-in-out ${isExpanded ? 'translate-y-0' : 'translate-y-full'}`}\n        >\n            {/* Toggle Tab */}\n            <button \n                onClick={() => setIsExpanded(!isExpanded)}\n                className=\"absolute -top-10 left-6 h-10 px-4 bg-white/90 dark:bg-black/90 backdrop-blur-md rounded-t-xl border-t border-x border-white/40 dark:border-white/10 shadow-[0_-4px_10px_rgba(0,0,0,0.05)] flex items-center gap-2 text-xs font-bold text-gray-600 dark:text-gray-300 hover:text-primary transition-colors z-50 group\"\n            >\n                <span className={`material-symbols-outlined text-[18px] transition-transform duration-300 ${isExpanded ? 'rotate-180' : 'rotate-0'}`}>expand_less</span>\n                <span>{isExpanded ? 'Hide Timeline' : 'Timeline'}</span>\n            </button>\n\n            {/* Main Bar */}\n            <div className=\"bg-white/80 dark:bg-black/80 backdrop-blur-xl border-t border-white/40 dark:border-white/10 px-6 md:px-8 py-6 shadow-[0_-4px_30px_rgba(0,0,0,0.03)] h-full\">\n                <div className=\"max-w-7xl mx-auto w-full flex flex-col gap-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"material-symbols-outlined text-primary text-xl\">history_toggle_off</span>\n                            <span className=\"text-sm font-bold text-gray-700 dark:text-gray-200\">Timeline scrubbing</span>\n                        </div>\n                        <div className=\"px-3 py-1 bg-primary/20 text-primary-dark dark:text-primary rounded-lg text-sm font-bold font-mono\">\n                            {year}\n                        </div>\n                    </div>\n                    \n                    <div className=\"relative w-full h-10 flex items-center group\">\n                        {/* Track Background */}\n                        <div className=\"absolute w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n                             {/* Filled Part */}\n                            <div \n                                className=\"h-full bg-gradient-to-r from-primary/30 via-primary/80 to-primary origin-left\"\n                                style={{ width: `${((year - 1900) / (2024 - 1900)) * 100}%` }}\n                            ></div>\n                        </div>\n                        \n                        {/* Native Range Input for Interaction */}\n                        <input \n                            type=\"range\" \n                            min=\"1900\" \n                            max=\"2024\" \n                            value={year}\n                            onChange={(e) => setYear(parseInt(e.target.value))}\n                            className=\"absolute w-full h-full opacity-0 cursor-ew-resize z-20\"\n                        />\n\n                        {/* Custom Thumb Visual (Positioned by JS) */}\n                        <div \n                            className=\"absolute top-1/2 -translate-y-1/2 w-8 h-8 -ml-4 bg-white dark:bg-gray-800 border-4 border-primary rounded-full shadow-[0_0_15px_rgba(128,236,19,0.5)] pointer-events-none z-10 transition-transform group-hover:scale-110\"\n                            style={{ left: `${((year - 1900) / (2024 - 1900)) * 100}%` }}\n                        >\n                             <div className=\"w-2 h-2 bg-primary rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2\"></div>\n                        </div>\n                    </div>\n\n                    <div className=\"flex justify-between text-xs font-semibold text-gray-400 select-none px-1 tracking-wider uppercase\">\n                        <span>1900</span>\n                        <span>1920</span>\n                        <span>1940</span>\n                        <span>1960</span>\n                        <span>1980</span>\n                        <span>2000</span>\n                        <span>2020</span>\n                        <span>2024</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default Timeline;"],"names":[],"mappings":";;;;;AAAA;;;AAEA,MAAM,WAAqB;IACvB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAE7C,qBACI,8OAAC;QACG,WAAW,CAAC,oFAAoF,EAAE,aAAa,kBAAkB,oBAAoB;;0BAGrJ,8OAAC;gBACG,SAAS,IAAM,cAAc,CAAC;gBAC9B,WAAU;;kCAEV,8OAAC;wBAAK,WAAW,CAAC,wEAAwE,EAAE,aAAa,eAAe,YAAY;kCAAE;;;;;;kCACtI,8OAAC;kCAAM,aAAa,kBAAkB;;;;;;;;;;;;0BAI1C,8OAAC;gBAAI,WAAU;0BACX,cAAA,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAK,WAAU;sDAAiD;;;;;;sDACjE,8OAAC;4CAAK,WAAU;sDAAqD;;;;;;;;;;;;8CAEzE,8OAAC;oCAAI,WAAU;8CACV;;;;;;;;;;;;sCAIT,8OAAC;4BAAI,WAAU;;8CAEX,8OAAC;oCAAI,WAAU;8CAEX,cAAA,8OAAC;wCACG,WAAU;wCACV,OAAO;4CAAE,OAAO,GAAG,AAAC,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,IAAI,IAAK,IAAI,CAAC,CAAC;wCAAC;;;;;;;;;;;8CAKpE,8OAAC;oCACG,MAAK;oCACL,KAAI;oCACJ,KAAI;oCACJ,OAAO;oCACP,UAAU,CAAC,IAAM,QAAQ,SAAS,EAAE,MAAM,CAAC,KAAK;oCAChD,WAAU;;;;;;8CAId,8OAAC;oCACG,WAAU;oCACV,OAAO;wCAAE,MAAM,GAAG,AAAC,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,IAAI,IAAK,IAAI,CAAC,CAAC;oCAAC;8CAE1D,cAAA,8OAAC;wCAAI,WAAU;;;;;;;;;;;;;;;;;sCAIxB,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;8CAAK;;;;;;8CACN,8OAAC;8CAAK;;;;;;8CACN,8OAAC;8CAAK;;;;;;8CACN,8OAAC;8CAAK;;;;;;8CACN,8OAAC;8CAAK;;;;;;8CACN,8OAAC;8CAAK;;;;;;8CACN,8OAAC;8CAAK;;;;;;8CACN,8OAAC;8CAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM9B;uCAEe"}},
    {"offset": {"line": 3886, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/components/EditMemberModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { FamilyMember } from '../types';\nimport { translations } from '../locales';\n\ninterface EditMemberModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onSave: (member: FamilyMember) => void;\n    member?: FamilyMember | null;\n    lang: 'en' | 'zh';\n}\n\nconst EditMemberModal: React.FC<EditMemberModalProps> = ({ isOpen, onClose, onSave, member, lang }) => {\n    const t = translations[lang];\n    const [formData, setFormData] = useState<Partial<FamilyMember>>({});\n\n    useEffect(() => {\n        if (isOpen) {\n            setFormData(member ? { ...member } : {\n                id: crypto.randomUUID(),\n                name: '',\n                nameZh: '',\n                role: '',\n                gender: 'male',\n                avatar: `https://picsum.photos/seed/${Date.now()}/200/200`,\n                x: 0,\n                y: 0,\n                isSelf: false\n            });\n        }\n    }, [isOpen, member]);\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 animate-[fadeIn_0.2s_ease-out]\">\n                <div className=\"px-6 py-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 flex justify-between items-center\">\n                    <h3 className=\"font-bold text-lg text-slate-900 dark:text-white\">\n                        {member ? t.edit : t.addMember}\n                    </h3>\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\">\n                        <span className=\"material-symbols-outlined\">close</span>\n                    </button>\n                </div>\n                \n                <div className=\"p-6 space-y-4 max-h-[70vh] overflow-y-auto\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                         <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.name}</label>\n                            <input \n                                className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.name || ''}\n                                onChange={e => setFormData({...formData, name: e.target.value})}\n                            />\n                        </div>\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.nameZh}</label>\n                            <input \n                                className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.nameZh || ''}\n                                onChange={e => setFormData({...formData, nameZh: e.target.value})}\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"space-y-1\">\n                        <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.role}</label>\n                        <input \n                            className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none\"\n                            value={formData.role || ''}\n                            onChange={e => setFormData({...formData, role: e.target.value})}\n                        />\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                         <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.birthDate}</label>\n                            <input \n                                className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.birthDate || ''}\n                                placeholder=\"YYYY\"\n                                onChange={e => setFormData({...formData, birthDate: e.target.value})}\n                            />\n                        </div>\n                        <div className=\"space-y-1\">\n                            <label className=\"text-xs font-bold text-gray-500 uppercase\">{t.location}</label>\n                            <input \n                                className=\"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none\"\n                                value={formData.location || ''}\n                                onChange={e => setFormData({...formData, location: e.target.value})}\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-4\">\n                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                            <input \n                                type=\"radio\" \n                                name=\"gender\" \n                                checked={formData.gender === 'male'} \n                                onChange={() => setFormData({...formData, gender: 'male'})}\n                                className=\"text-primary focus:ring-primary\" \n                            />\n                            <span className=\"text-sm\">{t.male}</span>\n                        </label>\n                        <label className=\"flex items-center gap-2 cursor-pointer\">\n                            <input \n                                type=\"radio\" \n                                name=\"gender\" \n                                checked={formData.gender === 'female'} \n                                onChange={() => setFormData({...formData, gender: 'female'})}\n                                className=\"text-primary focus:ring-primary\" \n                            />\n                            <span className=\"text-sm\">{t.female}</span>\n                        </label>\n                    </div>\n\n                    <div className=\"pt-2\">\n                        <label className=\"flex items-center gap-3 p-3 border border-primary/30 bg-primary/5 rounded-xl cursor-pointer hover:bg-primary/10 transition-colors\">\n                            <input \n                                type=\"checkbox\" \n                                checked={formData.isSelf || false} \n                                onChange={e => setFormData({...formData, isSelf: e.target.checked})}\n                                className=\"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300\"\n                            />\n                            <div>\n                                <span className=\"block font-bold text-slate-900 dark:text-white\">{t.setAsSelf}</span>\n                                <span className=\"block text-xs text-gray-500\">This will center the map on this person initially</span>\n                            </div>\n                        </label>\n                    </div>\n                </div>\n\n                <div className=\"p-6 pt-2 flex gap-3\">\n                    <button onClick={onClose} className=\"flex-1 py-2.5 rounded-xl font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\">\n                        {t.cancel}\n                    </button>\n                    <button \n                        onClick={() => onSave(formData as FamilyMember)} \n                        className=\"flex-1 py-2.5 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl font-bold transition-colors shadow-lg shadow-primary/20\"\n                    >\n                        {t.save}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default EditMemberModal;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4299, "column": 0}, "map": {"version":3,"sources":["file:///E:/robinson-family-tree/App.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport { ViewMode, FamilyMember, Connection } from './types';\nimport { dbService } from './services/dbService';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useToast } from './src/providers/ToastProvider';\nimport { useUndoRedo } from './src/providers/UndoRedoProvider';\nimport Navbar from './components/Navbar';\nimport TreeView from './views/TreeView';\nimport DirectoryView from './views/DirectoryView';\nimport SettingsView from './views/SettingsView';\nimport ProfileSidebar from './components/ProfileSidebar';\nimport Timeline from './components/Timeline';\nimport EditMemberModal from './components/EditMemberModal';\nimport EditConnectionModal from './components/EditConnectionModal';\n\nconst App: React.FC = () => {\n    const [currentView, setView] = useState<ViewMode>('tree');\n    const [selectedMemberId, setSelectedMemberId] = useState<string | null>(null);\n    const [showChineseNames, setShowChineseNames] = useState(false);\n    const queryClient = useQueryClient();\n    const toast = useToast();\n    const { addOperation, undo, redo, canUndo, canRedo } = useUndoRedo();\n\n    // Keyboard shortcuts for undo/redo\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n                e.preventDefault();\n                if (canUndo) {\n                    undo();\n                    toast.showInfo('Undo operation');\n                }\n            } else if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n                e.preventDefault();\n                if (canRedo) {\n                    redo();\n                    toast.showInfo('Redo operation');\n                }\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [undo, redo, canUndo, canRedo, toast]);\n\n    // Modal State\n    const [isMemberModalOpen, setIsMemberModalOpen] = useState(false);\n    const [editingMember, setEditingMember] = useState<FamilyMember | null>(null);\n\n    // --- Data Queries ---\n\n    const { data: members = [], isLoading: membersLoading } = useQuery({\n        queryKey: ['members'],\n        queryFn: () => dbService.getMembers(),\n    });\n\n    const { data: connections = [], isLoading: connectionsLoading } = useQuery({\n        queryKey: ['connections'],\n        queryFn: () => dbService.getConnections(),\n    });\n\n    const loading = membersLoading || connectionsLoading;\n\n    // --- Mutations ---\n\n    const saveMemberMutation = useMutation({\n        mutationFn: (member: FamilyMember) => {\n            const existing = members.find(m => m.id === member.id);\n            if (existing) {\n                return dbService.updateMember(member);\n            } else {\n                return dbService.addMember(member);\n            }\n        },\n        onSuccess: (_, variables) => {\n            // Invalidate and refetch only the members query\n            queryClient.invalidateQueries({ queryKey: ['members'] });\n            // If member has connections, also refetch connections\n            queryClient.invalidateQueries({ queryKey: ['connections'] });\n            \n            // Show success toast\n            const existing = members.find(m => m.id === variables.id);\n            if (existing) {\n                toast.showSuccess('Member updated successfully');\n                \n                // Add update operation to history\n                addOperation({\n                    type: 'updateMember',\n                    data: {\n                        id: variables.id,\n                        oldData: existing,\n                        newData: variables\n                    },\n                    inverse: {\n                        type: 'updateMember',\n                        data: {\n                            id: variables.id,\n                            oldData: variables,\n                            newData: existing\n                        }\n                    }\n                });\n            } else {\n                toast.showSuccess('Member added successfully');\n                \n                // Add add operation to history\n                addOperation({\n                    type: 'addMember',\n                    data: variables,\n                    inverse: {\n                        type: 'deleteMember',\n                        data: { id: variables.id }\n                    }\n                });\n            }\n        },\n        onError: () => {\n            toast.showError('Failed to save member');\n        },\n    });\n\n    const deleteMemberMutation = useMutation({\n        mutationFn: (id: string) => {\n            // Get the member data before deleting for undo operation\n            const memberToDelete = members.find(m => m.id === id);\n            if (memberToDelete) {\n                // Store member data in a closure for use in onSuccess\n                (deleteMemberMutation as any)._memberToDelete = memberToDelete;\n            }\n            return dbService.deleteMember(id);\n        },\n        onSuccess: (_, variables) => {\n            // Invalidate and refetch both queries\n            queryClient.invalidateQueries({ queryKey: ['members'] });\n            queryClient.invalidateQueries({ queryKey: ['connections'] });\n            \n            // Show success toast\n            toast.showSuccess('Member deleted successfully');\n            \n            // Add delete operation to history\n            const memberToDelete = (deleteMemberMutation as any)._memberToDelete;\n            if (memberToDelete) {\n                addOperation({\n                    type: 'deleteMember',\n                    data: { id: variables, memberData: memberToDelete },\n                    inverse: {\n                        type: 'addMember',\n                        data: memberToDelete\n                    }\n                });\n                // Clear the stored member data\n                (deleteMemberMutation as any)._memberToDelete = undefined;\n            }\n        },\n        onError: () => {\n            toast.showError('Failed to delete member');\n            // Clear any stored member data on error\n            (deleteMemberMutation as any)._memberToDelete = undefined;\n        },\n    });\n\n    const handleSelectMember = (id: string) => {\n        setSelectedMemberId(id);\n    };\n\n    const handleSaveMember = async (member: FamilyMember) => {\n        await saveMemberMutation.mutateAsync(member);\n        setIsMemberModalOpen(false);\n        setEditingMember(null);\n    };\n\n    const handleDeleteMember = async (id: string) => {\n        if (window.confirm(\"Are you sure you want to delete this member? This will also remove connected lines.\")) {\n            await deleteMemberMutation.mutateAsync(id);\n            if (selectedMemberId === id) setSelectedMemberId(null);\n        }\n    };\n\n    const handleEditMemberRequest = (member: FamilyMember) => {\n        setEditingMember(member);\n        setIsMemberModalOpen(true);\n    };\n\n    const handleDataChange = () => {\n        // Invalidate and refetch both queries\n        queryClient.invalidateQueries({ queryKey: ['members'] });\n        queryClient.invalidateQueries({ queryKey: ['connections'] });\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex h-screen items-center justify-center bg-background-light dark:bg-background-dark text-primary\">\n                <span className=\"material-symbols-outlined text-4xl animate-spin\">autorenew</span>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex flex-col h-screen w-full relative\">\n            <Navbar \n                currentView={currentView} \n                setView={setView} \n                showChinese={showChineseNames}\n                setShowChinese={setShowChineseNames}\n            />\n            \n            <main className=\"flex-1 relative flex flex-col h-full overflow-hidden\">\n                {currentView === 'tree' && (\n                    <TreeView \n                        selectedId={selectedMemberId} \n                        onSelect={handleSelectMember} \n                        showChinese={showChineseNames}\n                        members={members}\n                        connections={connections}\n                        onDataChange={handleDataChange}\n                        onEditMember={handleEditMemberRequest}\n                    />\n                )}\n                \n                {currentView === 'directory' && (\n                    <DirectoryView \n                        onSelect={handleSelectMember} \n                        showChinese={showChineseNames}\n                        members={members}\n                    />\n                )}\n\n                {currentView === 'settings' && (\n                    <SettingsView />\n                )}\n            </main>\n\n            {/* Global Components */}\n            {selectedMemberId && (\n                <ProfileSidebar \n                    member={members.find(m => m.id === selectedMemberId) || null} \n                    onClose={() => setSelectedMemberId(null)}\n                    onSelectMember={handleSelectMember}\n                    showChinese={showChineseNames}\n                    onEdit={() => {\n                        const m = members.find(x => x.id === selectedMemberId);\n                        if (m) handleEditMemberRequest(m);\n                    }}\n                    onDelete={() => handleDeleteMember(selectedMemberId)}\n                    // Pass full data sets to sidebar for relationship calculation\n                    members={members}\n                    connections={connections}\n                />\n            )}\n\n            {currentView === 'tree' && <Timeline />}\n\n            {/* Modals placed at App level ensures they work from Sidebar OR Tree */}\n            <EditMemberModal \n                isOpen={isMemberModalOpen}\n                onClose={() => setIsMemberModalOpen(false)}\n                onSave={handleSaveMember}\n                member={editingMember}\n                lang={showChineseNames ? 'zh' : 'en'}\n            />\n        </div>\n    );\n};\n\nexport default App;\n"],"names":[],"mappings":"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"}}]
}