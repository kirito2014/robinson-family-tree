(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95187,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={callServer:function(){return l.callServer},createServerReference:function(){return n.createServerReference},findSourceMapURL:function(){return i.findSourceMapURL}};for(var s in a)Object.defineProperty(r,s,{enumerable:!0,get:a[s]});let l=e.r(32120),i=e.r(92245),n=e.r(35326)},20613,e=>{"use strict";let t;var r=e.i(43476),a=e.i(71645),s=e.i(95187);let l=(0,s.createServerReference)("00426a7e4cadf7afffdf1c9766764168d718302b92",s.callServer,void 0,s.findSourceMapURL,"getMembersAction"),i=(0,s.createServerReference)("40bdfbea698c59dd2879421a45a56f1fa4fe5109a6",s.callServer,void 0,s.findSourceMapURL,"saveMemberAction"),n=(0,s.createServerReference)("4074863e5d11f12596259c64117bb58347e8a88a02",s.callServer,void 0,s.findSourceMapURL,"deleteMemberAction"),o=(0,s.createServerReference)("003761513aa52799012788a487429b5d1b4d7e0a29",s.callServer,void 0,s.findSourceMapURL,"getConnectionsAction"),d=(0,s.createServerReference)("40ac8f13597e27c417bef8e29ed00511d1c0e50956",s.callServer,void 0,s.findSourceMapURL,"saveConnectionAction"),c=(0,s.createServerReference)("40c203df7974a181bbbf52d3fc46c31cd6001edfeb",s.callServer,void 0,s.findSourceMapURL,"deleteConnectionAction"),h=async()=>{try{return await l()}catch(e){return console.error("Failed to fetch members",e),[]}},u=async e=>{await i(e)},m=async e=>{await i(e)},x=async e=>{await n(e)},b=async()=>{try{return await o()}catch(e){return console.error("Failed to fetch connections",e),[]}},p=async e=>{await d(e)},g=async e=>{await d(e)},y=async e=>{await c(e)},f=async()=>{let e=await l(),t=await o(),r=`-- Robinson Family Tree Export
-- Generated on ${new Date().toISOString()}

`;return r+=`CREATE TABLE IF NOT EXISTS members (
      id TEXT PRIMARY KEY,
      name TEXT,
      name_zh TEXT,
      role TEXT,
      birth_date TEXT,
      location TEXT,
      avatar TEXT,
      gender TEXT,
      is_self BOOLEAN,
      x INTEGER,
      y INTEGER
    );

CREATE TABLE IF NOT EXISTS connections (
      id TEXT PRIMARY KEY,
      source_id TEXT,
      target_id TEXT,
      source_handle TEXT,
      target_handle TEXT,
      label TEXT,
      label_zh TEXT,
      color TEXT,
      line_style TEXT,
      FOREIGN KEY(source_id) REFERENCES members(id),
      FOREIGN KEY(target_id) REFERENCES members(id)
    );

`,e.forEach(e=>{r+=`INSERT INTO members (id, name, name_zh, role, birth_date, location, avatar, gender, is_self, x, y) VALUES ('${e.id}', '${e.name.replace(/'/g,"''")}', '${(e.nameZh||"").replace(/'/g,"''")}', '${e.role}', '${e.birthDate||""}', '${e.location||""}', '${e.avatar}', '${e.gender}', ${+!!e.isSelf}, ${Math.round(e.x)}, ${Math.round(e.y)});
`}),r+="\n",t.forEach(e=>{r+=`INSERT INTO connections (id, source_id, target_id, source_handle, target_handle, label, label_zh, color, line_style) VALUES ('${e.id}', '${e.sourceId}', '${e.targetId}', '${e.sourceHandle}', '${e.targetHandle}', '${e.label}', '${e.labelZh||""}', '${e.color||"#e5e7eb"}', '${e.lineStyle||"solid"}');
`}),r};var v=e.i(75555),j=e.i(40143),k=e.i(86491),w=e.i(15823),N=e.i(93803),S=e.i(19273),R=e.i(80166),C=class extends w.Subscribable{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#r=(0,N.pendingThenable)(),this.bindMethods(),this.setOptions(t)}#e;#a=void 0;#s=void 0;#l=void 0;#i;#n;#r;#t;#o;#d;#c;#h;#u;#m;#x=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#a.addObserver(this),E(this.#a,this.options)?this.#b():this.updateResult(),this.#p())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return T(this.#a,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return T(this.#a,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#g(),this.#y(),this.#a.removeObserver(this)}setOptions(e){let t=this.options,r=this.#a;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,S.resolveEnabled)(this.options.enabled,this.#a))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#f(),this.#a.setOptions(this.options),t._defaulted&&!(0,S.shallowEqualObjects)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#a,observer:this});let a=this.hasListeners();a&&M(this.#a,r,this.options,t)&&this.#b(),this.updateResult(),a&&(this.#a!==r||(0,S.resolveEnabled)(this.options.enabled,this.#a)!==(0,S.resolveEnabled)(t.enabled,this.#a)||(0,S.resolveStaleTime)(this.options.staleTime,this.#a)!==(0,S.resolveStaleTime)(t.staleTime,this.#a))&&this.#v();let s=this.#j();a&&(this.#a!==r||(0,S.resolveEnabled)(this.options.enabled,this.#a)!==(0,S.resolveEnabled)(t.enabled,this.#a)||s!==this.#m)&&this.#k(s)}getOptimisticResult(e){var t,r;let a=this.#e.getQueryCache().build(this.#e,e),s=this.createResult(a,e);return t=this,r=s,(0,S.shallowEqualObjects)(t.getCurrentResult(),r)||(this.#l=s,this.#n=this.options,this.#i=this.#a.state),s}getCurrentResult(){return this.#l}trackResult(e,t){return new Proxy(e,{get:(e,r)=>(this.trackProp(r),t?.(r),"promise"===r&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#r.status||this.#r.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,r))})}trackProp(e){this.#x.add(e)}getCurrentQuery(){return this.#a}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),r=this.#e.getQueryCache().build(this.#e,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#b({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#l))}#b(e){this.#f();let t=this.#a.fetch(this.options,e);return e?.throwOnError||(t=t.catch(S.noop)),t}#v(){this.#g();let e=(0,S.resolveStaleTime)(this.options.staleTime,this.#a);if(S.isServer||this.#l.isStale||!(0,S.isValidTimeout)(e))return;let t=(0,S.timeUntilStale)(this.#l.dataUpdatedAt,e);this.#h=R.timeoutManager.setTimeout(()=>{this.#l.isStale||this.updateResult()},t+1)}#j(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#a):this.options.refetchInterval)??!1}#k(e){this.#y(),this.#m=e,!S.isServer&&!1!==(0,S.resolveEnabled)(this.options.enabled,this.#a)&&(0,S.isValidTimeout)(this.#m)&&0!==this.#m&&(this.#u=R.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||v.focusManager.isFocused())&&this.#b()},this.#m))}#p(){this.#v(),this.#k(this.#j())}#g(){this.#h&&(R.timeoutManager.clearTimeout(this.#h),this.#h=void 0)}#y(){this.#u&&(R.timeoutManager.clearInterval(this.#u),this.#u=void 0)}createResult(e,t){let r,a=this.#a,s=this.options,l=this.#l,i=this.#i,n=this.#n,o=e!==a?e.state:this.#s,{state:d}=e,c={...d},h=!1;if(t._optimisticResults){let r=this.hasListeners(),l=!r&&E(e,t),i=r&&M(e,a,t,s);(l||i)&&(c={...c,...(0,k.fetchState)(d.data,e.options)}),"isRestoring"===t._optimisticResults&&(c.fetchStatus="idle")}let{error:u,errorUpdatedAt:m,status:x}=c;r=c.data;let b=!1;if(void 0!==t.placeholderData&&void 0===r&&"pending"===x){let e;l?.isPlaceholderData&&t.placeholderData===n?.placeholderData?(e=l.data,b=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#c?.state.data,this.#c):t.placeholderData,void 0!==e&&(x="success",r=(0,S.replaceData)(l?.data,e,t),h=!0)}if(t.select&&void 0!==r&&!b)if(l&&r===i?.data&&t.select===this.#o)r=this.#d;else try{this.#o=t.select,r=t.select(r),r=(0,S.replaceData)(l?.data,r,t),this.#d=r,this.#t=null}catch(e){this.#t=e}this.#t&&(u=this.#t,r=this.#d,m=Date.now(),x="error");let p="fetching"===c.fetchStatus,g="pending"===x,y="error"===x,f=g&&p,v=void 0!==r,j={status:x,fetchStatus:c.fetchStatus,isPending:g,isSuccess:"success"===x,isError:y,isInitialLoading:f,isLoading:f,data:r,dataUpdatedAt:c.dataUpdatedAt,error:u,errorUpdatedAt:m,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>o.dataUpdateCount||c.errorUpdateCount>o.errorUpdateCount,isFetching:p,isRefetching:p&&!g,isLoadingError:y&&!v,isPaused:"paused"===c.fetchStatus,isPlaceholderData:h,isRefetchError:y&&v,isStale:I(e,t),refetch:this.refetch,promise:this.#r,isEnabled:!1!==(0,S.resolveEnabled)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=void 0!==j.data,r="error"===j.status&&!t,s=e=>{r?e.reject(j.error):t&&e.resolve(j.data)},l=()=>{s(this.#r=j.promise=(0,N.pendingThenable)())},i=this.#r;switch(i.status){case"pending":e.queryHash===a.queryHash&&s(i);break;case"fulfilled":(r||j.data!==i.value)&&l();break;case"rejected":r&&j.error===i.reason||l()}}return j}updateResult(){let e=this.#l,t=this.createResult(this.#a,this.options);if(this.#i=this.#a.state,this.#n=this.options,void 0!==this.#i.data&&(this.#c=this.#a),(0,S.shallowEqualObjects)(t,e))return;this.#l=t;let r=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,r="function"==typeof t?t():t;if("all"===r||!r&&!this.#x.size)return!0;let a=new Set(r??this.#x);return this.options.throwOnError&&a.add("error"),Object.keys(this.#l).some(t=>this.#l[t]!==e[t]&&a.has(t))};this.#w({listeners:r()})}#f(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#a)return;let t=this.#a;this.#a=e,this.#s=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#p()}#w(e){j.notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#l)}),this.#e.getQueryCache().notify({query:this.#a,type:"observerResultsUpdated"})})}};function E(e,t){return!1!==(0,S.resolveEnabled)(t.enabled,e)&&void 0===e.state.data&&("error"!==e.state.status||!1!==t.retryOnMount)||void 0!==e.state.data&&T(e,t,t.refetchOnMount)}function T(e,t,r){if(!1!==(0,S.resolveEnabled)(t.enabled,e)&&"static"!==(0,S.resolveStaleTime)(t.staleTime,e)){let a="function"==typeof r?r(e):r;return"always"===a||!1!==a&&I(e,t)}return!1}function M(e,t,r,a){return(e!==t||!1===(0,S.resolveEnabled)(a.enabled,e))&&(!r.suspense||"error"!==e.state.status)&&I(e,r)}function I(e,t){return!1!==(0,S.resolveEnabled)(t.enabled,e)&&e.isStaleByTime((0,S.resolveStaleTime)(t.staleTime,e))}e.i(47167);var O=e.i(12598),D=a.createContext((t=!1,{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t})),_=a.createContext(!1);_.Provider;var Q=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function $(e,t){return function(e,t,r){let s,l=a.useContext(_),i=a.useContext(D),n=(0,O.useQueryClient)(r),o=n.defaultQueryOptions(e);n.getDefaultOptions().queries?._experimental_beforeQuery?.(o);let d=n.getQueryCache().get(o.queryHash);if(o._optimisticResults=l?"isRestoring":"optimistic",o.suspense){let e=e=>"static"===e?e:Math.max(e??1e3,1e3),t=o.staleTime;o.staleTime="function"==typeof t?(...r)=>e(t(...r)):e(t),"number"==typeof o.gcTime&&(o.gcTime=Math.max(o.gcTime,1e3))}s=d?.state.error&&"function"==typeof o.throwOnError?(0,S.shouldThrowError)(o.throwOnError,[d.state.error,d]):o.throwOnError,(o.suspense||o.experimental_prefetchInRender||s)&&!i.isReset()&&(o.retryOnMount=!1),a.useEffect(()=>{i.clearReset()},[i]);let c=!n.getQueryCache().get(o.queryHash),[h]=a.useState(()=>new t(n,o)),u=h.getOptimisticResult(o),m=!l&&!1!==e.subscribed;if(a.useSyncExternalStore(a.useCallback(e=>{let t=m?h.subscribe(j.notifyManager.batchCalls(e)):S.noop;return h.updateResult(),t},[h,m]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),a.useEffect(()=>{h.setOptions(o)},[o,h]),o?.suspense&&u.isPending)throw Q(o,h,i);if((({result:e,errorResetBoundary:t,throwOnError:r,query:a,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&a&&(s&&void 0===e.data||(0,S.shouldThrowError)(r,[e.error,a])))({result:u,errorResetBoundary:i,throwOnError:o.throwOnError,query:d,suspense:o.suspense}))throw u.error;if(n.getDefaultOptions().queries?._experimental_afterQuery?.(o,u),o.experimental_prefetchInRender&&!S.isServer&&u.isLoading&&u.isFetching&&!l){let e=c?Q(o,h,i):d?.promise;e?.catch(S.noop).finally(()=>{h.updateResult()})}return o.notifyOnChangeProps?u:h.trackResult(u)}(e,C,t)}var L=e.i(14272),z=w,U=class extends z.Subscribable{#e;#l=void 0;#N;#S;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#R()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,S.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#N,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,S.hashKey)(t.mutationKey)!==(0,S.hashKey)(this.options.mutationKey)?this.reset():this.#N?.state.status==="pending"&&this.#N.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#N?.removeObserver(this)}onMutationUpdate(e){this.#R(),this.#w(e)}getCurrentResult(){return this.#l}reset(){this.#N?.removeObserver(this),this.#N=void 0,this.#R(),this.#w()}mutate(e,t){return this.#S=t,this.#N?.removeObserver(this),this.#N=this.#e.getMutationCache().build(this.#e,this.options),this.#N.addObserver(this),this.#N.execute(e)}#R(){let e=this.#N?.state??(0,L.getDefaultState)();this.#l={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#w(e){j.notifyManager.batch(()=>{if(this.#S&&this.hasListeners()){let t=this.#l.variables,r=this.#l.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#S.onSuccess?.(e.data,t,r,a)}catch(e){Promise.reject(e)}try{this.#S.onSettled?.(e.data,null,t,r,a)}catch(e){Promise.reject(e)}}else if(e?.type==="error"){try{this.#S.onError?.(e.error,t,r,a)}catch(e){Promise.reject(e)}try{this.#S.onSettled?.(void 0,e.error,t,r,a)}catch(e){Promise.reject(e)}}}this.listeners.forEach(e=>{e(this.#l)})})}};function P(e,t){let r=(0,O.useQueryClient)(t),[s]=a.useState(()=>new U(r,e));a.useEffect(()=>{s.setOptions(e)},[s,e]);let l=a.useSyncExternalStore(a.useCallback(e=>s.subscribe(j.notifyManager.batchCalls(e)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),i=a.useCallback((e,t)=>{s.mutate(e,t).catch(S.noop)},[s]);if(l.error&&(0,S.shouldThrowError)(s.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:i,mutateAsync:l.mutate}}var F=e.i(93338),A=e.i(72493);let K={en:{appTitle:"Robinson Family Tree",tree:"Tree",directory:"Directory",settings:"Settings",searchPlaceholder:"Find family member...",export:"Export SQL",addMember:"Add Member",addCenterMember:"Add Center Member",emptyStateTitle:"Start Your Family Tree",emptyStateDesc:"No family members found. Please add yourself as the center member to begin.",name:"Name",nameZh:"Name (Chinese)",role:"Role / Relation",birthDate:"Birth Date",location:"Location",save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",setAsSelf:"Set as Me",isSelf:"Me",connectPrompt:"Drag from a dot to connect",connectionLabel:"Relationship Label",connectionLabelZh:"Relationship Label (CN)",sourceHandle:"Source Position",targetHandle:"Target Position",top:"Top",right:"Right",bottom:"Bottom",left:"Left",male:"Male",female:"Female",centerOnMe:"Reset to Me",lock:"Lock",unlock:"Unlock",autoArrange:"Auto Arrange",lineColor:"Line Color",lineStyle:"Line Style",solid:"Solid",dashed:"Dashed",dotted:"Dotted",calculatedRelation:"Relation to You"},zh:{appTitle:"罗宾逊家族树",tree:"族谱图",directory:"通讯录",settings:"设置",searchPlaceholder:"查找家庭成员...",export:"导出 SQL",addMember:"添加成员",addCenterMember:"添加核心成员",emptyStateTitle:"开始您的家族树",emptyStateDesc:"暂无数据。请先添加您自己作为核心成员。",name:"姓名",nameZh:"中文名",role:"角色 / 关系",birthDate:"出生日期",location:"地点",save:"保存",cancel:"取消",delete:"删除",edit:"编辑",setAsSelf:"设为自己",isSelf:"我",connectPrompt:"从圆点拖动以连接",connectionLabel:"关系称呼",connectionLabelZh:"关系称呼 (中文)",sourceHandle:"起始位置",targetHandle:"目标位置",top:"上",right:"右",bottom:"下",left:"左",male:"男",female:"女",centerOnMe:"回到中心",lock:"锁定",unlock:"解锁",autoArrange:"自动排列",lineColor:"线条颜色",lineStyle:"线条样式",solid:"实线",dashed:"虚线",dotted:"点线",calculatedRelation:"与我的关系"}},Z=({currentView:e,setView:t,showChinese:a,setShowChinese:s})=>{let l=K[a?"zh":"en"],i=async()=>{let e=new Blob([await f()],{type:"text/sql"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`robinson_family_tree_${new Date().toISOString().split("T")[0]}.sql`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)};return(0,r.jsxs)("header",{className:"fixed top-0 left-0 right-0 z-50 flex items-center justify-between px-6 py-4 bg-white/60 dark:bg-black/60 backdrop-blur-md border-b border-white/20 dark:border-white/10 shadow-sm",children:[(0,r.jsx)("div",{className:"flex items-center gap-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 text-slate-900 dark:text-white cursor-pointer",onClick:()=>t("tree"),children:[(0,r.jsx)("div",{className:"p-2 bg-primary/20 rounded-lg text-primary-dark dark:text-primary",children:(0,r.jsx)("span",{className:"material-symbols-outlined text-2xl",children:"account_tree"})}),(0,r.jsx)("h1",{className:"text-xl font-bold tracking-tight hidden sm:block",children:l.appTitle})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("nav",{className:"hidden lg:flex items-center gap-2 mr-4",children:[(0,r.jsx)("button",{onClick:()=>t("tree"),className:`px-4 py-2 rounded-xl text-sm font-bold transition-colors ${"tree"===e?"bg-primary/20 text-primary-dark dark:text-primary":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:l.tree}),(0,r.jsx)("button",{onClick:()=>t("directory"),className:`px-4 py-2 rounded-xl text-sm font-bold transition-colors ${"directory"===e?"bg-primary/20 text-primary-dark dark:text-primary":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:l.directory})]}),(0,r.jsxs)("button",{onClick:()=>s(!a),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-100 dark:bg-white/10 hover:bg-gray-200 dark:hover:bg-white/20 rounded-lg transition-all",title:"Toggle Language",children:[(0,r.jsx)("span",{className:"material-symbols-outlined text-[18px] text-gray-600 dark:text-gray-300",children:"translate"}),(0,r.jsx)("span",{className:"text-xs font-bold font-mono text-gray-700 dark:text-gray-200 w-6 text-center",children:a?"CN":"EN"})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("button",{onClick:i,className:"flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl text-sm font-bold transition-colors shadow-sm active:scale-95",children:[(0,r.jsx)("span",{className:"material-symbols-outlined text-[20px]",children:"database"}),(0,r.jsx)("span",{className:"hidden xl:inline",children:l.export})]})}),(0,r.jsx)("div",{className:"w-px h-8 bg-gray-200 dark:bg-gray-700 mx-1"}),(0,r.jsx)("div",{className:"h-10 w-10 rounded-full bg-cover bg-center border-2 border-white dark:border-gray-800 shadow-sm cursor-pointer hover:ring-2 hover:ring-primary transition-all",style:{backgroundImage:"url('https://picsum.photos/id/64/200/200')"}})]})]})},H={son:"parent",daughter:"parent",child:"parent",father:"child",mother:"child",parent:"child",brother:"sibling",sister:"sibling",sibling:"sibling",husband:"wife",wife:"husband",spouse:"spouse","ex-husband":"ex-wife","ex-wife":"ex-husband",partner:"partner"},X=({isOpen:e,onClose:t,onSave:s,onDelete:l,connection:i,lang:n})=>{let o=K[n],[d,c]=(0,a.useState)({});if((0,a.useEffect)(()=>{e&&i&&c({...i,color:i.color||"#80ec13",lineStyle:i.lineStyle||"solid"})},[e,i]),!e||!i)return null;let h=["top","right","bottom","left"];return(0,r.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 animate-[fadeIn_0.2s_ease-out]",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-900/50",children:(0,r.jsx)("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Edit Connection"})}),(0,r.jsxs)("div",{className:"p-6 space-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Quick Presets"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:[{en:"Father",zh:"父亲"},{en:"Mother",zh:"母亲"},{en:"Son",zh:"儿子"},{en:"Daughter",zh:"女儿"},{en:"Husband",zh:"丈夫"},{en:"Wife",zh:"妻子"},{en:"Brother",zh:"兄弟"},{en:"Sister",zh:"姐妹"},{en:"Ex-Husband",zh:"前夫"},{en:"Ex-Wife",zh:"前妻"}].map((e,t)=>(0,r.jsx)("button",{onClick:()=>{c(t=>({...t,label:e.en,labelZh:e.zh}))},className:"px-3 py-1.5 text-xs font-medium bg-gray-100 dark:bg-white/10 hover:bg-primary/20 hover:text-primary-dark dark:hover:text-primary rounded-lg transition-colors border border-transparent hover:border-primary/30",children:"zh"===n?e.zh:e.en},t))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:o.connectionLabel}),(0,r.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:d.label||"",onChange:e=>c({...d,label:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:o.connectionLabelZh}),(0,r.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:d.labelZh||"",onChange:e=>c({...d,labelZh:e.target.value})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:o.sourceHandle}),(0,r.jsx)("select",{className:"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none",value:d.sourceHandle,onChange:e=>c({...d,sourceHandle:e.target.value}),children:h.map(e=>(0,r.jsx)("option",{value:e,children:o[e]},e))})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:o.targetHandle}),(0,r.jsx)("select",{className:"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none",value:d.targetHandle,onChange:e=>c({...d,targetHandle:e.target.value}),children:h.map(e=>(0,r.jsx)("option",{value:e,children:o[e]},e))})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:o.lineColor}),(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 dark:bg-gray-900 p-1.5 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("input",{type:"color",className:"h-8 w-8 p-0 border-0 rounded cursor-pointer bg-transparent",value:d.color||"#80ec13",onChange:e=>c({...d,color:e.target.value})}),(0,r.jsx)("span",{className:"text-xs text-gray-500 font-mono",children:d.color})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:o.lineStyle}),(0,r.jsx)("select",{className:"w-full px-2 py-2.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none",value:d.lineStyle,onChange:e=>c({...d,lineStyle:e.target.value}),children:["solid","dashed","dotted"].map(e=>(0,r.jsx)("option",{value:e,children:o[e]},e))})]})]})]}),(0,r.jsxs)("div",{className:"p-6 pt-2 flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>{l(i.id),t()},className:"p-3 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors",title:o.delete,children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"delete"})}),(0,r.jsx)("button",{onClick:t,className:"flex-1 py-3 rounded-xl font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:o.cancel}),(0,r.jsx)("button",{onClick:()=>s(d),className:"flex-1 py-3 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl font-bold transition-colors shadow-lg shadow-primary/20",children:o.save})]})]})})},q=({selectedId:e,onSelect:t,showChinese:s,members:l,connections:i,onDataChange:n,onEditMember:o})=>{let d=s?"zh":"en",c=K[d],[h,x]=(0,a.useState)(1),[b,f]=(0,a.useState)({x:0,y:0}),[v,j]=(0,a.useState)(!0),[k,w]=(0,a.useState)(l),[N,S]=(0,a.useState)(null),[R,C]=(0,a.useState)(null),[E,T]=(0,a.useState)(null),[M,I]=(0,a.useState)({horizontal:[],vertical:[]}),[O,D]=(0,a.useState)(null),[_,Q]=(0,a.useState)([]),[$,L]=(0,a.useState)(!1),[z,U]=(0,a.useState)(null),[P,F]=(0,a.useState)(null),A=(0,a.useRef)(null),Z=(0,a.useRef)(!1),q=(0,a.useRef)({x:0,y:0});(0,a.useEffect)(()=>{w(l)},[l]),(0,a.useEffect)(()=>{B()},[k]);let B=()=>{let e=k.find(e=>e.isSelf);if(e&&A.current){let{width:t,height:r}=A.current.getBoundingClientRect();f({x:t/2-e.x*h,y:r/2-e.y*h})}},Y=(e,t,r)=>{switch(r){case"top":return{x:e+130,y:t};case"right":return{x:e+260,y:t+50};case"bottom":return{x:e+130,y:t+100};case"left":return{x:e,y:t+50}}},W=()=>{if(N){let e=k.find(e=>e.id===N);if(e){if(O){let t={...e,x:O.x,y:O.y};w(e=>e.map(e=>e.id===N?t:e)),m(t)}else m(e);n()}S(null),I({horizontal:[],vertical:[]}),D(null)}if(R&&E){let e=E.x-130,t=E.y-50,r=20*Math.round(e/20),a=20*Math.round(t/20),s=crypto.randomUUID(),l={id:s,name:"",role:"",x:r,y:a,gender:"male",avatar:`https://picsum.photos/seed/${Date.now()}/200/200`};u(l),p({id:crypto.randomUUID(),sourceId:R.id,targetId:s,sourceHandle:R.handle,targetHandle:"top",label:"Relation",labelZh:"关系"}),n(),setTimeout(()=>o(l),50)}C(null),T(null),Z.current=!1},V=(e,t)=>{e.stopPropagation(),o(t)},G=(0,a.useMemo)(()=>{let e=new Map;return k.forEach(t=>{let r=((e,t,r,a)=>{let s=t.find(e=>e.isSelf);if(!s||s.id===e)return null;let l={};r.forEach(e=>{var r;let s,i;l[e.sourceId]||(l[e.sourceId]=[]),l[e.targetId]||(l[e.targetId]=[]);let n=t.find(t=>t.id===e.sourceId),o=t.find(t=>t.id===e.targetId);if(!n||!o)return;l[e.sourceId].push({to:e.targetId,label:a&&e.labelZh?e.labelZh:e.label});let d=a?"长辈/亲属":(r=e.label,"parent"===(i=H[s=r.toLowerCase()]||"relative")?"male"===n.gender?"Father":"Mother":"child"===i?"male"===n.gender?"Son":"Daughter":"sibling"===i?"male"===n.gender?"Brother":"Sister":H[s]?H[s].charAt(0).toUpperCase()+H[s].slice(1):i.charAt(0).toUpperCase()+i.slice(1)),c=d;a&&(c="Linked","Father"===d&&(c="父亲"),"Mother"===d&&(c="母亲"),"Son"===d&&(c="儿子"),"Daughter"===d&&(c="女儿"),"Brother"===d&&(c="兄弟"),"Sister"===d&&(c="姐妹"),"Wife"===d&&(c="妻子"),"Husband"===d&&(c="丈夫")),l[e.targetId].push({to:e.sourceId,label:c})});let i=[{id:s.id,path:[]}],n=new Set([s.id]);for(;i.length>0;){let{id:t,path:r}=i.shift();if(t===e)return r.join(" › ");for(let e of l[t]||[])!n.has(e.to)&&(n.add(e.to),r.length<3&&i.push({id:e.to,path:[...r,e.label]}))}return null})(t.id,k,i,s);e.set(t.id,r)}),e},[k,i,s]);return 0===k.length?(0,r.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center bg-background-light dark:bg-background-dark p-6",children:(0,r.jsxs)("div",{className:"text-center space-y-6 max-w-md",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-primary/20 rounded-full flex items-center justify-center mx-auto text-primary",children:(0,r.jsx)("span",{className:"material-symbols-outlined text-5xl",children:"forest"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:c.emptyStateTitle}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:c.emptyStateDesc})]}),(0,r.jsx)("button",{onClick:()=>{o({id:crypto.randomUUID(),name:"",role:"Me",x:0,y:0,gender:"male",avatar:"https://picsum.photos/200",isSelf:!0})},className:"px-8 py-3 bg-primary hover:bg-primary-dark text-slate-900 font-bold rounded-xl shadow-lg shadow-primary/20 transition-all hover:scale-105",children:c.addCenterMember})]})}):(0,r.jsxs)("div",{className:"flex-1 relative overflow-hidden bg-background-light dark:bg-background-dark cursor-grab active:cursor-grabbing h-full selection:bg-none",onMouseDown:e=>{!e.target||e.target.closest(".node-card, button, .handle")||(Z.current=!0,q.current={x:e.clientX,y:e.clientY})},onMouseMove:e=>{let t=e.clientX-q.current.x,r=e.clientY-q.current.y;if(q.current={x:e.clientX,y:e.clientY},N&&!v){let e=k.find(e=>e.id===N);if(e){let a,s,l,i,n,{guides:o,snapPosition:d}=(a={horizontal:[],vertical:[]},s=e.x+t/h,l=e.y+r/h,i=20*Math.round(s/20),n=20*Math.round(l/20),k.forEach(t=>{t.id===e.id||(5>Math.abs(l-t.y)&&a.horizontal.push(t.y),5>Math.abs(s-t.x)&&a.vertical.push(t.x),5>Math.abs(l-(t.y+50))&&a.horizontal.push(t.y+50),5>Math.abs(s-(t.x+130))&&a.vertical.push(t.x+130))}),{guides:a,snapPosition:{x:i,y:n}});I(o),D(d),w(e=>e.map(e=>e.id===N?{...e,x:e.x+t/h,y:e.y+r/h}:e))}}else if(R){if(A.current){let t=A.current.getBoundingClientRect();T({x:(e.clientX-t.left-b.x)/h,y:(e.clientY-t.top-b.y)/h})}}else Z.current&&f(e=>({x:e.x+t,y:e.y+r}))},onMouseUp:W,onMouseLeave:W,ref:A,children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-grid-pattern dark:bg-grid-pattern-dark bg-grid opacity-40 pointer-events-none"}),(0,r.jsxs)("div",{className:"absolute inset-0 transform-gpu transition-transform duration-75 origin-top-left",style:{transform:`translate(${b.x}px, ${b.y}px) scale(${h})`},children:[(0,r.jsxs)("svg",{className:"absolute top-0 left-0 overflow-visible z-10",style:{width:1,height:1},children:[M.horizontal.map((e,t)=>(0,r.jsx)("line",{x1:"0",y1:e,x2:"10000",y2:e,stroke:"#80ec13",strokeWidth:"2",strokeDasharray:"5,5",className:"animate-pulse"},`h-${t}`)),M.vertical.map((e,t)=>(0,r.jsx)("line",{x1:e,y1:"0",x2:e,y2:"10000",stroke:"#80ec13",strokeWidth:"2",strokeDasharray:"5,5",className:"animate-pulse"},`v-${t}`))]}),(0,r.jsxs)("svg",{className:"absolute top-0 left-0 overflow-visible z-0",style:{width:1,height:1},children:[i.map(e=>{var t,a,l,i,n,o;let d,c,h,u,m=k.find(t=>t.id===e.sourceId),x=k.find(t=>t.id===e.targetId);if(!m||!x)return null;let b=Y(m.x,m.y,e.sourceHandle),p=Y(x.x,x.y,e.targetHandle),g=(t=b.x,a=b.y,l=e.sourceHandle,i=p.x,n=p.y,o=e.targetHandle,d=Math.min(200,Math.max(50,.4*(Math.abs(i-t)+Math.abs(n-a)))),h=(c=(e,t,r,a)=>{switch(r){case"top":return{x:e,y:t-a};case"bottom":return{x:e,y:t+a};case"left":return{x:e-a,y:t};case"right":return{x:e+a,y:t}}})(t,a,l,d),u=c(i,n,o,d),`M ${t} ${a} C ${h.x} ${h.y}, ${u.x} ${u.y}, ${i} ${n}`),y=(b.x+p.x)/2,f=(b.y+p.y)/2;return e.color,(0,r.jsxs)("g",{className:"group cursor-pointer",onClick:t=>{t.stopPropagation(),U(e),L(!0)},children:[(0,r.jsx)("path",{d:g,fill:"none",stroke:"transparent",strokeWidth:15}),(0,r.jsx)("path",{d:g,fill:"none",stroke:e.color||"#e5e7eb",strokeWidth:3,strokeDasharray:(e=>{switch(e){case"dashed":return"8 4";case"dotted":return"2 2";default:return""}})(e.lineStyle),className:"dark:stroke-gray-600 transition-colors group-hover:stroke-primary/80"}),(0,r.jsx)("foreignObject",{x:y-40,y:f-12,width:80,height:24,children:(0,r.jsx)("div",{className:"flex items-center justify-center px-2 py-0.5 bg-white dark:bg-gray-800 border rounded-full shadow-sm text-[10px] font-bold text-center truncate select-none hover:scale-110 transition-transform",style:{borderColor:e.color||"#80ec13",color:e.color||"inherit"},children:s&&e.labelZh?e.labelZh:e.label})})]},e.id)}),R&&E&&(0,r.jsx)("path",{d:`M ${Y(k.find(e=>e.id===R.id).x,k.find(e=>e.id===R.id).y,R.handle).x} ${Y(k.find(e=>e.id===R.id).x,k.find(e=>e.id===R.id).y,R.handle).y} L ${E.x} ${E.y}`,fill:"none",stroke:"#80ec13",strokeWidth:2,strokeDasharray:"5 5"})]}),k.map(a=>{let l=G.get(a.id);return(0,r.jsxs)("div",{className:`absolute node-card group ${v?"":"cursor-move"}`,style:{transform:`translate(${a.x}px, ${a.y}px)`,width:260,height:100},onMouseDown:e=>{e.stopPropagation(),v||S(a.id)},onClick:e=>{e.stopPropagation(),e.ctrlKey||e.metaKey?Q(e=>e.includes(a.id)?e.filter(e=>e!==a.id):[...e,a.id]):e.shiftKey?Q(e=>[...e,a.id]):(Q([a.id]),t(a.id))},onDoubleClick:e=>V(e,a),children:[!v&&["top","right","bottom","left"].map(e=>(0,r.jsx)("div",{className:`
                                        absolute w-4 h-4 bg-white dark:bg-gray-800 border-2 border-primary rounded-full z-30 cursor-crosshair handle
                                        transition-all hover:scale-150 hover:bg-primary
                                        ${"top"===e?"-top-2 left-1/2 -translate-x-1/2":""}
                                        ${"right"===e?"-right-2 top-1/2 -translate-y-1/2":""}
                                        ${"bottom"===e?"-bottom-2 left-1/2 -translate-x-1/2":""}
                                        ${"left"===e?"-left-2 top-1/2 -translate-y-1/2":""}
                                        ${R?"opacity-100 scale-110":"opacity-0 group-hover:opacity-100"}
                                    `,onMouseDown:t=>{var r;return r=a.id,void(t.stopPropagation(),!v&&C({id:r,handle:e}))},onMouseUp:t=>{var r,s,l;return r=t,s=a.id,l=e,void(r.stopPropagation(),R&&R.id!==s&&(p({id:crypto.randomUUID(),sourceId:R.id,targetId:s,sourceHandle:R.handle,targetHandle:l,label:"Relation",labelZh:"关系"}),n()),C(null),T(null))},title:c.connectPrompt},e)),(0,r.jsxs)("div",{className:`
                                w-full h-full p-4 rounded-xl flex items-center gap-4 transition-all select-none
                                ${e===a.id?"bg-card-light dark:bg-card-dark backdrop-blur-md ring-2 ring-primary shadow-xl border-primary":_.includes(a.id)?"bg-card-light dark:bg-card-dark backdrop-blur-md ring-2 ring-blue-500 shadow-xl border-blue-500":"bg-card-light dark:bg-card-dark backdrop-blur-md border border-white/50 dark:border-white/10 shadow-lg hover:border-primary/50"}
                            `,children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-14 h-14 rounded-full bg-cover bg-center border-2 border-white dark:border-gray-700 shadow-sm pointer-events-none",style:{backgroundImage:`url('${a.avatar}')`}}),a.isSelf&&(0,r.jsx)("div",{className:"absolute -bottom-1 -right-1 flex items-center justify-center w-5 h-5 bg-primary rounded-full border-2 border-white dark:border-gray-800 text-[10px] font-bold text-slate-900",title:"Me",children:"M"})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0 text-left pointer-events-none",children:[(0,r.jsx)("h3",{className:"text-slate-900 dark:text-white font-bold truncate",children:s&&a.nameZh?a.nameZh:a.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:a.birthDate||"Unknown"}),l&&(0,r.jsx)("p",{className:"text-[10px] text-primary-dark dark:text-primary font-bold mt-1 truncate",title:l,children:l}),!l&&(0,r.jsx)("span",{className:"inline-block mt-1 text-[10px] uppercase tracking-wider text-gray-400",children:a.role})]}),!v&&(0,r.jsx)("button",{onClick:e=>V(e,a),className:"p-1.5 hover:bg-black/5 dark:hover:bg-white/10 rounded-lg text-gray-400 hover:text-primary transition-colors z-20 relative",children:(0,r.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"edit"})})]})]},a.id)})]}),(0,r.jsx)("div",{className:"absolute bottom-40 left-1/2 -translate-x-1/2 z-20 flex flex-col items-center gap-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-white/80 dark:bg-black/60 backdrop-blur-md rounded-2xl shadow-lg border border-white/20 dark:border-white/10",children:[(0,r.jsx)("button",{onClick:()=>j(!v),className:`w-10 h-10 flex items-center justify-center rounded-xl transition-colors ${v?"text-gray-500 hover:bg-black/5 dark:hover:bg-white/10":"text-primary bg-primary/10 ring-2 ring-primary/20"}`,title:v?c.unlock:c.lock,children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:v?"lock":"lock_open"})}),(0,r.jsx)("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),(0,r.jsx)("button",{onClick:()=>B(),className:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors",title:c.centerOnMe,children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"my_location"})}),(0,r.jsx)("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),(0,r.jsx)("button",{onClick:()=>x(e=>Math.max(.5,e-.1)),className:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors",children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"remove"})}),(0,r.jsxs)("div",{className:"px-2 text-sm font-semibold text-gray-600 dark:text-gray-300 min-w-[3rem] text-center",children:[Math.round(100*h),"%"]}),(0,r.jsx)("button",{onClick:()=>x(e=>Math.min(2,e+.1)),className:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors",children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"add"})})]})}),(0,r.jsx)("div",{className:"absolute bottom-40 right-8 z-20 flex flex-col gap-4 items-end",children:(0,r.jsx)("button",{onClick:()=>{o({id:crypto.randomUUID(),name:"",role:"",x:0,y:0,gender:"male",avatar:"https://picsum.photos/200"})},className:"w-16 h-16 bg-primary hover:bg-primary-dark text-slate-900 rounded-2xl shadow-[0_8px_30px_rgb(128,236,19,0.3)] flex items-center justify-center transition-all hover:scale-110 active:scale-95 group",title:c.addMember,children:(0,r.jsx)("span",{className:"material-symbols-outlined text-3xl",children:"add"})})}),(0,r.jsx)(X,{isOpen:$,onClose:()=>L(!1),onSave:e=>{g(e),n(),L(!1),U(null)},onDelete:e=>{y(e),n()},connection:z,lang:d})]})},B=({onSelect:e,showChinese:t,members:a})=>(0,r.jsx)("div",{className:"flex-1 overflow-y-auto pt-24 pb-40 px-6 md:px-10 bg-background-light dark:bg-background-dark",children:(0,r.jsxs)("div",{className:"max-w-[1400px] mx-auto flex flex-col gap-8",children:[(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:(0,r.jsxs)("div",{className:"flex flex-col gap-1 p-5 rounded-xl bg-white dark:bg-card-dark border border-gray-100 dark:border-white/5 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Total Members"}),(0,r.jsx)("span",{className:"material-symbols-outlined text-primary",children:"groups"})]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:a.length})]})}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.map(a=>(0,r.jsxs)("div",{className:"group relative flex flex-col bg-white dark:bg-card-dark rounded-xl border border-gray-100 dark:border-white/5 shadow-sm overflow-hidden transition-all hover:shadow-md hover:border-primary/50",children:[(0,r.jsxs)("div",{className:"p-6 flex flex-col items-center gap-4 border-b border-gray-50 dark:border-white/5",children:[(0,r.jsx)("div",{className:"size-24 rounded-full bg-cover bg-center border-4 border-white dark:border-gray-700 shadow-sm group-hover:scale-105 transition-transform duration-300",style:{backgroundImage:`url('${a.avatar}')`}}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:t&&a.nameZh?a.nameZh:a.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.role})]}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-white/10 text-gray-600 dark:text-gray-300 capitalize",children:a.gender})})]}),(0,r.jsxs)("div",{className:"p-4 flex flex-col gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"cake"}),(0,r.jsx)("span",{children:a.birthDate||"N/A"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"location_on"}),(0,r.jsx)("span",{children:a.location||"N/A"})]})]}),(0,r.jsx)("div",{className:"mt-auto p-4 bg-gray-50 dark:bg-white/5 flex items-center justify-between",children:(0,r.jsx)("button",{onClick:()=>e(a.id),className:"w-full text-center text-xs font-bold text-gray-600 dark:text-gray-300 hover:text-primary transition-colors",children:"View Profile"})})]},a.id))})]})}),Y=()=>(0,r.jsx)("div",{className:"flex-1 overflow-y-auto pt-24 pb-20 px-6 md:px-10 bg-background-light dark:bg-background-dark",children:(0,r.jsxs)("div",{className:"max-w-[960px] mx-auto flex flex-col gap-8 animate-fade-in",children:[(0,r.jsxs)("div",{className:"flex flex-wrap justify-between gap-4 p-4 items-end",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsx)("h1",{className:"text-slate-900 dark:text-white text-4xl font-black leading-tight",children:"Privacy & Visibility"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-base font-normal max-w-2xl",children:"Manage visual hierarchy, control access permissions, and filter specific branches for your family tree visualization."})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{className:"flex items-center justify-center h-10 px-5 text-sm font-bold bg-white dark:bg-white/10 border border-gray-200 dark:border-white/10 rounded-lg text-slate-900 dark:text-white hover:bg-gray-50 dark:hover:bg-white/20 transition-colors",children:"Cancel"}),(0,r.jsx)("button",{className:"flex items-center justify-center h-10 px-5 text-sm font-bold bg-primary text-slate-900 rounded-lg hover:bg-primary-dark transition-colors shadow-lg shadow-primary/20",children:"Save Changes"})]})]}),(0,r.jsxs)("section",{className:"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm overflow-hidden p-6 md:p-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsx)("div",{className:"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary",children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"layers"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Visualization Depth"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Control how many generations are loaded by default."})]})]}),(0,r.jsxs)("div",{className:"relative flex w-full flex-col gap-6",children:[(0,r.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,r.jsx)("p",{className:"text-slate-900 dark:text-white text-lg font-bold",children:"Level 3: Great-Grandparents"}),(0,r.jsx)("div",{className:"px-3 py-1 rounded-full bg-primary/20 text-xs font-bold text-primary-dark dark:text-primary uppercase tracking-wide",children:"62 Profiles Visible"})]}),(0,r.jsxs)("div",{className:"relative w-full h-12 flex items-center group",children:[(0,r.jsx)("div",{className:"absolute w-full h-2 bg-gray-200 dark:bg-white/10 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-primary w-[60%] rounded-full"})}),(0,r.jsx)("input",{type:"range",min:"1",max:"5",defaultValue:"3",className:"absolute w-full h-full opacity-0 cursor-pointer z-10"}),(0,r.jsx)("div",{className:"absolute w-full flex justify-between px-1 pointer-events-none",children:[1,2,3,4,5].map(e=>(0,r.jsx)("div",{className:`size-4 rounded-full border-2 border-white dark:border-gray-800 transition-all ${e<=3?"bg-primary scale-110":"bg-gray-300 dark:bg-white/20"}`},e))})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("section",{className:"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm p-6 md:p-8 flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsx)("div",{className:"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary",children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"account_tree"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Branch Filters"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Toggle visibility of specific family lines."})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-6",children:[{title:"Paternal Side",sub:"Father's ancestors",active:!0},{title:"Maternal Side",sub:"Mother's ancestors",active:!0},{title:"In-Laws & Step-Family",sub:"Connected by marriage",active:!1}].map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-base font-semibold text-slate-900 dark:text-white",children:e.title}),(0,r.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.sub})]}),(0,r.jsx)("div",{className:`relative inline-flex h-7 w-12 items-center rounded-full transition-colors duration-200 ${e.active?"bg-primary":"bg-gray-300 dark:bg-white/20"}`,children:(0,r.jsx)("span",{className:`inline-block size-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${e.active?"translate-x-6":"translate-x-1"}`})})]},t))})]}),(0,r.jsxs)("section",{className:"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm p-6 md:p-8 flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,r.jsx)("div",{className:"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary",children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"lock"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Privacy Level"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Who can view your living relatives?"})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-4",children:[{title:"Public",sub:"Visible to all users",checked:!1},{title:"Family Members Only",sub:"Only invited members",checked:!0},{title:"Private",sub:"Only you",checked:!1}].map((e,t)=>(0,r.jsxs)("label",{className:`flex items-start gap-3 p-3 rounded-xl border cursor-pointer transition-colors ${e.checked?"border-primary/50 bg-primary/10":"border-transparent hover:bg-black/5 dark:hover:bg-white/5"}`,children:[(0,r.jsx)("input",{type:"radio",name:"privacy",defaultChecked:e.checked,className:"mt-1 text-primary focus:ring-primary bg-transparent"}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-sm font-bold text-slate-900 dark:text-white",children:e.title}),(0,r.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.sub})]})]},t))})]})]}),(0,r.jsxs)("section",{className:"rounded-2xl bg-gradient-to-r from-gray-900 to-gray-800 dark:from-black dark:to-[#1a1a1a] p-8 text-white flex flex-col md:flex-row items-center justify-between gap-6 shadow-lg",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("h3",{className:"text-xl font-bold",children:"Need more control?"}),(0,r.jsx)("p",{className:"text-white/70 max-w-lg text-sm",children:"Our Advanced Privacy Shield offers granular control over every single profile in your tree."})]}),(0,r.jsxs)("button",{className:"whitespace-nowrap px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg font-bold text-sm transition-all flex items-center gap-2",children:[(0,r.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"verified_user"}),"View Advanced Options"]})]})]})}),W=({member:e,onClose:t,onSelectMember:a,showChinese:s,onEdit:l,onDelete:i,members:n,connections:o})=>{var d;let c;if(!e)return null;let h=(d=e.id,c=[],o.forEach(e=>{if(e.sourceId===d){let t=n.find(t=>t.id===e.targetId);t&&c.push({relation:e.label,member:t})}else if(e.targetId===d){let t=n.find(t=>t.id===e.sourceId);t&&c.push({relation:"Linked by "+e.label,member:t})}}),c);return(0,r.jsxs)("aside",{className:"absolute top-24 right-6 bottom-32 w-80 md:w-96 bg-white/80 dark:bg-black/80 backdrop-blur-xl border border-white/40 dark:border-white/10 rounded-2xl shadow-2xl p-6 z-30 flex flex-col animate-[slideIn_0.3s_ease-out]",children:[(0,r.jsx)("style",{children:`
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Profile Details"}),(0,r.jsx)("button",{onClick:t,className:"p-1.5 hover:bg-black/5 dark:hover:bg-white/10 rounded-lg transition-colors",children:(0,r.jsx)("span",{className:"material-symbols-outlined text-gray-500 text-[20px]",children:"close"})})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,r.jsxs)("div",{className:"w-24 h-24 rounded-full p-1 border-2 border-primary border-dashed mb-3 relative group",children:[(0,r.jsx)("div",{className:"w-full h-full rounded-full bg-cover bg-center",style:{backgroundImage:`url('${e.avatar}')`}}),(0,r.jsx)("button",{onClick:l,className:"absolute bottom-0 right-0 p-1.5 bg-primary rounded-full text-slate-900 shadow-sm hover:scale-110 transition-transform cursor-pointer",children:(0,r.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"edit"})})]}),(0,r.jsx)("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:s&&e.nameZh?e.nameZh:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.role}),e.isSelf&&(0,r.jsx)("span",{className:"mt-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary/20 text-primary-dark dark:text-primary",children:"Center Member (Me)"})]}),(0,r.jsxs)("div",{className:"space-y-4 flex-1 overflow-y-auto no-scrollbar pr-1",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"bg-white/50 dark:bg-white/5 p-3 rounded-xl border border-white/40 dark:border-white/5",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Birth Date"}),(0,r.jsx)("p",{className:"font-semibold text-sm",children:e.birthDate})]}),(0,r.jsxs)("div",{className:"bg-white/50 dark:bg-white/5 p-3 rounded-xl border border-white/40 dark:border-white/5",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Location"}),(0,r.jsx)("p",{className:"font-semibold text-sm",children:e.location})]})]}),(0,r.jsxs)("div",{className:"bg-white/50 dark:bg-white/5 p-4 rounded-xl border border-white/40 dark:border-white/5",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Biography"}),(0,r.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:e.bio||"No biography added."})]}),(0,r.jsxs)("div",{className:"pt-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-bold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"material-symbols-outlined text-primary text-[18px]",children:"family_star"}),"Immediate Family"]}),(0,r.jsxs)("div",{className:"space-y-2",children:[0===h.length&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"No connections found."}),h.map(e=>(0,r.jsxs)("div",{onClick:()=>a(e.member.id),className:"flex items-center gap-3 p-2 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg transition-colors cursor-pointer group",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-cover bg-center",style:{backgroundImage:`url('${e.member.avatar}')`}}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-semibold group-hover:text-primary transition-colors",children:s&&e.member.nameZh?e.member.nameZh:e.member.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:e.relation})]}),(0,r.jsx)("span",{className:"material-symbols-outlined text-gray-400 text-[18px]",children:"chevron_right"})]},e.member.id))]})]})]}),(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex gap-2",children:[(0,r.jsx)("button",{onClick:l,className:"flex-1 bg-slate-900 hover:bg-gray-800 text-white dark:bg-white dark:text-black dark:hover:bg-gray-200 py-2.5 rounded-xl text-sm font-bold transition-colors shadow-lg",children:"Edit Profile"}),(0,r.jsx)("button",{onClick:i,className:"w-10 flex items-center justify-center bg-red-50 hover:bg-red-100 text-red-500 rounded-xl transition-colors",children:(0,r.jsx)("span",{className:"material-symbols-outlined text-[20px]",children:"delete"})})]})]})},V=()=>{let[e,t]=(0,a.useState)(2024),[s,l]=(0,a.useState)(!0);return(0,r.jsxs)("div",{className:`absolute bottom-0 left-0 right-0 z-40 transition-transform duration-300 ease-in-out ${s?"translate-y-0":"translate-y-full"}`,children:[(0,r.jsxs)("button",{onClick:()=>l(!s),className:"absolute -top-10 left-6 h-10 px-4 bg-white/90 dark:bg-black/90 backdrop-blur-md rounded-t-xl border-t border-x border-white/40 dark:border-white/10 shadow-[0_-4px_10px_rgba(0,0,0,0.05)] flex items-center gap-2 text-xs font-bold text-gray-600 dark:text-gray-300 hover:text-primary transition-colors z-50 group",children:[(0,r.jsx)("span",{className:`material-symbols-outlined text-[18px] transition-transform duration-300 ${s?"rotate-180":"rotate-0"}`,children:"expand_less"}),(0,r.jsx)("span",{children:s?"Hide Timeline":"Timeline"})]}),(0,r.jsx)("div",{className:"bg-white/80 dark:bg-black/80 backdrop-blur-xl border-t border-white/40 dark:border-white/10 px-6 md:px-8 py-6 shadow-[0_-4px_30px_rgba(0,0,0,0.03)] h-full",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto w-full flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"material-symbols-outlined text-primary text-xl",children:"history_toggle_off"}),(0,r.jsx)("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-200",children:"Timeline scrubbing"})]}),(0,r.jsx)("div",{className:"px-3 py-1 bg-primary/20 text-primary-dark dark:text-primary rounded-lg text-sm font-bold font-mono",children:e})]}),(0,r.jsxs)("div",{className:"relative w-full h-10 flex items-center group",children:[(0,r.jsx)("div",{className:"absolute w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-gradient-to-r from-primary/30 via-primary/80 to-primary origin-left",style:{width:`${(e-1900)/124*100}%`}})}),(0,r.jsx)("input",{type:"range",min:"1900",max:"2024",value:e,onChange:e=>t(parseInt(e.target.value)),className:"absolute w-full h-full opacity-0 cursor-ew-resize z-20"}),(0,r.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 w-8 h-8 -ml-4 bg-white dark:bg-gray-800 border-4 border-primary rounded-full shadow-[0_0_15px_rgba(128,236,19,0.5)] pointer-events-none z-10 transition-transform group-hover:scale-110",style:{left:`${(e-1900)/124*100}%`},children:(0,r.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"})})]}),(0,r.jsxs)("div",{className:"flex justify-between text-xs font-semibold text-gray-400 select-none px-1 tracking-wider uppercase",children:[(0,r.jsx)("span",{children:"1900"}),(0,r.jsx)("span",{children:"1920"}),(0,r.jsx)("span",{children:"1940"}),(0,r.jsx)("span",{children:"1960"}),(0,r.jsx)("span",{children:"1980"}),(0,r.jsx)("span",{children:"2000"}),(0,r.jsx)("span",{children:"2020"}),(0,r.jsx)("span",{children:"2024"})]})]})})]})},G=({isOpen:e,onClose:t,onSave:s,member:l,lang:i})=>{let n=K[i],[o,d]=(0,a.useState)({});return((0,a.useEffect)(()=>{e&&d(l?{...l}:{id:crypto.randomUUID(),name:"",nameZh:"",role:"",gender:"male",avatar:`https://picsum.photos/seed/${Date.now()}/200/200`,x:0,y:0,isSelf:!1})},[e,l]),e)?(0,r.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 animate-[fadeIn_0.2s_ease-out]",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:l?n.edit:n.addMember}),(0,r.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,r.jsx)("span",{className:"material-symbols-outlined",children:"close"})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:n.name}),(0,r.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:o.name||"",onChange:e=>d({...o,name:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:n.nameZh}),(0,r.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:o.nameZh||"",onChange:e=>d({...o,nameZh:e.target.value})})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:n.role}),(0,r.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:o.role||"",onChange:e=>d({...o,role:e.target.value})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:n.birthDate}),(0,r.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:o.birthDate||"",placeholder:"YYYY",onChange:e=>d({...o,birthDate:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:n.location}),(0,r.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:o.location||"",onChange:e=>d({...o,location:e.target.value})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",name:"gender",checked:"male"===o.gender,onChange:()=>d({...o,gender:"male"}),className:"text-primary focus:ring-primary"}),(0,r.jsx)("span",{className:"text-sm",children:n.male})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",name:"gender",checked:"female"===o.gender,onChange:()=>d({...o,gender:"female"}),className:"text-primary focus:ring-primary"}),(0,r.jsx)("span",{className:"text-sm",children:n.female})]})]}),(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsxs)("label",{className:"flex items-center gap-3 p-3 border border-primary/30 bg-primary/5 rounded-xl cursor-pointer hover:bg-primary/10 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",checked:o.isSelf||!1,onChange:e=>d({...o,isSelf:e.target.checked}),className:"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"block font-bold text-slate-900 dark:text-white",children:n.setAsSelf}),(0,r.jsx)("span",{className:"block text-xs text-gray-500",children:"This will center the map on this person initially"})]})]})})]}),(0,r.jsxs)("div",{className:"p-6 pt-2 flex gap-3",children:[(0,r.jsx)("button",{onClick:t,className:"flex-1 py-2.5 rounded-xl font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:n.cancel}),(0,r.jsx)("button",{onClick:()=>s(o),className:"flex-1 py-2.5 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl font-bold transition-colors shadow-lg shadow-primary/20",children:n.save})]})]})}):null};e.s(["default",0,()=>{let[e,t]=(0,a.useState)("tree"),[s,l]=(0,a.useState)(null),[i,n]=(0,a.useState)(!1),o=(0,O.useQueryClient)(),d=(0,F.useToast)(),{addOperation:c,undo:p,redo:g,canUndo:y,canRedo:f}=(0,A.useUndoRedo)();(0,a.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"z"===e.key?(e.preventDefault(),y&&(p(),d.showInfo("Undo operation"))):(e.ctrlKey||e.metaKey)&&"y"===e.key&&(e.preventDefault(),f&&(g(),d.showInfo("Redo operation")))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p,g,y,f,d]);let[v,j]=(0,a.useState)(!1),[k,w]=(0,a.useState)(null),{data:N=[],isLoading:S}=$({queryKey:["members"],queryFn:()=>h()}),{data:R=[],isLoading:C}=$({queryKey:["connections"],queryFn:()=>b()}),E=P({mutationFn:e=>N.find(t=>t.id===e.id)?m(e):u(e),onSuccess:(e,t)=>{o.invalidateQueries({queryKey:["members"]}),o.invalidateQueries({queryKey:["connections"]});let r=N.find(e=>e.id===t.id);r?(d.showSuccess("Member updated successfully"),c({type:"updateMember",data:{id:t.id,oldData:r,newData:t},inverse:{type:"updateMember",data:{id:t.id,oldData:t,newData:r}}})):(d.showSuccess("Member added successfully"),c({type:"addMember",data:t,inverse:{type:"deleteMember",data:{id:t.id}}}))},onError:()=>{d.showError("Failed to save member")}}),T=P({mutationFn:e=>{let t=N.find(t=>t.id===e);return t&&(T._memberToDelete=t),x(e)},onSuccess:(e,t)=>{o.invalidateQueries({queryKey:["members"]}),o.invalidateQueries({queryKey:["connections"]}),d.showSuccess("Member deleted successfully");let r=T._memberToDelete;r&&(c({type:"deleteMember",data:{id:t,memberData:r},inverse:{type:"addMember",data:r}}),T._memberToDelete=void 0)},onError:()=>{d.showError("Failed to delete member"),T._memberToDelete=void 0}}),M=e=>{l(e)},I=async e=>{await E.mutateAsync(e),j(!1),w(null)},D=async e=>{window.confirm("Are you sure you want to delete this member? This will also remove connected lines.")&&(await T.mutateAsync(e),s===e&&l(null))},_=e=>{w(e),j(!0)};return S||C?(0,r.jsx)("div",{className:"flex h-screen items-center justify-center bg-background-light dark:bg-background-dark text-primary",children:(0,r.jsx)("span",{className:"material-symbols-outlined text-4xl animate-spin",children:"autorenew"})}):(0,r.jsxs)("div",{className:"flex flex-col h-screen w-full relative",children:[(0,r.jsx)(Z,{currentView:e,setView:t,showChinese:i,setShowChinese:n}),(0,r.jsxs)("main",{className:"flex-1 relative flex flex-col h-full overflow-hidden",children:["tree"===e&&(0,r.jsx)(q,{selectedId:s,onSelect:M,showChinese:i,members:N,connections:R,onDataChange:()=>{o.invalidateQueries({queryKey:["members"]}),o.invalidateQueries({queryKey:["connections"]})},onEditMember:_}),"directory"===e&&(0,r.jsx)(B,{onSelect:M,showChinese:i,members:N}),"settings"===e&&(0,r.jsx)(Y,{})]}),s&&(0,r.jsx)(W,{member:N.find(e=>e.id===s)||null,onClose:()=>l(null),onSelectMember:M,showChinese:i,onEdit:()=>{let e=N.find(e=>e.id===s);e&&_(e)},onDelete:()=>D(s),members:N,connections:R}),"tree"===e&&(0,r.jsx)(V,{}),(0,r.jsx)(G,{isOpen:v,onClose:()=>j(!1),onSave:I,member:k,lang:i?"zh":"en"})]})}],20613)}]);