{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../lib/prisma.ts","../../../../app/actions.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;","'use server';\n\nimport { prisma } from '../lib/prisma';\nimport { FamilyMember, Connection } from '../types';\n\n// --- Members ---\n\nexport async function getMembersAction(): Promise<FamilyMember[]> {\n  const members = await prisma.member.findMany();\n  return members.map(m => ({\n    ...m,\n    gender: m.gender as 'male' | 'female',\n    // Ensure standard types match frontend expectation\n  }));\n}\n\nexport async function saveMemberAction(member: FamilyMember) {\n  const { id, ...data } = member;\n  \n  // If setting isSelf=true, we need to unset others first (transactionally would be better, but simplified here)\n  if (data.isSelf) {\n    await prisma.member.updateMany({\n      where: { isSelf: true, id: { not: id } },\n      data: { isSelf: false }\n    });\n  }\n\n  await prisma.member.upsert({\n    where: { id },\n    update: {\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf,\n      x: data.x,\n      y: data.y\n    },\n    create: {\n      id,\n      name: data.name,\n      nameZh: data.nameZh,\n      role: data.role,\n      birthDate: data.birthDate,\n      deathDate: data.deathDate,\n      location: data.location,\n      avatar: data.avatar,\n      bio: data.bio,\n      gender: data.gender,\n      isSelf: data.isSelf ?? false,\n      x: data.x,\n      y: data.y\n    }\n  });\n}\n\nexport async function deleteMemberAction(id: string) {\n  await prisma.$transaction([\n    // Delete all connections related to this member\n    prisma.connection.deleteMany({\n      where: {\n        OR: [\n          { sourceId: id },\n          { targetId: id }\n        ]\n      }\n    }),\n    // Delete the member itself\n    prisma.member.delete({\n      where: { id }\n    })\n  ]);\n}\n\n// Export a transactional version for explicit use\nexport async function deleteMemberWithConnectionsAction(id: string) {\n  return deleteMemberAction(id);\n}\n\n// --- Connections ---\n\nexport async function getConnectionsAction(): Promise<Connection[]> {\n  const connections = await prisma.connection.findMany();\n  return connections.map(c => ({\n    ...c,\n    sourceHandle: c.sourceHandle as any,\n    targetHandle: c.targetHandle as any,\n    lineStyle: c.lineStyle as any\n  }));\n}\n\nexport async function saveConnectionAction(conn: Connection) {\n  const { id, ...data } = conn;\n  \n  await prisma.connection.upsert({\n    where: { id },\n    update: {\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle\n    },\n    create: {\n      id,\n      sourceId: data.sourceId,\n      targetId: data.targetId,\n      sourceHandle: data.sourceHandle,\n      targetHandle: data.targetHandle,\n      label: data.label,\n      labelZh: data.labelZh,\n      color: data.color,\n      lineStyle: data.lineStyle\n    }\n  });\n}\n\nexport async function deleteConnectionAction(id: string) {\n  await prisma.connection.delete({\n    where: { id }\n  });\n}\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}