module.exports=[88347,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={ACTION_HMR_REFRESH:function(){return k},ACTION_NAVIGATE:function(){return h},ACTION_REFRESH:function(){return g},ACTION_RESTORE:function(){return i},ACTION_SERVER_ACTION:function(){return l},ACTION_SERVER_PATCH:function(){return j},PrefetchKind:function(){return m}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g="refresh",h="navigate",i="restore",j="server-patch",k="hmr-refresh",l="server-action";var m=((d={}).AUTO="auto",d.FULL="full",d);("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},46058,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},67009,(a,b,c)=>{"use strict";function d(a){return null!==a&&"object"==typeof a&&"then"in a&&"function"==typeof a.then}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isThenable",{enumerable:!0,get:function(){return d}})},90841,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={dispatchAppRouterAction:function(){return i},useActionQueue:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(46058)._(a.r(72131)),g=a.r(67009),h=null;function i(a){if(null===h)throw Object.defineProperty(Error("Internal Next.js error: Router action dispatched before initialization."),"__NEXT_ERROR_CODE",{value:"E668",enumerable:!1,configurable:!0});h(a)}function j(a){let[b,c]=f.default.useState(a.state);h=b=>a.dispatch(b,c);let d=(0,f.useMemo)(()=>b,[b]);return(0,g.isThenable)(d)?(0,f.use)(d):d}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},20611,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"callServer",{enumerable:!0,get:function(){return g}});let d=a.r(72131),e=a.r(88347),f=a.r(90841);async function g(a,b){return new Promise((c,g)=>{(0,d.startTransition)(()=>{(0,f.dispatchAppRouterAction)({type:e.ACTION_SERVER_ACTION,actionId:a,actionArgs:b,resolve:c,reject:g})})})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},1722,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"findSourceMapURL",{enumerable:!0,get:function(){return d}});("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},5050,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={callServer:function(){return f.callServer},createServerReference:function(){return h.createServerReference},findSourceMapURL:function(){return g.findSourceMapURL}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(20611),g=a.r(1722),h=a.r(38783)},57609,a=>{"use strict";let b;var c=a.i(87924),d=a.i(72131),e=a.i(5050);let f=(0,e.createServerReference)("00426a7e4cadf7afffdf1c9766764168d718302b92",e.callServer,void 0,e.findSourceMapURL,"getMembersAction"),g=(0,e.createServerReference)("40bdfbea698c59dd2879421a45a56f1fa4fe5109a6",e.callServer,void 0,e.findSourceMapURL,"saveMemberAction"),h=(0,e.createServerReference)("4074863e5d11f12596259c64117bb58347e8a88a02",e.callServer,void 0,e.findSourceMapURL,"deleteMemberAction"),i=(0,e.createServerReference)("003761513aa52799012788a487429b5d1b4d7e0a29",e.callServer,void 0,e.findSourceMapURL,"getConnectionsAction"),j=(0,e.createServerReference)("40ac8f13597e27c417bef8e29ed00511d1c0e50956",e.callServer,void 0,e.findSourceMapURL,"saveConnectionAction"),k=(0,e.createServerReference)("40c203df7974a181bbbf52d3fc46c31cd6001edfeb",e.callServer,void 0,e.findSourceMapURL,"deleteConnectionAction"),l=async()=>{try{return await f()}catch(a){return console.error("Failed to fetch members",a),[]}},m=async a=>{await g(a)},n=async a=>{await g(a)},o=async a=>{await h(a)},p=async()=>{try{return await i()}catch(a){return console.error("Failed to fetch connections",a),[]}},q=async a=>{await j(a)},r=async a=>{await j(a)},s=async a=>{await k(a)},t=async()=>{let a=await f(),b=await i(),c=`-- Robinson Family Tree Export
-- Generated on ${new Date().toISOString()}

`;return c+=`CREATE TABLE IF NOT EXISTS members (
      id TEXT PRIMARY KEY,
      name TEXT,
      name_zh TEXT,
      role TEXT,
      birth_date TEXT,
      location TEXT,
      avatar TEXT,
      gender TEXT,
      is_self BOOLEAN,
      x INTEGER,
      y INTEGER
    );

CREATE TABLE IF NOT EXISTS connections (
      id TEXT PRIMARY KEY,
      source_id TEXT,
      target_id TEXT,
      source_handle TEXT,
      target_handle TEXT,
      label TEXT,
      label_zh TEXT,
      color TEXT,
      line_style TEXT,
      FOREIGN KEY(source_id) REFERENCES members(id),
      FOREIGN KEY(target_id) REFERENCES members(id)
    );

`,a.forEach(a=>{c+=`INSERT INTO members (id, name, name_zh, role, birth_date, location, avatar, gender, is_self, x, y) VALUES ('${a.id}', '${a.name.replace(/'/g,"''")}', '${(a.nameZh||"").replace(/'/g,"''")}', '${a.role}', '${a.birthDate||""}', '${a.location||""}', '${a.avatar}', '${a.gender}', ${+!!a.isSelf}, ${Math.round(a.x)}, ${Math.round(a.y)});
`}),c+="\n",b.forEach(a=>{c+=`INSERT INTO connections (id, source_id, target_id, source_handle, target_handle, label, label_zh, color, line_style) VALUES ('${a.id}', '${a.sourceId}', '${a.targetId}', '${a.sourceHandle}', '${a.targetHandle}', '${a.label}', '${a.labelZh||""}', '${a.color||"#e5e7eb"}', '${a.lineStyle||"solid"}');
`}),c};var u=a.i(99745),v=a.i(18544),w=a.i(76644),x=a.i(33791),y=a.i(79715),z=a.i(42871),A=a.i(8361),B=class extends x.Subscribable{constructor(a,b){super(),this.options=b,this.#a=a,this.#b=null,this.#c=(0,y.pendingThenable)(),this.bindMethods(),this.setOptions(b)}#a;#d=void 0;#e=void 0;#f=void 0;#g;#h;#c;#b;#i;#j;#k;#l;#m;#n;#o=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#d.addObserver(this),C(this.#d,this.options)?this.#p():this.updateResult(),this.#q())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return D(this.#d,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return D(this.#d,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#r(),this.#s(),this.#d.removeObserver(this)}setOptions(a){let b=this.options,c=this.#d;if(this.options=this.#a.defaultQueryOptions(a),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,z.resolveEnabled)(this.options.enabled,this.#d))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#t(),this.#d.setOptions(this.options),b._defaulted&&!(0,z.shallowEqualObjects)(this.options,b)&&this.#a.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#d,observer:this});let d=this.hasListeners();d&&E(this.#d,c,this.options,b)&&this.#p(),this.updateResult(),d&&(this.#d!==c||(0,z.resolveEnabled)(this.options.enabled,this.#d)!==(0,z.resolveEnabled)(b.enabled,this.#d)||(0,z.resolveStaleTime)(this.options.staleTime,this.#d)!==(0,z.resolveStaleTime)(b.staleTime,this.#d))&&this.#u();let e=this.#v();d&&(this.#d!==c||(0,z.resolveEnabled)(this.options.enabled,this.#d)!==(0,z.resolveEnabled)(b.enabled,this.#d)||e!==this.#n)&&this.#w(e)}getOptimisticResult(a){var b,c;let d=this.#a.getQueryCache().build(this.#a,a),e=this.createResult(d,a);return b=this,c=e,(0,z.shallowEqualObjects)(b.getCurrentResult(),c)||(this.#f=e,this.#h=this.options,this.#g=this.#d.state),e}getCurrentResult(){return this.#f}trackResult(a,b){return new Proxy(a,{get:(a,c)=>(this.trackProp(c),b?.(c),"promise"===c&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#c.status||this.#c.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(a,c))})}trackProp(a){this.#o.add(a)}getCurrentQuery(){return this.#d}refetch({...a}={}){return this.fetch({...a})}fetchOptimistic(a){let b=this.#a.defaultQueryOptions(a),c=this.#a.getQueryCache().build(this.#a,b);return c.fetch().then(()=>this.createResult(c,b))}fetch(a){return this.#p({...a,cancelRefetch:a.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#f))}#p(a){this.#t();let b=this.#d.fetch(this.options,a);return a?.throwOnError||(b=b.catch(z.noop)),b}#u(){this.#r();let a=(0,z.resolveStaleTime)(this.options.staleTime,this.#d);if(z.isServer||this.#f.isStale||!(0,z.isValidTimeout)(a))return;let b=(0,z.timeUntilStale)(this.#f.dataUpdatedAt,a);this.#l=A.timeoutManager.setTimeout(()=>{this.#f.isStale||this.updateResult()},b+1)}#v(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#d):this.options.refetchInterval)??!1}#w(a){this.#s(),this.#n=a,!z.isServer&&!1!==(0,z.resolveEnabled)(this.options.enabled,this.#d)&&(0,z.isValidTimeout)(this.#n)&&0!==this.#n&&(this.#m=A.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||u.focusManager.isFocused())&&this.#p()},this.#n))}#q(){this.#u(),this.#w(this.#v())}#r(){this.#l&&(A.timeoutManager.clearTimeout(this.#l),this.#l=void 0)}#s(){this.#m&&(A.timeoutManager.clearInterval(this.#m),this.#m=void 0)}createResult(a,b){let c,d=this.#d,e=this.options,f=this.#f,g=this.#g,h=this.#h,i=a!==d?a.state:this.#e,{state:j}=a,k={...j},l=!1;if(b._optimisticResults){let c=this.hasListeners(),f=!c&&C(a,b),g=c&&E(a,d,b,e);(f||g)&&(k={...k,...(0,w.fetchState)(j.data,a.options)}),"isRestoring"===b._optimisticResults&&(k.fetchStatus="idle")}let{error:m,errorUpdatedAt:n,status:o}=k;c=k.data;let p=!1;if(void 0!==b.placeholderData&&void 0===c&&"pending"===o){let a;f?.isPlaceholderData&&b.placeholderData===h?.placeholderData?(a=f.data,p=!0):a="function"==typeof b.placeholderData?b.placeholderData(this.#k?.state.data,this.#k):b.placeholderData,void 0!==a&&(o="success",c=(0,z.replaceData)(f?.data,a,b),l=!0)}if(b.select&&void 0!==c&&!p)if(f&&c===g?.data&&b.select===this.#i)c=this.#j;else try{this.#i=b.select,c=b.select(c),c=(0,z.replaceData)(f?.data,c,b),this.#j=c,this.#b=null}catch(a){this.#b=a}this.#b&&(m=this.#b,c=this.#j,n=Date.now(),o="error");let q="fetching"===k.fetchStatus,r="pending"===o,s="error"===o,t=r&&q,u=void 0!==c,v={status:o,fetchStatus:k.fetchStatus,isPending:r,isSuccess:"success"===o,isError:s,isInitialLoading:t,isLoading:t,data:c,dataUpdatedAt:k.dataUpdatedAt,error:m,errorUpdatedAt:n,failureCount:k.fetchFailureCount,failureReason:k.fetchFailureReason,errorUpdateCount:k.errorUpdateCount,isFetched:k.dataUpdateCount>0||k.errorUpdateCount>0,isFetchedAfterMount:k.dataUpdateCount>i.dataUpdateCount||k.errorUpdateCount>i.errorUpdateCount,isFetching:q,isRefetching:q&&!r,isLoadingError:s&&!u,isPaused:"paused"===k.fetchStatus,isPlaceholderData:l,isRefetchError:s&&u,isStale:F(a,b),refetch:this.refetch,promise:this.#c,isEnabled:!1!==(0,z.resolveEnabled)(b.enabled,a)};if(this.options.experimental_prefetchInRender){let b=void 0!==v.data,c="error"===v.status&&!b,e=a=>{c?a.reject(v.error):b&&a.resolve(v.data)},f=()=>{e(this.#c=v.promise=(0,y.pendingThenable)())},g=this.#c;switch(g.status){case"pending":a.queryHash===d.queryHash&&e(g);break;case"fulfilled":(c||v.data!==g.value)&&f();break;case"rejected":c&&v.error===g.reason||f()}}return v}updateResult(){let a=this.#f,b=this.createResult(this.#d,this.options);if(this.#g=this.#d.state,this.#h=this.options,void 0!==this.#g.data&&(this.#k=this.#d),(0,z.shallowEqualObjects)(b,a))return;this.#f=b;let c=()=>{if(!a)return!0;let{notifyOnChangeProps:b}=this.options,c="function"==typeof b?b():b;if("all"===c||!c&&!this.#o.size)return!0;let d=new Set(c??this.#o);return this.options.throwOnError&&d.add("error"),Object.keys(this.#f).some(b=>this.#f[b]!==a[b]&&d.has(b))};this.#x({listeners:c()})}#t(){let a=this.#a.getQueryCache().build(this.#a,this.options);if(a===this.#d)return;let b=this.#d;this.#d=a,this.#e=a.state,this.hasListeners()&&(b?.removeObserver(this),a.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#q()}#x(a){v.notifyManager.batch(()=>{a.listeners&&this.listeners.forEach(a=>{a(this.#f)}),this.#a.getQueryCache().notify({query:this.#d,type:"observerResultsUpdated"})})}};function C(a,b){return!1!==(0,z.resolveEnabled)(b.enabled,a)&&void 0===a.state.data&&("error"!==a.state.status||!1!==b.retryOnMount)||void 0!==a.state.data&&D(a,b,b.refetchOnMount)}function D(a,b,c){if(!1!==(0,z.resolveEnabled)(b.enabled,a)&&"static"!==(0,z.resolveStaleTime)(b.staleTime,a)){let d="function"==typeof c?c(a):c;return"always"===d||!1!==d&&F(a,b)}return!1}function E(a,b,c,d){return(a!==b||!1===(0,z.resolveEnabled)(d.enabled,a))&&(!c.suspense||"error"!==a.state.status)&&F(a,c)}function F(a,b){return!1!==(0,z.resolveEnabled)(b.enabled,a)&&a.isStaleByTime((0,z.resolveStaleTime)(b.staleTime,a))}var G=a.i(37927),H=d.createContext((b=!1,{clearReset:()=>{b=!1},reset:()=>{b=!0},isReset:()=>b})),I=d.createContext(!1);I.Provider;var J=(a,b,c)=>b.fetchOptimistic(a).catch(()=>{c.clearReset()});function K(a,b){return function(a,b,c){let e,f=d.useContext(I),g=d.useContext(H),h=(0,G.useQueryClient)(c),i=h.defaultQueryOptions(a);h.getDefaultOptions().queries?._experimental_beforeQuery?.(i);let j=h.getQueryCache().get(i.queryHash);if(i._optimisticResults=f?"isRestoring":"optimistic",i.suspense){let a=a=>"static"===a?a:Math.max(a??1e3,1e3),b=i.staleTime;i.staleTime="function"==typeof b?(...c)=>a(b(...c)):a(b),"number"==typeof i.gcTime&&(i.gcTime=Math.max(i.gcTime,1e3))}e=j?.state.error&&"function"==typeof i.throwOnError?(0,z.shouldThrowError)(i.throwOnError,[j.state.error,j]):i.throwOnError,(i.suspense||i.experimental_prefetchInRender||e)&&!g.isReset()&&(i.retryOnMount=!1),d.useEffect(()=>{g.clearReset()},[g]);let k=!h.getQueryCache().get(i.queryHash),[l]=d.useState(()=>new b(h,i)),m=l.getOptimisticResult(i),n=!f&&!1!==a.subscribed;if(d.useSyncExternalStore(d.useCallback(a=>{let b=n?l.subscribe(v.notifyManager.batchCalls(a)):z.noop;return l.updateResult(),b},[l,n]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),d.useEffect(()=>{l.setOptions(i)},[i,l]),i?.suspense&&m.isPending)throw J(i,l,g);if((({result:a,errorResetBoundary:b,throwOnError:c,query:d,suspense:e})=>a.isError&&!b.isReset()&&!a.isFetching&&d&&(e&&void 0===a.data||(0,z.shouldThrowError)(c,[a.error,d])))({result:m,errorResetBoundary:g,throwOnError:i.throwOnError,query:j,suspense:i.suspense}))throw m.error;if(h.getDefaultOptions().queries?._experimental_afterQuery?.(i,m),i.experimental_prefetchInRender&&!z.isServer&&m.isLoading&&m.isFetching&&!f){let a=k?J(i,l,g):j?.promise;a?.catch(z.noop).finally(()=>{l.updateResult()})}return i.notifyOnChangeProps?m:l.trackResult(m)}(a,B,b)}var L=a.i(12794),M=x,N=class extends M.Subscribable{#a;#f=void 0;#y;#z;constructor(a,b){super(),this.#a=a,this.setOptions(b),this.bindMethods(),this.#A()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){let b=this.options;this.options=this.#a.defaultMutationOptions(a),(0,z.shallowEqualObjects)(this.options,b)||this.#a.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#y,observer:this}),b?.mutationKey&&this.options.mutationKey&&(0,z.hashKey)(b.mutationKey)!==(0,z.hashKey)(this.options.mutationKey)?this.reset():this.#y?.state.status==="pending"&&this.#y.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#y?.removeObserver(this)}onMutationUpdate(a){this.#A(),this.#x(a)}getCurrentResult(){return this.#f}reset(){this.#y?.removeObserver(this),this.#y=void 0,this.#A(),this.#x()}mutate(a,b){return this.#z=b,this.#y?.removeObserver(this),this.#y=this.#a.getMutationCache().build(this.#a,this.options),this.#y.addObserver(this),this.#y.execute(a)}#A(){let a=this.#y?.state??(0,L.getDefaultState)();this.#f={...a,isPending:"pending"===a.status,isSuccess:"success"===a.status,isError:"error"===a.status,isIdle:"idle"===a.status,mutate:this.mutate,reset:this.reset}}#x(a){v.notifyManager.batch(()=>{if(this.#z&&this.hasListeners()){let b=this.#f.variables,c=this.#f.context,d={client:this.#a,meta:this.options.meta,mutationKey:this.options.mutationKey};if(a?.type==="success"){try{this.#z.onSuccess?.(a.data,b,c,d)}catch(a){Promise.reject(a)}try{this.#z.onSettled?.(a.data,null,b,c,d)}catch(a){Promise.reject(a)}}else if(a?.type==="error"){try{this.#z.onError?.(a.error,b,c,d)}catch(a){Promise.reject(a)}try{this.#z.onSettled?.(void 0,a.error,b,c,d)}catch(a){Promise.reject(a)}}}this.listeners.forEach(a=>{a(this.#f)})})}};function O(a,b){let c=(0,G.useQueryClient)(b),[e]=d.useState(()=>new N(c,a));d.useEffect(()=>{e.setOptions(a)},[e,a]);let f=d.useSyncExternalStore(d.useCallback(a=>e.subscribe(v.notifyManager.batchCalls(a)),[e]),()=>e.getCurrentResult(),()=>e.getCurrentResult()),g=d.useCallback((a,b)=>{e.mutate(a,b).catch(z.noop)},[e]);if(f.error&&(0,z.shouldThrowError)(e.options.throwOnError,[f.error]))throw f.error;return{...f,mutate:g,mutateAsync:f.mutate}}var P=a.i(30813),Q=a.i(39226);let R={en:{appTitle:"Robinson Family Tree",tree:"Tree",directory:"Directory",settings:"Settings",searchPlaceholder:"Find family member...",export:"Export SQL",addMember:"Add Member",addCenterMember:"Add Center Member",emptyStateTitle:"Start Your Family Tree",emptyStateDesc:"No family members found. Please add yourself as the center member to begin.",name:"Name",nameZh:"Name (Chinese)",role:"Role / Relation",birthDate:"Birth Date",location:"Location",save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",setAsSelf:"Set as Me",isSelf:"Me",connectPrompt:"Drag from a dot to connect",connectionLabel:"Relationship Label",connectionLabelZh:"Relationship Label (CN)",sourceHandle:"Source Position",targetHandle:"Target Position",top:"Top",right:"Right",bottom:"Bottom",left:"Left",male:"Male",female:"Female",centerOnMe:"Reset to Me",lock:"Lock",unlock:"Unlock",autoArrange:"Auto Arrange",lineColor:"Line Color",lineStyle:"Line Style",solid:"Solid",dashed:"Dashed",dotted:"Dotted",calculatedRelation:"Relation to You"},zh:{appTitle:"罗宾逊家族树",tree:"族谱图",directory:"通讯录",settings:"设置",searchPlaceholder:"查找家庭成员...",export:"导出 SQL",addMember:"添加成员",addCenterMember:"添加核心成员",emptyStateTitle:"开始您的家族树",emptyStateDesc:"暂无数据。请先添加您自己作为核心成员。",name:"姓名",nameZh:"中文名",role:"角色 / 关系",birthDate:"出生日期",location:"地点",save:"保存",cancel:"取消",delete:"删除",edit:"编辑",setAsSelf:"设为自己",isSelf:"我",connectPrompt:"从圆点拖动以连接",connectionLabel:"关系称呼",connectionLabelZh:"关系称呼 (中文)",sourceHandle:"起始位置",targetHandle:"目标位置",top:"上",right:"右",bottom:"下",left:"左",male:"男",female:"女",centerOnMe:"回到中心",lock:"锁定",unlock:"解锁",autoArrange:"自动排列",lineColor:"线条颜色",lineStyle:"线条样式",solid:"实线",dashed:"虚线",dotted:"点线",calculatedRelation:"与我的关系"}},S=({currentView:a,setView:b,showChinese:d,setShowChinese:e})=>{let f=R[d?"zh":"en"],g=async()=>{let a=new Blob([await t()],{type:"text/sql"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`robinson_family_tree_${new Date().toISOString().split("T")[0]}.sql`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(b)};return(0,c.jsxs)("header",{className:"fixed top-0 left-0 right-0 z-50 flex items-center justify-between px-6 py-4 bg-white/60 dark:bg-black/60 backdrop-blur-md border-b border-white/20 dark:border-white/10 shadow-sm",children:[(0,c.jsx)("div",{className:"flex items-center gap-6",children:(0,c.jsxs)("div",{className:"flex items-center gap-3 text-slate-900 dark:text-white cursor-pointer",onClick:()=>b("tree"),children:[(0,c.jsx)("div",{className:"p-2 bg-primary/20 rounded-lg text-primary-dark dark:text-primary",children:(0,c.jsx)("span",{className:"material-symbols-outlined text-2xl",children:"account_tree"})}),(0,c.jsx)("h1",{className:"text-xl font-bold tracking-tight hidden sm:block",children:f.appTitle})]})}),(0,c.jsxs)("div",{className:"flex items-center gap-4",children:[(0,c.jsxs)("nav",{className:"hidden lg:flex items-center gap-2 mr-4",children:[(0,c.jsx)("button",{onClick:()=>b("tree"),className:`px-4 py-2 rounded-xl text-sm font-bold transition-colors ${"tree"===a?"bg-primary/20 text-primary-dark dark:text-primary":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:f.tree}),(0,c.jsx)("button",{onClick:()=>b("directory"),className:`px-4 py-2 rounded-xl text-sm font-bold transition-colors ${"directory"===a?"bg-primary/20 text-primary-dark dark:text-primary":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:f.directory})]}),(0,c.jsxs)("button",{onClick:()=>e(!d),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-100 dark:bg-white/10 hover:bg-gray-200 dark:hover:bg-white/20 rounded-lg transition-all",title:"Toggle Language",children:[(0,c.jsx)("span",{className:"material-symbols-outlined text-[18px] text-gray-600 dark:text-gray-300",children:"translate"}),(0,c.jsx)("span",{className:"text-xs font-bold font-mono text-gray-700 dark:text-gray-200 w-6 text-center",children:d?"CN":"EN"})]}),(0,c.jsx)("div",{className:"flex items-center gap-2",children:(0,c.jsxs)("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl text-sm font-bold transition-colors shadow-sm active:scale-95",children:[(0,c.jsx)("span",{className:"material-symbols-outlined text-[20px]",children:"database"}),(0,c.jsx)("span",{className:"hidden xl:inline",children:f.export})]})}),(0,c.jsx)("div",{className:"w-px h-8 bg-gray-200 dark:bg-gray-700 mx-1"}),(0,c.jsx)("div",{className:"h-10 w-10 rounded-full bg-cover bg-center border-2 border-white dark:border-gray-800 shadow-sm cursor-pointer hover:ring-2 hover:ring-primary transition-all",style:{backgroundImage:"url('https://picsum.photos/id/64/200/200')"}})]})]})},T={son:"parent",daughter:"parent",child:"parent",father:"child",mother:"child",parent:"child",brother:"sibling",sister:"sibling",sibling:"sibling",husband:"wife",wife:"husband",spouse:"spouse","ex-husband":"ex-wife","ex-wife":"ex-husband",partner:"partner"},U=({isOpen:a,onClose:b,onSave:e,onDelete:f,connection:g,lang:h})=>{let i=R[h],[j,k]=(0,d.useState)({});if((0,d.useEffect)(()=>{a&&g&&k({...g,color:g.color||"#80ec13",lineStyle:g.lineStyle||"solid"})},[a,g]),!a||!g)return null;let l=["top","right","bottom","left"];return(0,c.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 animate-[fadeIn_0.2s_ease-out]",children:[(0,c.jsx)("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-900/50",children:(0,c.jsx)("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Edit Connection"})}),(0,c.jsxs)("div",{className:"p-6 space-y-5",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Quick Presets"}),(0,c.jsx)("div",{className:"flex flex-wrap gap-2",children:[{en:"Father",zh:"父亲"},{en:"Mother",zh:"母亲"},{en:"Son",zh:"儿子"},{en:"Daughter",zh:"女儿"},{en:"Husband",zh:"丈夫"},{en:"Wife",zh:"妻子"},{en:"Brother",zh:"兄弟"},{en:"Sister",zh:"姐妹"},{en:"Ex-Husband",zh:"前夫"},{en:"Ex-Wife",zh:"前妻"}].map((a,b)=>(0,c.jsx)("button",{onClick:()=>{k(b=>({...b,label:a.en,labelZh:a.zh}))},className:"px-3 py-1.5 text-xs font-medium bg-gray-100 dark:bg-white/10 hover:bg-primary/20 hover:text-primary-dark dark:hover:text-primary rounded-lg transition-colors border border-transparent hover:border-primary/30",children:"zh"===h?a.zh:a.en},b))})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:i.connectionLabel}),(0,c.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:j.label||"",onChange:a=>k({...j,label:a.target.value})})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:i.connectionLabelZh}),(0,c.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:j.labelZh||"",onChange:a=>k({...j,labelZh:a.target.value})})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:i.sourceHandle}),(0,c.jsx)("select",{className:"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none",value:j.sourceHandle,onChange:a=>k({...j,sourceHandle:a.target.value}),children:l.map(a=>(0,c.jsx)("option",{value:a,children:i[a]},a))})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:i.targetHandle}),(0,c.jsx)("select",{className:"w-full px-2 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none",value:j.targetHandle,onChange:a=>k({...j,targetHandle:a.target.value}),children:l.map(a=>(0,c.jsx)("option",{value:a,children:i[a]},a))})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:i.lineColor}),(0,c.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 dark:bg-gray-900 p-1.5 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,c.jsx)("input",{type:"color",className:"h-8 w-8 p-0 border-0 rounded cursor-pointer bg-transparent",value:j.color||"#80ec13",onChange:a=>k({...j,color:a.target.value})}),(0,c.jsx)("span",{className:"text-xs text-gray-500 font-mono",children:j.color})]})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:i.lineStyle}),(0,c.jsx)("select",{className:"w-full px-2 py-2.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:outline-none",value:j.lineStyle,onChange:a=>k({...j,lineStyle:a.target.value}),children:["solid","dashed","dotted"].map(a=>(0,c.jsx)("option",{value:a,children:i[a]},a))})]})]})]}),(0,c.jsxs)("div",{className:"p-6 pt-2 flex gap-3",children:[(0,c.jsx)("button",{onClick:()=>{f(g.id),b()},className:"p-3 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors",title:i.delete,children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"delete"})}),(0,c.jsx)("button",{onClick:b,className:"flex-1 py-3 rounded-xl font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:i.cancel}),(0,c.jsx)("button",{onClick:()=>e(j),className:"flex-1 py-3 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl font-bold transition-colors shadow-lg shadow-primary/20",children:i.save})]})]})})},V=({selectedId:a,onSelect:b,showChinese:e,members:f,connections:g,onDataChange:h,onEditMember:i})=>{let j=e?"zh":"en",k=R[j],[l,o]=(0,d.useState)(1),[p,t]=(0,d.useState)({x:0,y:0}),[u,v]=(0,d.useState)(!0),[w,x]=(0,d.useState)(f),[y,z]=(0,d.useState)(null),[A,B]=(0,d.useState)(null),[C,D]=(0,d.useState)(null),[E,F]=(0,d.useState)({horizontal:[],vertical:[]}),[G,H]=(0,d.useState)(null),[I,J]=(0,d.useState)([]),[K,L]=(0,d.useState)(!1),[M,N]=(0,d.useState)(null),[O,P]=(0,d.useState)(null),Q=(0,d.useRef)(null),S=(0,d.useRef)(!1),V=(0,d.useRef)({x:0,y:0});(0,d.useEffect)(()=>{x(f)},[f]),(0,d.useEffect)(()=>{W()},[w]);let W=()=>{let a=w.find(a=>a.isSelf);if(a&&Q.current){let{width:b,height:c}=Q.current.getBoundingClientRect();t({x:b/2-a.x*l,y:c/2-a.y*l})}},X=(a,b,c)=>{switch(c){case"top":return{x:a+130,y:b};case"right":return{x:a+260,y:b+50};case"bottom":return{x:a+130,y:b+100};case"left":return{x:a,y:b+50}}},Y=()=>{if(y){let a=w.find(a=>a.id===y);if(a){if(G){let b={...a,x:G.x,y:G.y};x(a=>a.map(a=>a.id===y?b:a)),n(b)}else n(a);h()}z(null),F({horizontal:[],vertical:[]}),H(null)}if(A&&C){let a=C.x-130,b=C.y-50,c=20*Math.round(a/20),d=20*Math.round(b/20),e=crypto.randomUUID(),f={id:e,name:"",role:"",x:c,y:d,gender:"male",avatar:`https://picsum.photos/seed/${Date.now()}/200/200`};m(f),q({id:crypto.randomUUID(),sourceId:A.id,targetId:e,sourceHandle:A.handle,targetHandle:"top",label:"Relation",labelZh:"关系"}),h(),setTimeout(()=>i(f),50)}B(null),D(null),S.current=!1},Z=(a,b)=>{a.stopPropagation(),i(b)},$=(0,d.useMemo)(()=>{let a=new Map;return w.forEach(b=>{let c=((a,b,c,d)=>{let e=b.find(a=>a.isSelf);if(!e||e.id===a)return null;let f={};c.forEach(a=>{var c;let e,g;f[a.sourceId]||(f[a.sourceId]=[]),f[a.targetId]||(f[a.targetId]=[]);let h=b.find(b=>b.id===a.sourceId),i=b.find(b=>b.id===a.targetId);if(!h||!i)return;f[a.sourceId].push({to:a.targetId,label:d&&a.labelZh?a.labelZh:a.label});let j=d?"长辈/亲属":(c=a.label,"parent"===(g=T[e=c.toLowerCase()]||"relative")?"male"===h.gender?"Father":"Mother":"child"===g?"male"===h.gender?"Son":"Daughter":"sibling"===g?"male"===h.gender?"Brother":"Sister":T[e]?T[e].charAt(0).toUpperCase()+T[e].slice(1):g.charAt(0).toUpperCase()+g.slice(1)),k=j;d&&(k="Linked","Father"===j&&(k="父亲"),"Mother"===j&&(k="母亲"),"Son"===j&&(k="儿子"),"Daughter"===j&&(k="女儿"),"Brother"===j&&(k="兄弟"),"Sister"===j&&(k="姐妹"),"Wife"===j&&(k="妻子"),"Husband"===j&&(k="丈夫")),f[a.targetId].push({to:a.sourceId,label:k})});let g=[{id:e.id,path:[]}],h=new Set([e.id]);for(;g.length>0;){let{id:b,path:c}=g.shift();if(b===a)return c.join(" › ");for(let a of f[b]||[])!h.has(a.to)&&(h.add(a.to),c.length<3&&g.push({id:a.to,path:[...c,a.label]}))}return null})(b.id,w,g,e);a.set(b.id,c)}),a},[w,g,e]);return 0===w.length?(0,c.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center bg-background-light dark:bg-background-dark p-6",children:(0,c.jsxs)("div",{className:"text-center space-y-6 max-w-md",children:[(0,c.jsx)("div",{className:"w-24 h-24 bg-primary/20 rounded-full flex items-center justify-center mx-auto text-primary",children:(0,c.jsx)("span",{className:"material-symbols-outlined text-5xl",children:"forest"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:k.emptyStateTitle}),(0,c.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:k.emptyStateDesc})]}),(0,c.jsx)("button",{onClick:()=>{i({id:crypto.randomUUID(),name:"",role:"Me",x:0,y:0,gender:"male",avatar:"https://picsum.photos/200",isSelf:!0})},className:"px-8 py-3 bg-primary hover:bg-primary-dark text-slate-900 font-bold rounded-xl shadow-lg shadow-primary/20 transition-all hover:scale-105",children:k.addCenterMember})]})}):(0,c.jsxs)("div",{className:"flex-1 relative overflow-hidden bg-background-light dark:bg-background-dark cursor-grab active:cursor-grabbing h-full selection:bg-none",onMouseDown:a=>{!a.target||a.target.closest(".node-card, button, .handle")||(S.current=!0,V.current={x:a.clientX,y:a.clientY})},onMouseMove:a=>{let b=a.clientX-V.current.x,c=a.clientY-V.current.y;if(V.current={x:a.clientX,y:a.clientY},y&&!u){let a=w.find(a=>a.id===y);if(a){let d,e,f,g,h,{guides:i,snapPosition:j}=(d={horizontal:[],vertical:[]},e=a.x+b/l,f=a.y+c/l,g=20*Math.round(e/20),h=20*Math.round(f/20),w.forEach(b=>{b.id===a.id||(5>Math.abs(f-b.y)&&d.horizontal.push(b.y),5>Math.abs(e-b.x)&&d.vertical.push(b.x),5>Math.abs(f-(b.y+50))&&d.horizontal.push(b.y+50),5>Math.abs(e-(b.x+130))&&d.vertical.push(b.x+130))}),{guides:d,snapPosition:{x:g,y:h}});F(i),H(j),x(a=>a.map(a=>a.id===y?{...a,x:a.x+b/l,y:a.y+c/l}:a))}}else if(A){if(Q.current){let b=Q.current.getBoundingClientRect();D({x:(a.clientX-b.left-p.x)/l,y:(a.clientY-b.top-p.y)/l})}}else S.current&&t(a=>({x:a.x+b,y:a.y+c}))},onMouseUp:Y,onMouseLeave:Y,ref:Q,children:[(0,c.jsx)("div",{className:"absolute inset-0 bg-grid-pattern dark:bg-grid-pattern-dark bg-grid opacity-40 pointer-events-none"}),(0,c.jsxs)("div",{className:"absolute inset-0 transform-gpu transition-transform duration-75 origin-top-left",style:{transform:`translate(${p.x}px, ${p.y}px) scale(${l})`},children:[(0,c.jsxs)("svg",{className:"absolute top-0 left-0 overflow-visible z-10",style:{width:1,height:1},children:[E.horizontal.map((a,b)=>(0,c.jsx)("line",{x1:"0",y1:a,x2:"10000",y2:a,stroke:"#80ec13",strokeWidth:"2",strokeDasharray:"5,5",className:"animate-pulse"},`h-${b}`)),E.vertical.map((a,b)=>(0,c.jsx)("line",{x1:a,y1:"0",x2:a,y2:"10000",stroke:"#80ec13",strokeWidth:"2",strokeDasharray:"5,5",className:"animate-pulse"},`v-${b}`))]}),(0,c.jsxs)("svg",{className:"absolute top-0 left-0 overflow-visible z-0",style:{width:1,height:1},children:[g.map(a=>{var b,d,f,g,h,i;let j,k,l,m,n=w.find(b=>b.id===a.sourceId),o=w.find(b=>b.id===a.targetId);if(!n||!o)return null;let p=X(n.x,n.y,a.sourceHandle),q=X(o.x,o.y,a.targetHandle),r=(b=p.x,d=p.y,f=a.sourceHandle,g=q.x,h=q.y,i=a.targetHandle,j=Math.min(200,Math.max(50,.4*(Math.abs(g-b)+Math.abs(h-d)))),l=(k=(a,b,c,d)=>{switch(c){case"top":return{x:a,y:b-d};case"bottom":return{x:a,y:b+d};case"left":return{x:a-d,y:b};case"right":return{x:a+d,y:b}}})(b,d,f,j),m=k(g,h,i,j),`M ${b} ${d} C ${l.x} ${l.y}, ${m.x} ${m.y}, ${g} ${h}`),s=(p.x+q.x)/2,t=(p.y+q.y)/2;return a.color,(0,c.jsxs)("g",{className:"group cursor-pointer",onClick:b=>{b.stopPropagation(),N(a),L(!0)},children:[(0,c.jsx)("path",{d:r,fill:"none",stroke:"transparent",strokeWidth:15}),(0,c.jsx)("path",{d:r,fill:"none",stroke:a.color||"#e5e7eb",strokeWidth:3,strokeDasharray:(a=>{switch(a){case"dashed":return"8 4";case"dotted":return"2 2";default:return""}})(a.lineStyle),className:"dark:stroke-gray-600 transition-colors group-hover:stroke-primary/80"}),(0,c.jsx)("foreignObject",{x:s-40,y:t-12,width:80,height:24,children:(0,c.jsx)("div",{className:"flex items-center justify-center px-2 py-0.5 bg-white dark:bg-gray-800 border rounded-full shadow-sm text-[10px] font-bold text-center truncate select-none hover:scale-110 transition-transform",style:{borderColor:a.color||"#80ec13",color:a.color||"inherit"},children:e&&a.labelZh?a.labelZh:a.label})})]},a.id)}),A&&C&&(0,c.jsx)("path",{d:`M ${X(w.find(a=>a.id===A.id).x,w.find(a=>a.id===A.id).y,A.handle).x} ${X(w.find(a=>a.id===A.id).x,w.find(a=>a.id===A.id).y,A.handle).y} L ${C.x} ${C.y}`,fill:"none",stroke:"#80ec13",strokeWidth:2,strokeDasharray:"5 5"})]}),w.map(d=>{let f=$.get(d.id);return(0,c.jsxs)("div",{className:`absolute node-card group ${u?"":"cursor-move"}`,style:{transform:`translate(${d.x}px, ${d.y}px)`,width:260,height:100},onMouseDown:a=>{a.stopPropagation(),u||z(d.id)},onClick:a=>{a.stopPropagation(),a.ctrlKey||a.metaKey?J(a=>a.includes(d.id)?a.filter(a=>a!==d.id):[...a,d.id]):a.shiftKey?J(a=>[...a,d.id]):(J([d.id]),b(d.id))},onDoubleClick:a=>Z(a,d),children:[!u&&["top","right","bottom","left"].map(a=>(0,c.jsx)("div",{className:`
                                        absolute w-4 h-4 bg-white dark:bg-gray-800 border-2 border-primary rounded-full z-30 cursor-crosshair handle
                                        transition-all hover:scale-150 hover:bg-primary
                                        ${"top"===a?"-top-2 left-1/2 -translate-x-1/2":""}
                                        ${"right"===a?"-right-2 top-1/2 -translate-y-1/2":""}
                                        ${"bottom"===a?"-bottom-2 left-1/2 -translate-x-1/2":""}
                                        ${"left"===a?"-left-2 top-1/2 -translate-y-1/2":""}
                                        ${A?"opacity-100 scale-110":"opacity-0 group-hover:opacity-100"}
                                    `,onMouseDown:b=>{var c;return c=d.id,void(b.stopPropagation(),!u&&B({id:c,handle:a}))},onMouseUp:b=>{var c,e,f;return c=b,e=d.id,f=a,void(c.stopPropagation(),A&&A.id!==e&&(q({id:crypto.randomUUID(),sourceId:A.id,targetId:e,sourceHandle:A.handle,targetHandle:f,label:"Relation",labelZh:"关系"}),h()),B(null),D(null))},title:k.connectPrompt},a)),(0,c.jsxs)("div",{className:`
                                w-full h-full p-4 rounded-xl flex items-center gap-4 transition-all select-none
                                ${a===d.id?"bg-card-light dark:bg-card-dark backdrop-blur-md ring-2 ring-primary shadow-xl border-primary":I.includes(d.id)?"bg-card-light dark:bg-card-dark backdrop-blur-md ring-2 ring-blue-500 shadow-xl border-blue-500":"bg-card-light dark:bg-card-dark backdrop-blur-md border border-white/50 dark:border-white/10 shadow-lg hover:border-primary/50"}
                            `,children:[(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("div",{className:"w-14 h-14 rounded-full bg-cover bg-center border-2 border-white dark:border-gray-700 shadow-sm pointer-events-none",style:{backgroundImage:`url('${d.avatar}')`}}),d.isSelf&&(0,c.jsx)("div",{className:"absolute -bottom-1 -right-1 flex items-center justify-center w-5 h-5 bg-primary rounded-full border-2 border-white dark:border-gray-800 text-[10px] font-bold text-slate-900",title:"Me",children:"M"})]}),(0,c.jsxs)("div",{className:"flex-1 min-w-0 text-left pointer-events-none",children:[(0,c.jsx)("h3",{className:"text-slate-900 dark:text-white font-bold truncate",children:e&&d.nameZh?d.nameZh:d.name}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:d.birthDate||"Unknown"}),f&&(0,c.jsx)("p",{className:"text-[10px] text-primary-dark dark:text-primary font-bold mt-1 truncate",title:f,children:f}),!f&&(0,c.jsx)("span",{className:"inline-block mt-1 text-[10px] uppercase tracking-wider text-gray-400",children:d.role})]}),!u&&(0,c.jsx)("button",{onClick:a=>Z(a,d),className:"p-1.5 hover:bg-black/5 dark:hover:bg-white/10 rounded-lg text-gray-400 hover:text-primary transition-colors z-20 relative",children:(0,c.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"edit"})})]})]},d.id)})]}),(0,c.jsx)("div",{className:"absolute bottom-40 left-1/2 -translate-x-1/2 z-20 flex flex-col items-center gap-4",children:(0,c.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-white/80 dark:bg-black/60 backdrop-blur-md rounded-2xl shadow-lg border border-white/20 dark:border-white/10",children:[(0,c.jsx)("button",{onClick:()=>v(!u),className:`w-10 h-10 flex items-center justify-center rounded-xl transition-colors ${u?"text-gray-500 hover:bg-black/5 dark:hover:bg-white/10":"text-primary bg-primary/10 ring-2 ring-primary/20"}`,title:u?k.unlock:k.lock,children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:u?"lock":"lock_open"})}),(0,c.jsx)("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),(0,c.jsx)("button",{onClick:()=>W(),className:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors",title:k.centerOnMe,children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"my_location"})}),(0,c.jsx)("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),(0,c.jsx)("button",{onClick:()=>o(a=>Math.max(.5,a-.1)),className:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors",children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"remove"})}),(0,c.jsxs)("div",{className:"px-2 text-sm font-semibold text-gray-600 dark:text-gray-300 min-w-[3rem] text-center",children:[Math.round(100*l),"%"]}),(0,c.jsx)("button",{onClick:()=>o(a=>Math.min(2,a+.1)),className:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-black/5 dark:hover:bg-white/10 text-gray-700 dark:text-gray-200 transition-colors",children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"add"})})]})}),(0,c.jsx)("div",{className:"absolute bottom-40 right-8 z-20 flex flex-col gap-4 items-end",children:(0,c.jsx)("button",{onClick:()=>{i({id:crypto.randomUUID(),name:"",role:"",x:0,y:0,gender:"male",avatar:"https://picsum.photos/200"})},className:"w-16 h-16 bg-primary hover:bg-primary-dark text-slate-900 rounded-2xl shadow-[0_8px_30px_rgb(128,236,19,0.3)] flex items-center justify-center transition-all hover:scale-110 active:scale-95 group",title:k.addMember,children:(0,c.jsx)("span",{className:"material-symbols-outlined text-3xl",children:"add"})})}),(0,c.jsx)(U,{isOpen:K,onClose:()=>L(!1),onSave:a=>{r(a),h(),L(!1),N(null)},onDelete:a=>{s(a),h()},connection:M,lang:j})]})},W=({onSelect:a,showChinese:b,members:d})=>(0,c.jsx)("div",{className:"flex-1 overflow-y-auto pt-24 pb-40 px-6 md:px-10 bg-background-light dark:bg-background-dark",children:(0,c.jsxs)("div",{className:"max-w-[1400px] mx-auto flex flex-col gap-8",children:[(0,c.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:(0,c.jsxs)("div",{className:"flex flex-col gap-1 p-5 rounded-xl bg-white dark:bg-card-dark border border-gray-100 dark:border-white/5 shadow-sm",children:[(0,c.jsxs)("div",{className:"flex justify-between items-start",children:[(0,c.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Total Members"}),(0,c.jsx)("span",{className:"material-symbols-outlined text-primary",children:"groups"})]}),(0,c.jsx)("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:d.length})]})}),(0,c.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:d.map(d=>(0,c.jsxs)("div",{className:"group relative flex flex-col bg-white dark:bg-card-dark rounded-xl border border-gray-100 dark:border-white/5 shadow-sm overflow-hidden transition-all hover:shadow-md hover:border-primary/50",children:[(0,c.jsxs)("div",{className:"p-6 flex flex-col items-center gap-4 border-b border-gray-50 dark:border-white/5",children:[(0,c.jsx)("div",{className:"size-24 rounded-full bg-cover bg-center border-4 border-white dark:border-gray-700 shadow-sm group-hover:scale-105 transition-transform duration-300",style:{backgroundImage:`url('${d.avatar}')`}}),(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:b&&d.nameZh?d.nameZh:d.name}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d.role})]}),(0,c.jsx)("div",{className:"flex gap-2",children:(0,c.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-white/10 text-gray-600 dark:text-gray-300 capitalize",children:d.gender})})]}),(0,c.jsxs)("div",{className:"p-4 flex flex-col gap-3 text-sm",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 text-gray-500 dark:text-gray-400",children:[(0,c.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"cake"}),(0,c.jsx)("span",{children:d.birthDate||"N/A"})]}),(0,c.jsxs)("div",{className:"flex items-center gap-3 text-gray-500 dark:text-gray-400",children:[(0,c.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"location_on"}),(0,c.jsx)("span",{children:d.location||"N/A"})]})]}),(0,c.jsx)("div",{className:"mt-auto p-4 bg-gray-50 dark:bg-white/5 flex items-center justify-between",children:(0,c.jsx)("button",{onClick:()=>a(d.id),className:"w-full text-center text-xs font-bold text-gray-600 dark:text-gray-300 hover:text-primary transition-colors",children:"View Profile"})})]},d.id))})]})}),X=()=>(0,c.jsx)("div",{className:"flex-1 overflow-y-auto pt-24 pb-20 px-6 md:px-10 bg-background-light dark:bg-background-dark",children:(0,c.jsxs)("div",{className:"max-w-[960px] mx-auto flex flex-col gap-8 animate-fade-in",children:[(0,c.jsxs)("div",{className:"flex flex-wrap justify-between gap-4 p-4 items-end",children:[(0,c.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,c.jsx)("h1",{className:"text-slate-900 dark:text-white text-4xl font-black leading-tight",children:"Privacy & Visibility"}),(0,c.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-base font-normal max-w-2xl",children:"Manage visual hierarchy, control access permissions, and filter specific branches for your family tree visualization."})]}),(0,c.jsxs)("div",{className:"flex gap-3",children:[(0,c.jsx)("button",{className:"flex items-center justify-center h-10 px-5 text-sm font-bold bg-white dark:bg-white/10 border border-gray-200 dark:border-white/10 rounded-lg text-slate-900 dark:text-white hover:bg-gray-50 dark:hover:bg-white/20 transition-colors",children:"Cancel"}),(0,c.jsx)("button",{className:"flex items-center justify-center h-10 px-5 text-sm font-bold bg-primary text-slate-900 rounded-lg hover:bg-primary-dark transition-colors shadow-lg shadow-primary/20",children:"Save Changes"})]})]}),(0,c.jsxs)("section",{className:"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm overflow-hidden p-6 md:p-8",children:[(0,c.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,c.jsx)("div",{className:"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary",children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"layers"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Visualization Depth"}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Control how many generations are loaded by default."})]})]}),(0,c.jsxs)("div",{className:"relative flex w-full flex-col gap-6",children:[(0,c.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,c.jsx)("p",{className:"text-slate-900 dark:text-white text-lg font-bold",children:"Level 3: Great-Grandparents"}),(0,c.jsx)("div",{className:"px-3 py-1 rounded-full bg-primary/20 text-xs font-bold text-primary-dark dark:text-primary uppercase tracking-wide",children:"62 Profiles Visible"})]}),(0,c.jsxs)("div",{className:"relative w-full h-12 flex items-center group",children:[(0,c.jsx)("div",{className:"absolute w-full h-2 bg-gray-200 dark:bg-white/10 rounded-full overflow-hidden",children:(0,c.jsx)("div",{className:"h-full bg-primary w-[60%] rounded-full"})}),(0,c.jsx)("input",{type:"range",min:"1",max:"5",defaultValue:"3",className:"absolute w-full h-full opacity-0 cursor-pointer z-10"}),(0,c.jsx)("div",{className:"absolute w-full flex justify-between px-1 pointer-events-none",children:[1,2,3,4,5].map(a=>(0,c.jsx)("div",{className:`size-4 rounded-full border-2 border-white dark:border-gray-800 transition-all ${a<=3?"bg-primary scale-110":"bg-gray-300 dark:bg-white/20"}`},a))})]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,c.jsxs)("section",{className:"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm p-6 md:p-8 flex flex-col h-full",children:[(0,c.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,c.jsx)("div",{className:"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary",children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"account_tree"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Branch Filters"}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Toggle visibility of specific family lines."})]})]}),(0,c.jsx)("div",{className:"flex flex-col gap-6",children:[{title:"Paternal Side",sub:"Father's ancestors",active:!0},{title:"Maternal Side",sub:"Mother's ancestors",active:!0},{title:"In-Laws & Step-Family",sub:"Connected by marriage",active:!1}].map((a,b)=>(0,c.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",children:[(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsx)("span",{className:"text-base font-semibold text-slate-900 dark:text-white",children:a.title}),(0,c.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.sub})]}),(0,c.jsx)("div",{className:`relative inline-flex h-7 w-12 items-center rounded-full transition-colors duration-200 ${a.active?"bg-primary":"bg-gray-300 dark:bg-white/20"}`,children:(0,c.jsx)("span",{className:`inline-block size-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${a.active?"translate-x-6":"translate-x-1"}`})})]},b))})]}),(0,c.jsxs)("section",{className:"rounded-2xl bg-white/70 dark:bg-card-dark backdrop-blur-md border border-white/60 dark:border-white/5 shadow-sm p-6 md:p-8 flex flex-col h-full",children:[(0,c.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,c.jsx)("div",{className:"size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary-dark dark:text-primary",children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"lock"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Privacy Level"}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Who can view your living relatives?"})]})]}),(0,c.jsx)("div",{className:"flex flex-col gap-4",children:[{title:"Public",sub:"Visible to all users",checked:!1},{title:"Family Members Only",sub:"Only invited members",checked:!0},{title:"Private",sub:"Only you",checked:!1}].map((a,b)=>(0,c.jsxs)("label",{className:`flex items-start gap-3 p-3 rounded-xl border cursor-pointer transition-colors ${a.checked?"border-primary/50 bg-primary/10":"border-transparent hover:bg-black/5 dark:hover:bg-white/5"}`,children:[(0,c.jsx)("input",{type:"radio",name:"privacy",defaultChecked:a.checked,className:"mt-1 text-primary focus:ring-primary bg-transparent"}),(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsx)("span",{className:"text-sm font-bold text-slate-900 dark:text-white",children:a.title}),(0,c.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.sub})]})]},b))})]})]}),(0,c.jsxs)("section",{className:"rounded-2xl bg-gradient-to-r from-gray-900 to-gray-800 dark:from-black dark:to-[#1a1a1a] p-8 text-white flex flex-col md:flex-row items-center justify-between gap-6 shadow-lg",children:[(0,c.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,c.jsx)("h3",{className:"text-xl font-bold",children:"Need more control?"}),(0,c.jsx)("p",{className:"text-white/70 max-w-lg text-sm",children:"Our Advanced Privacy Shield offers granular control over every single profile in your tree."})]}),(0,c.jsxs)("button",{className:"whitespace-nowrap px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg font-bold text-sm transition-all flex items-center gap-2",children:[(0,c.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"verified_user"}),"View Advanced Options"]})]})]})}),Y=({member:a,onClose:b,onSelectMember:d,showChinese:e,onEdit:f,onDelete:g,members:h,connections:i})=>{var j;let k;if(!a)return null;let l=(j=a.id,k=[],i.forEach(a=>{if(a.sourceId===j){let b=h.find(b=>b.id===a.targetId);b&&k.push({relation:a.label,member:b})}else if(a.targetId===j){let b=h.find(b=>b.id===a.sourceId);b&&k.push({relation:"Linked by "+a.label,member:b})}}),k);return(0,c.jsxs)("aside",{className:"absolute top-24 right-6 bottom-32 w-80 md:w-96 bg-white/80 dark:bg-black/80 backdrop-blur-xl border border-white/40 dark:border-white/10 rounded-2xl shadow-2xl p-6 z-30 flex flex-col animate-[slideIn_0.3s_ease-out]",children:[(0,c.jsx)("style",{children:`
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `}),(0,c.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,c.jsx)("h2",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Profile Details"}),(0,c.jsx)("button",{onClick:b,className:"p-1.5 hover:bg-black/5 dark:hover:bg-white/10 rounded-lg transition-colors",children:(0,c.jsx)("span",{className:"material-symbols-outlined text-gray-500 text-[20px]",children:"close"})})]}),(0,c.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,c.jsxs)("div",{className:"w-24 h-24 rounded-full p-1 border-2 border-primary border-dashed mb-3 relative group",children:[(0,c.jsx)("div",{className:"w-full h-full rounded-full bg-cover bg-center",style:{backgroundImage:`url('${a.avatar}')`}}),(0,c.jsx)("button",{onClick:f,className:"absolute bottom-0 right-0 p-1.5 bg-primary rounded-full text-slate-900 shadow-sm hover:scale-110 transition-transform cursor-pointer",children:(0,c.jsx)("span",{className:"material-symbols-outlined text-[16px]",children:"edit"})})]}),(0,c.jsx)("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:e&&a.nameZh?a.nameZh:a.name}),(0,c.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.role}),a.isSelf&&(0,c.jsx)("span",{className:"mt-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-primary/20 text-primary-dark dark:text-primary",children:"Center Member (Me)"})]}),(0,c.jsxs)("div",{className:"space-y-4 flex-1 overflow-y-auto no-scrollbar pr-1",children:[(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,c.jsxs)("div",{className:"bg-white/50 dark:bg-white/5 p-3 rounded-xl border border-white/40 dark:border-white/5",children:[(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Birth Date"}),(0,c.jsx)("p",{className:"font-semibold text-sm",children:a.birthDate})]}),(0,c.jsxs)("div",{className:"bg-white/50 dark:bg-white/5 p-3 rounded-xl border border-white/40 dark:border-white/5",children:[(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Location"}),(0,c.jsx)("p",{className:"font-semibold text-sm",children:a.location})]})]}),(0,c.jsxs)("div",{className:"bg-white/50 dark:bg-white/5 p-4 rounded-xl border border-white/40 dark:border-white/5",children:[(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Biography"}),(0,c.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:a.bio||"No biography added."})]}),(0,c.jsxs)("div",{className:"pt-4",children:[(0,c.jsxs)("h4",{className:"text-sm font-bold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[(0,c.jsx)("span",{className:"material-symbols-outlined text-primary text-[18px]",children:"family_star"}),"Immediate Family"]}),(0,c.jsxs)("div",{className:"space-y-2",children:[0===l.length&&(0,c.jsx)("p",{className:"text-xs text-gray-500",children:"No connections found."}),l.map(a=>(0,c.jsxs)("div",{onClick:()=>d(a.member.id),className:"flex items-center gap-3 p-2 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg transition-colors cursor-pointer group",children:[(0,c.jsx)("div",{className:"w-8 h-8 rounded-full bg-cover bg-center",style:{backgroundImage:`url('${a.member.avatar}')`}}),(0,c.jsxs)("div",{className:"flex-1",children:[(0,c.jsx)("p",{className:"text-sm font-semibold group-hover:text-primary transition-colors",children:e&&a.member.nameZh?a.member.nameZh:a.member.name}),(0,c.jsx)("p",{className:"text-xs text-gray-500",children:a.relation})]}),(0,c.jsx)("span",{className:"material-symbols-outlined text-gray-400 text-[18px]",children:"chevron_right"})]},a.member.id))]})]})]}),(0,c.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex gap-2",children:[(0,c.jsx)("button",{onClick:f,className:"flex-1 bg-slate-900 hover:bg-gray-800 text-white dark:bg-white dark:text-black dark:hover:bg-gray-200 py-2.5 rounded-xl text-sm font-bold transition-colors shadow-lg",children:"Edit Profile"}),(0,c.jsx)("button",{onClick:g,className:"w-10 flex items-center justify-center bg-red-50 hover:bg-red-100 text-red-500 rounded-xl transition-colors",children:(0,c.jsx)("span",{className:"material-symbols-outlined text-[20px]",children:"delete"})})]})]})},Z=()=>{let[a,b]=(0,d.useState)(2024),[e,f]=(0,d.useState)(!0);return(0,c.jsxs)("div",{className:`absolute bottom-0 left-0 right-0 z-40 transition-transform duration-300 ease-in-out ${e?"translate-y-0":"translate-y-full"}`,children:[(0,c.jsxs)("button",{onClick:()=>f(!e),className:"absolute -top-10 left-6 h-10 px-4 bg-white/90 dark:bg-black/90 backdrop-blur-md rounded-t-xl border-t border-x border-white/40 dark:border-white/10 shadow-[0_-4px_10px_rgba(0,0,0,0.05)] flex items-center gap-2 text-xs font-bold text-gray-600 dark:text-gray-300 hover:text-primary transition-colors z-50 group",children:[(0,c.jsx)("span",{className:`material-symbols-outlined text-[18px] transition-transform duration-300 ${e?"rotate-180":"rotate-0"}`,children:"expand_less"}),(0,c.jsx)("span",{children:e?"Hide Timeline":"Timeline"})]}),(0,c.jsx)("div",{className:"bg-white/80 dark:bg-black/80 backdrop-blur-xl border-t border-white/40 dark:border-white/10 px-6 md:px-8 py-6 shadow-[0_-4px_30px_rgba(0,0,0,0.03)] h-full",children:(0,c.jsxs)("div",{className:"max-w-7xl mx-auto w-full flex flex-col gap-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{className:"material-symbols-outlined text-primary text-xl",children:"history_toggle_off"}),(0,c.jsx)("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-200",children:"Timeline scrubbing"})]}),(0,c.jsx)("div",{className:"px-3 py-1 bg-primary/20 text-primary-dark dark:text-primary rounded-lg text-sm font-bold font-mono",children:a})]}),(0,c.jsxs)("div",{className:"relative w-full h-10 flex items-center group",children:[(0,c.jsx)("div",{className:"absolute w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,c.jsx)("div",{className:"h-full bg-gradient-to-r from-primary/30 via-primary/80 to-primary origin-left",style:{width:`${(a-1900)/124*100}%`}})}),(0,c.jsx)("input",{type:"range",min:"1900",max:"2024",value:a,onChange:a=>b(parseInt(a.target.value)),className:"absolute w-full h-full opacity-0 cursor-ew-resize z-20"}),(0,c.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 w-8 h-8 -ml-4 bg-white dark:bg-gray-800 border-4 border-primary rounded-full shadow-[0_0_15px_rgba(128,236,19,0.5)] pointer-events-none z-10 transition-transform group-hover:scale-110",style:{left:`${(a-1900)/124*100}%`},children:(0,c.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"})})]}),(0,c.jsxs)("div",{className:"flex justify-between text-xs font-semibold text-gray-400 select-none px-1 tracking-wider uppercase",children:[(0,c.jsx)("span",{children:"1900"}),(0,c.jsx)("span",{children:"1920"}),(0,c.jsx)("span",{children:"1940"}),(0,c.jsx)("span",{children:"1960"}),(0,c.jsx)("span",{children:"1980"}),(0,c.jsx)("span",{children:"2000"}),(0,c.jsx)("span",{children:"2020"}),(0,c.jsx)("span",{children:"2024"})]})]})})]})},$=({isOpen:a,onClose:b,onSave:e,member:f,lang:g})=>{let h=R[g],[i,j]=(0,d.useState)({});return((0,d.useEffect)(()=>{a&&j(f?{...f}:{id:crypto.randomUUID(),name:"",nameZh:"",role:"",gender:"male",avatar:`https://picsum.photos/seed/${Date.now()}/200/200`,x:0,y:0,isSelf:!1})},[a,f]),a)?(0,c.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 animate-[fadeIn_0.2s_ease-out]",children:[(0,c.jsxs)("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50 flex justify-between items-center",children:[(0,c.jsx)("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:f?h.edit:h.addMember}),(0,c.jsx)("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,c.jsx)("span",{className:"material-symbols-outlined",children:"close"})})]}),(0,c.jsxs)("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:h.name}),(0,c.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:i.name||"",onChange:a=>j({...i,name:a.target.value})})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:h.nameZh}),(0,c.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:i.nameZh||"",onChange:a=>j({...i,nameZh:a.target.value})})]})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:h.role}),(0,c.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:i.role||"",onChange:a=>j({...i,role:a.target.value})})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:h.birthDate}),(0,c.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:i.birthDate||"",placeholder:"YYYY",onChange:a=>j({...i,birthDate:a.target.value})})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("label",{className:"text-xs font-bold text-gray-500 uppercase",children:h.location}),(0,c.jsx)("input",{className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none",value:i.location||"",onChange:a=>j({...i,location:a.target.value})})]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-4",children:[(0,c.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,c.jsx)("input",{type:"radio",name:"gender",checked:"male"===i.gender,onChange:()=>j({...i,gender:"male"}),className:"text-primary focus:ring-primary"}),(0,c.jsx)("span",{className:"text-sm",children:h.male})]}),(0,c.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,c.jsx)("input",{type:"radio",name:"gender",checked:"female"===i.gender,onChange:()=>j({...i,gender:"female"}),className:"text-primary focus:ring-primary"}),(0,c.jsx)("span",{className:"text-sm",children:h.female})]})]}),(0,c.jsx)("div",{className:"pt-2",children:(0,c.jsxs)("label",{className:"flex items-center gap-3 p-3 border border-primary/30 bg-primary/5 rounded-xl cursor-pointer hover:bg-primary/10 transition-colors",children:[(0,c.jsx)("input",{type:"checkbox",checked:i.isSelf||!1,onChange:a=>j({...i,isSelf:a.target.checked}),className:"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"block font-bold text-slate-900 dark:text-white",children:h.setAsSelf}),(0,c.jsx)("span",{className:"block text-xs text-gray-500",children:"This will center the map on this person initially"})]})]})})]}),(0,c.jsxs)("div",{className:"p-6 pt-2 flex gap-3",children:[(0,c.jsx)("button",{onClick:b,className:"flex-1 py-2.5 rounded-xl font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:h.cancel}),(0,c.jsx)("button",{onClick:()=>e(i),className:"flex-1 py-2.5 bg-primary hover:bg-primary-dark text-slate-900 rounded-xl font-bold transition-colors shadow-lg shadow-primary/20",children:h.save})]})]})}):null};a.s(["default",0,()=>{let[a,b]=(0,d.useState)("tree"),[e,f]=(0,d.useState)(null),[g,h]=(0,d.useState)(!1),i=(0,G.useQueryClient)(),j=(0,P.useToast)(),{addOperation:k,undo:q,redo:r,canUndo:s,canRedo:t}=(0,Q.useUndoRedo)();(0,d.useEffect)(()=>{let a=a=>{(a.ctrlKey||a.metaKey)&&"z"===a.key?(a.preventDefault(),s&&(q(),j.showInfo("Undo operation"))):(a.ctrlKey||a.metaKey)&&"y"===a.key&&(a.preventDefault(),t&&(r(),j.showInfo("Redo operation")))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[q,r,s,t,j]);let[u,v]=(0,d.useState)(!1),[w,x]=(0,d.useState)(null),{data:y=[],isLoading:z}=K({queryKey:["members"],queryFn:()=>l()}),{data:A=[],isLoading:B}=K({queryKey:["connections"],queryFn:()=>p()}),C=O({mutationFn:a=>y.find(b=>b.id===a.id)?n(a):m(a),onSuccess:(a,b)=>{i.invalidateQueries({queryKey:["members"]}),i.invalidateQueries({queryKey:["connections"]});let c=y.find(a=>a.id===b.id);c?(j.showSuccess("Member updated successfully"),k({type:"updateMember",data:{id:b.id,oldData:c,newData:b},inverse:{type:"updateMember",data:{id:b.id,oldData:b,newData:c}}})):(j.showSuccess("Member added successfully"),k({type:"addMember",data:b,inverse:{type:"deleteMember",data:{id:b.id}}}))},onError:()=>{j.showError("Failed to save member")}}),D=O({mutationFn:a=>{let b=y.find(b=>b.id===a);return b&&(D._memberToDelete=b),o(a)},onSuccess:(a,b)=>{i.invalidateQueries({queryKey:["members"]}),i.invalidateQueries({queryKey:["connections"]}),j.showSuccess("Member deleted successfully");let c=D._memberToDelete;c&&(k({type:"deleteMember",data:{id:b,memberData:c},inverse:{type:"addMember",data:c}}),D._memberToDelete=void 0)},onError:()=>{j.showError("Failed to delete member"),D._memberToDelete=void 0}}),E=a=>{f(a)},F=async a=>{await C.mutateAsync(a),v(!1),x(null)},H=async a=>{window.confirm("Are you sure you want to delete this member? This will also remove connected lines.")&&(await D.mutateAsync(a),e===a&&f(null))},I=a=>{x(a),v(!0)};return z||B?(0,c.jsx)("div",{className:"flex h-screen items-center justify-center bg-background-light dark:bg-background-dark text-primary",children:(0,c.jsx)("span",{className:"material-symbols-outlined text-4xl animate-spin",children:"autorenew"})}):(0,c.jsxs)("div",{className:"flex flex-col h-screen w-full relative",children:[(0,c.jsx)(S,{currentView:a,setView:b,showChinese:g,setShowChinese:h}),(0,c.jsxs)("main",{className:"flex-1 relative flex flex-col h-full overflow-hidden",children:["tree"===a&&(0,c.jsx)(V,{selectedId:e,onSelect:E,showChinese:g,members:y,connections:A,onDataChange:()=>{i.invalidateQueries({queryKey:["members"]}),i.invalidateQueries({queryKey:["connections"]})},onEditMember:I}),"directory"===a&&(0,c.jsx)(W,{onSelect:E,showChinese:g,members:y}),"settings"===a&&(0,c.jsx)(X,{})]}),e&&(0,c.jsx)(Y,{member:y.find(a=>a.id===e)||null,onClose:()=>f(null),onSelectMember:E,showChinese:g,onEdit:()=>{let a=y.find(a=>a.id===e);a&&I(a)},onDelete:()=>H(e),members:y,connections:A}),"tree"===a&&(0,c.jsx)(Z,{}),(0,c.jsx)($,{isOpen:u,onClose:()=>v(!1),onSave:F,member:w,lang:g?"zh":"en"})]})}],57609)}];

//# sourceMappingURL=_836c4e13._.js.map